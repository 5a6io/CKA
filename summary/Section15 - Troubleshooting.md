# ğŸ¨ Section15 - Troubleshooting

## Application Failure


```mermaid
graph BT
  DB@{shape: circle} ~~~ DB-Service
  DB-Service@{ shape: tri } --> WEB
  WEB@{shape: circle} --> WEB-Service
  WEB-Service@{ shape: tri } --> User@{ img: "https://img.icons8.com/?size=100&id=108652&format=png&color=000000", w: 60, h: 60}
```


ì• í”Œë¦¬ì¼€ì´ì…˜ ì ‘ê·¼ì— ë¬¸ì œê°€ ë°œìƒ. ë¨¼ì € curlì„ ì‚¬ìš©í•˜ì—¬ node port IPë¡œ ì ‘ê·¼ web serverì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸.


ë‹¤ìŒìœ¼ë¡œ service í™•ì¸. web podì˜ ì„œë¹„ìŠ¤ë¥¼ ë°œê²¬í•˜ì˜€ëŠ”ê°€? ë°œê²¬í•˜ì§€ ëª»í–ˆë‹¤ë©´ ì„œë¹„ìŠ¤ë¥¼ describeí•˜ì—¬ endpointë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ. ì„œë¹„ìŠ¤ì— êµ¬ì„±ëœ selectorë¥¼ podì— ìˆëŠ” selectorì™€ ë¹„êµí•˜ì—¬ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸.


ë‹¤ìŒìœ¼ë¡œëŠ” pod ìì²´ í™•ì¸í•˜ê³  ì‘ë™ ì¤‘ì¸ì§€ í™•ì¸. podì˜ ìƒíƒœì™€ ì¬ì‹œì‘ íšŸìˆ˜ë¥¼ í†µí•´ podì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ ì•Œ ìˆ˜ ìˆìŒ. describe ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ podì™€ ê´€ë ¨ëœ ì´ë²¤íŠ¸ í™•ì¸. log ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¡œê·¸ í™•ì¸. ì¥ì• ë¡œ ì¸í•´ podê°€ ì¬ì‹œì‘ë˜ëŠ” ê²½ìš°, í˜„ì¬ ë²„ì „ì˜ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ ì¤‘ì¸ podì˜ ë¡œê·¸ì— ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤íŒ¨í•œ ì´ìœ ê°€ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ. ê·¸ëŸ¬ë¯€ë¡œ `-f` ì˜µì…˜ìœ¼ë¡œ podê°€ ì¬ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê±°ë‚˜ `--previous` ì˜µì…˜ìœ¼ë¡œ ì´ì „ podì˜ ë¡œê·¸ë¥¼ í™•ì¸.


ë‹¤ìŒì€ ì´ì „ì²˜ëŸ¼ DBì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ DB pod ìì²´ í™•ì¸.


[https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/)


## Practice Test - Application Failure

1. ê°„ë‹¨í•œ 2 ê³„ì¸µ ì‘ìš©í”„ë¡œê·¸ë¨ì€ alpha ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/589d7af2-3bdd-4c9c-a588-ac45518b06af/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VTWSW74F%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141322Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJGMEQCIDhJH1JwUYP9IMi4e%2FWEzrApEt3yuaxcCkfEEYKtHxxYAiA7ZVY0jDPZS8dmFrCXRPP8%2BJ0%2Bo%2FObAHK5xszSxVUcZyqIBAin%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMAGcw1YV5jSZ7GKYLKtwDwRgZ%2BsKGNWHMER47J92Bsc%2FJXllx5wOgxnR0FSaEzpSKgYlyV6GKMj%2FYDmGlIfTRBGZ5UTNlfFyYjJqihnIfzELSSrDzeUrNDCRKh52oNdDASnDKHGJlSlxrUBVRtjuOZdBS918aEH0TgqL1jE4tiFjRiyCRDZTovqM4j1nLLR3%2Blqr86Ln%2BksxJaBfdX%2BJJjDodU1cKe8nGkLTsVAMDvoEtCJ%2BZAzmxbORpZ1TpbOVRow%2FjlGxHyimpzrBfbQX%2FCRxdXIu3f%2ByDb1wsauN0JPchyeKkLcH%2BegcbMHPwfs9EZ1szYt8OoMTjPh%2By5768v8MfU4J3pI%2F0lQRMD2F9XPbEj04ZDee%2BmajnRFaWXZ6CHNGBY7%2BHn5hMsXopVDzHBcl2mqXK3p1nRUeu7Sd%2BYIoqaU6O1GrFYS3HJSc3t0yRxvFTvgWmvPX5wH3cDKSToWOrbXsFFAFrLwKebw6SPj9EqGL0Ydm5RQLJ6nGixyZYZjXe76NkLYJ8V8jxU2IQ%2F0HASQ6yJDQNYWhuv5l8EIPlJjoQ5B0Yit%2Bx1Bh8So67aFtI8Pkw1AYMV6atEwmsFoEGEQITrc4X4nqk%2Fu3hhu%2BTpyQ0VFk73tmB5XGK6u%2Fo8x%2F4OojehQtZA2Yw6p%2FfvwY6pgEz5eh77sF%2F4kHxzI8xi%2FUfjhcCkGeMNLc16gF4AH2XwalngfsUNLLGQk1fJz6EJREhtzOgXui9I4jkDtE5z%2Fs3oN6r%2FcHV%2BZYq53eg5EIxQdGMvLg1CvfAKJCsCznkbyz70vbQ8nYNz0aaRo0uNJ6PD6gIKwbwq4%2BXGzBOmhPbOxLXe7aFCu7s8ajdxIywFcpm7RcRusnYFOva5tbAKNFWIN7snVdI&X-Amz-Signature=4dffd33708b821769f7d40bdacb7b0fcf19577adb26b5e5171d0c40857ab44fe&X-Amz-SignedHeaders=host&x-id=GetObject)


    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/ae7912dd-e66e-487e-affc-c1bb880f3aaa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VTWSW74F%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141322Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJGMEQCIDhJH1JwUYP9IMi4e%2FWEzrApEt3yuaxcCkfEEYKtHxxYAiA7ZVY0jDPZS8dmFrCXRPP8%2BJ0%2Bo%2FObAHK5xszSxVUcZyqIBAin%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMAGcw1YV5jSZ7GKYLKtwDwRgZ%2BsKGNWHMER47J92Bsc%2FJXllx5wOgxnR0FSaEzpSKgYlyV6GKMj%2FYDmGlIfTRBGZ5UTNlfFyYjJqihnIfzELSSrDzeUrNDCRKh52oNdDASnDKHGJlSlxrUBVRtjuOZdBS918aEH0TgqL1jE4tiFjRiyCRDZTovqM4j1nLLR3%2Blqr86Ln%2BksxJaBfdX%2BJJjDodU1cKe8nGkLTsVAMDvoEtCJ%2BZAzmxbORpZ1TpbOVRow%2FjlGxHyimpzrBfbQX%2FCRxdXIu3f%2ByDb1wsauN0JPchyeKkLcH%2BegcbMHPwfs9EZ1szYt8OoMTjPh%2By5768v8MfU4J3pI%2F0lQRMD2F9XPbEj04ZDee%2BmajnRFaWXZ6CHNGBY7%2BHn5hMsXopVDzHBcl2mqXK3p1nRUeu7Sd%2BYIoqaU6O1GrFYS3HJSc3t0yRxvFTvgWmvPX5wH3cDKSToWOrbXsFFAFrLwKebw6SPj9EqGL0Ydm5RQLJ6nGixyZYZjXe76NkLYJ8V8jxU2IQ%2F0HASQ6yJDQNYWhuv5l8EIPlJjoQ5B0Yit%2Bx1Bh8So67aFtI8Pkw1AYMV6atEwmsFoEGEQITrc4X4nqk%2Fu3hhu%2BTpyQ0VFk73tmB5XGK6u%2Fo8x%2F4OojehQtZA2Yw6p%2FfvwY6pgEz5eh77sF%2F4kHxzI8xi%2FUfjhcCkGeMNLc16gF4AH2XwalngfsUNLLGQk1fJz6EJREhtzOgXui9I4jkDtE5z%2Fs3oN6r%2FcHV%2BZYq53eg5EIxQdGMvLg1CvfAKJCsCznkbyz70vbQ8nYNz0aaRo0uNJ6PD6gIKwbwq4%2BXGzBOmhPbOxLXe7aFCu7s8ajdxIywFcpm7RcRusnYFOva5tbAKNFWIN7snVdI&X-Amz-Signature=5c94bfa86ddb594a957d6b49ca669a4bf91a5c73d216738d9d74e928b1eaf0f6&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n alpha
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          21s
    pod/webapp-mysql-5c4c675768-5xrpw   1/1     Running   0          21s
    
    NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    
    service/mysql
             ClusterIP   10.43.134.208   <none>        3306/TCP         21s
    service/web-service   NodePort    10.43.209.34    <none>        8080:30081/TCP   21s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           21s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-5c4c675768   1         1         1       21s
    ```


    ê¸°ì¡´ì— ìƒì„±ëœ serviceì´ë¦„ì€ mysql. ì•„í‚¤í…ì²˜ì—ëŠ” mysql-serviceë¡œ ë˜ì–´ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ìˆ˜ì •.


    ```yaml
    controlplane ~ âœ  k get svc -n alpha mysql -o yaml > mysql-svc.yaml
    controlplane ~ âœ  vi mysql-svc.yaml # metadataì˜ name ìˆ˜ì •.
    controlplane ~ âœ  k delete svc -n alpha mysql
    controlplane ~ âœ  k apply -f mysql-svc.yaml
    ```

2. beta ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/cd4ebe10-dd16-4e22-9b8d-e488b94023cb/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4665NMV7A4L%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141322Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJHMEUCIChYhDzbyi0yTUHO8Dp3yAOrkzcY1y3DAYpdOLxHCDIYAiEAuvjNymDxJwv6NIKrVATI2nsn2%2Bt8vRPfh45Rqr4ewPAqiAQIp%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDCcYe365j9Zz7TqRkyrcA3ti6jP3IF0Uj9DMCWKC5D6grLMmmYwX6CS6sRSg7XR2do0jvktHGWxm80oA3h17xoLIlS%2FTO234IvcYzb0AKBHqR8ra%2B5shWW99BbhalVU0uGo8pUCIw8YPjq837VJTh5ez4hAEfW7CqB%2Fkba7836edCjPJYUNpcSYEHTFiB%2FAHphGc2DF83FdD7aW0y4TuTYC9Yn70217Kd4BzfEepWwppNOTbE8ifwkI8rVkYe5ae7lLGnBG6cQNLAnzX4Uy40I6xJpVMFWicUYDRRHRVb6QiL%2Fk2L%2B%2BXtqZtadY8yLcjmvQn8hAEFtBilQpjtvd2CDMQ6HB1g%2BnC0a3cgxCiumSGhybxtkFhOIEkPH9QjFxqxOHT3Y2LCdfSigMNMTiVAs6l1x%2Fgm5JuZyKIB2YI09KrWjBKbCCR2gjEy56FWLOHQ%2B4C1vDypx172K7xsd8a%2BYpihPj3J8kD46zhSZjvvagmPohCZupRrV3a8W2IC5ai11FIWJwomYiGJ1TS7zvvDGNQ628LPwvbipq2F3XAQkUx4k9MUr8pHS9gOcorsxhaZ7%2Bf1WJVjuYmvA3oyLPUUvhsxeNOK2FxJ%2FiMVZTPJJHDqNBumRMP8SIhR0RSPUoyGWwj3OJrD1sM1D0hMPSf378GOqUBuWVHZX7LmTNUgG8q4s5TGDjDDJHLWsnDJI1dW%2FXIeVSMOP0I9MDQ1SpGrejI%2BckdT%2B%2FLQTwV%2BWxP9HmpgOFEFXff7C2OLFBrIQyuPoZMH5uuA5gWXlkjKux%2Fi67B1MhDxcioWnv7eC6YFsMiRQGce38nBKOUtZOCPZyjvbbE%2FhgsFF9ob4RFBfK9VYTC%2BwAzrQT%2BUI6Hg0pJF9BCFEAVcLelTT7w&X-Amz-Signature=22c9c93315f2a5586f501b21407d256b445560a9498debf2e5193368431a6368&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n beta 
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          21s
    pod/webapp-mysql-5c4c675768-smch7   1/1     Running   0          21s
    
    NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.243.177   <none>        3306/TCP         21s
    service/web-service     NodePort    10.43.198.16    <none>        8080:30081/TCP   21s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           21s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-5c4c675768   1         1         1       21s
    
    controlplane ~ âœ  k describe po -n beta mysql 
    Name:             mysql
    ......
        
    Port:           3306/TCP
    
        Host Port:      0/TCP
        State:          Running
    ......
    
    controlplane ~ âœ  k describe svc -n beta mysql-service 
    Name:                     mysql-service
    Namespace:                beta
    Labels:                   <none>
    Annotations:              <none>
    Selector:                 name=mysql
    Type:                     ClusterIP
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.243.177
    IPs:                      10.43.243.177
    Port:                     <unset>  3306/TCP
    
    TargetPort:               8080/TCP
    
    Endpoints:                10.22.0.11:8080
    Session Affinity:         None
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k edit svc -n beta mysql-service # mysql podì˜ portì™€ ë¶ˆì¼ì¹˜í•˜ë¯€ë¡œ targetPort ìˆ˜ì •
    ```

3. gamma namespaceì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ë°˜ì‘í•˜ì§€ ì•Šê±°ë‚˜ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/21708f85-5d81-4c4a-8d94-3feda2068e48/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4666H2SLA6I%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJHMEUCIDM62bXFUD5s8%2F9rDfhJ%2FP%2FQbhPImfOv8sBMT%2F7ChBC0AiEAyn4eAerUFR%2FNFIgwTU1Y0Q6aGE8yBTnBjTKv4Uf0ZtYqiAQIp%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDAdoghIlncCbEwuA7ircA8%2BiNLJP4D7JY167FFJYABzdb0gd%2FreRTZwSvM6d3HdV56W7K92oJBbRS29qSUyb7GkQX53M9yuRnBYO2GvaQeckFDcLS5i3GKLqceVPKbujberVa8Eh7C9sNfioazR%2BS3U53SdgsLL%2BhLMaTfwvFFdQ36sWd1xkvtvSyX0wWVLk5RouTiWtoB6UuP51kpKwdsysP%2FKzcAqj9vFYYn5%2FpcEMO%2BaG8kufHMiMDYnz9r9CQWe7ZLXaC3PipKyUM4ng1EmNuxcQUV95EHmYaRg0BDIfBeT3s%2FhlRNfrkwSQaU0mchlz2OhzyiiCG%2BY1LQGWsSDUGQa0YkC6HdHsdTddhrIJUv9QqsPktt3ixa%2FTuNfemd7QTnoYViFj%2FInMUvqSlG5bBYOh2YcV8ACx%2FX6U9mfGaf6Dl%2BuPsNrgyy%2BZkEbf2jk%2FgFKV2tGVyCkDrfUO17qWTLcGpOjdk%2FhVjKr%2BRZaKiRivltfHaaCbQJFW2ru510oTavjkMksn2zEANGsSxeTiiYbJPhzmS3aQGB3L2yhsgxNamZsRW1sFtCuaN0CnRyUVigwPNVCmaC1D8ae6RAjSG7vC2W8%2BrYop6Nt9s2sswmfk14UoNUUhX5R9HR4%2BofrJ90o0oqdxpw%2FcMMGg378GOqUBmmSNpiyQ8Emi9loA%2FzqIa8paSQRMGSWAgOJ4zB2q1EdalewOFtw5pJjNGppl19IX%2B4dQXh5sMQes%2FrEdwCDHmmU07BTxgaodkBGvyCbOO5CA%2BpmOhjHqtjFbJpXqVKaM3YMlsDLXiYY2rZ4q7WpD9C5CAIFDjnBYyDRxY5YeB6rmrWqofjwPi2j9vlr%2BYppesGGC5Urwo3kAZFZwAznvG%2B6Yvz6x&X-Amz-Signature=9d327e588b067b97a441a9fc722529a664d911e2385547a18a33c66151893a3a&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n gamma
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          4m
    pod/webapp-mysql-5c4c675768-8ww9w   1/1     Running   0          4m
    
    NAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.84.214   <none>        3306/TCP         4m
    service/web-service     NodePort    10.43.167.25   <none>        8080:30081/TCP   4m
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           4m
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-5c4c675768   1         1         1       4m
    controlplane ~ âœ  k describe po -n gamma mysql 
    Name:             mysql
    Namespace:        gamma
    Priority:         0
    Service Account:  default
    Node:             controlplane/192.168.27.174
    Start Time:       Wed, 09 Apr 2025 03:38:24 +0000
    
    Labels:           name=mysql
    
    Annotations:      <none>
    Status:           Running
    IP:               10.22.0.15
    controlplane ~ âœ  k describe svc -n gamma mysql-service 
    Name:                     mysql-service
    Namespace:                gamma
    Labels:                   <none>
    Annotations:              <none>
    
    Selector:                 name=sql00001
    
    Type:                     ClusterIP
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.84.214
    IPs:                      10.43.84.214
    Port:                     <unset>  3306/TCP
    TargetPort:               3306/TCP
    Endpoints:                
    Session Affinity:         None
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k edit svc -n gamma mysql-service #selector ì˜¤ë¥˜
    service/mysql-service edited
    ```

4. delta ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/e2c5b54a-2cdb-4456-a5eb-c53c3ebe8c58/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4662ACLEQCV%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJIMEYCIQDalF3Huc%2F8a60O10LycdH%2FkaOUt%2F4zO48jhjBLpf9eaQIhANMuQXF3F90XVUQhiLqLCa00WwiVzqz0DDyMcGaXUFI4KogECKf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgzJIMdLGfV7xFeWglYq3AN5RWrHDUcG1SI2K3C%2BmHMbFd70nWGpzKFbUJ7eaOdmpTGFEkvUxa83KAgxP%2FQrz0zkJ6Wfs%2Ffg8sl0RPLjMksURClBam3ZfeY1mEwuiM0YMLLZZzjDei5fGXVPWYtIH5xORT2MhYDk1IuUu9ZI9rMW4jCDFZ4IDPNcepq2HzgK5AcUOXp3pWbVW1tuYMQaytGayHEET9A3PXfVB%2BA0fc1ZN0tHL3NrSB0RzX6ZR4TecrWuUFJ835oKtECkvq4rdGE7OwQNYqd38HBGhLFRb0KKjwumtxHO1FG6yHECGk5JZsyGLuSUV2FfmjNReUO0XBA6yGNxDWvRXbiqwNGLhzn%2FqV4l4JBpVmYdCnwazOrxKZ0bZcCGbWtSTyvf1JViEHDRIqUjLEOv9MVWjwdFQmhEmwceJ9piLre26ovTcxiGgOGHq2v6RXFvzii1y5Wn7BPxAj9s2YlfeabfFlEu5xRxqNR7mOyunWfTW8e%2Fmh%2Fs3rj5mbcgLyw%2F86s49uD4rrwyGm2yMUYCFQTt8%2BWCIIqW3%2Fi03DwuxjN9RygGe2RcrWBpQbC03cOTvQlDGtP%2FsuSRJXCo4NphLramoBDhbZH2tZ7c6BfN%2BTuZTURf1%2BnN7fftZAQ51cOUq%2B7JxDCooN%2B%2FBjqkARIg%2BHHqUyhT14xYJOBMmXnVYohyS0wBsvkg%2BixlTH70Hp3CXH4slCK9QwaxATmC6%2ByILRUAeS2r5tIqClRk77kmXgjcivraIkYWVpNLshN%2FnLx6iBPhODicWjHT9LZkm40vnNkM7tuKTjiPN2rPjRvQZHcwG%2BVCIzp0sNJ4TGIgSXSj9QSEvLdUuOGMOulXy868%2FTYoZKWAxXoN8JfArmm0WYwq&X-Amz-Signature=f5e39121cfcf6b1b4332be28d8f811f2a15e6ea77d738483c4209d755b561b89&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k describe deploy -n delta webapp-mysql 
    Name:                   webapp-mysql
    Namespace:              delta
    CreationTimestamp:      Wed, 09 Apr 2025 03:45:58 +0000
    Labels:                 name=webapp-mysql
    Annotations:            deployment.kubernetes.io/revision: 1
    Selector:               name=webapp-mysql
    Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
    StrategyType:           RollingUpdate
    MinReadySeconds:        0
    RollingUpdateStrategy:  25% max unavailable, 25% max surge
    Pod Template:
      Labels:  name=webapp-mysql
      Containers:
       webapp-mysql:
        Image:      mmumshad/simple-webapp-mysql
        Port:       8080/TCP
        Host Port:  0/TCP
        Environment:
          DB_Host:      mysql-service
         
     DB_User:      sql-user
    
          DB_Password:  paswrd
        Mounts:         <none>
      Volumes:          <none>
      Node-Selectors:   <none>
      Tolerations:      <none>
    Conditions:
      Type           Status  Reason
      ----           ------  ------
      Available      True    MinimumReplicasAvailable
      Progressing    True    NewReplicaSetAvailable
    OldReplicaSets:  <none>
    NewReplicaSet:   webapp-mysql-7dd5888bd4 (1/1 replicas created)
    Events:
      Type    Reason             Age   From                   Message
      ----    ------             ----  ----                   -------
      Normal  ScalingReplicaSet  74s   deployment-controller  Scaled up replica set webapp-mysql-7dd5888bd4 from 0 to 1
    
    controlplane ~ âœ  k edit deploy -n delta webapp-mysql # DB_User í™˜ê²½ë³€ìˆ˜ ê°’ ìˆ˜ì •.
    deployment.apps/webapp-mysql edited
    ```

5. epsilon ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/636892d0-f438-46e1-b54f-3b5802587e41/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VJYV4QFR%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJHMEUCIDMeJxAnyypkeRy%2B%2BoSYpmSjv1WGoZ%2FlnNMIEcpAc8x2AiEA3w3BjpSIbEcIS0c8Qs5Dgn%2Fk7aV3a%2BUz93Sv9%2FnEJY0qiAQIp%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDEUZJHKjCJZGbT8nbircA94Hh29jqLNf%2BoCE2NzESTPARqi8jQV24KtVnYJ1sPRa%2BpNtdZHmlvb93%2FpsEMGtY4VUW3eWKC11psYibqvLHIr96RC6x%2FfVUVT6LBp1rftyyM9cA%2BS%2BF4qfItJLAduGU10G18LaGYS0%2BQFT5vxblTxyEFT58mHO87B6o5rriMBuyLG%2B%2Fc6UglwLGBxZptYJ%2BN0avshkrS2%2FMhV1JpEM4pUNO3rNiKc4dia3CMKj6tvAkv2rXSnNCCsPjMF%2FSeR4QQv2eWjfEVMUQeDf9Omhs%2F5I55fO6GBvOq4jkprHTgBJm2p3Y2pI9%2BgVbaZyymphti%2FSoylsHsFiv5mreFU5WQYYSxyP1BWYzIvOKzxaHMsd0xqCCEbHQ9vIf9E0XiOWV3KK77%2Fxx%2FueHyPpLQuxLPSZ09UQPO6JXb3HuLsxzJr7ymmdGk%2F852TBquM5Q%2BYXLra2SK8NMTBi29fULUI0VdUExE%2BkrM%2BdXA%2FSZ23LVrldo0cWSQ1LEzrX1ZDaTkH5p9CFLv0PtBSN%2FFg7qiMCS5JubFQEAsFO3DJgnPBP7chqwgnAtZIjGOaooMG5IZPpxrSPLlyZBshP1sYGU3OXVG8JSDl65TUk0kEBvH4sb62wLpDEtfDFGDGGoi8oMOOf378GOqUBtLT6Es5xZ%2FwL8QuleuhBCl5ORtgDYzAKMxzwhsmtbHXDPgclV%2BJQRdm3Y5MSStkgCU3Gg3Dn1PgBY0m3b%2FBVwm1%2F8aw20BaT8ySk12h48v9StV7%2FsMrUcKArrLMZayxDypu%2BaBjzB9gBO%2FZe%2F39dNpePyjnR1625LRcFdxukOu5yEpf9rRCoVRyu291R4%2F7hx%2FNp2nCG%2Bj7Ibzy7agcHniuB07Tj&X-Amz-Signature=50541c8e7c0638803590b32ae9126b5f96be4641a4cc121b3fb4bfc6a2e8f18c&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n epsilon 
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          2m6s
    pod/webapp-mysql-7dd5888bd4-qtzl7   1/1     Running   0          2m6s
    
    NAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.78.185   <none>        3306/TCP         2m6s
    service/web-service     NodePort    10.43.198.25   <none>        8080:30081/TCP   2m6s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           2m6s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-7dd5888bd4   1         1         1       2m6s
    
    controlplane ~ âœ  k describe deploy -n epsilon webapp-mysql 
    Name:                   webapp-mysql
    Namespace:              epsilon
    CreationTimestamp:      Wed, 09 Apr 2025 03:57:47 +0000
    Labels:                 name=webapp-mysql
    Annotations:            deployment.kubernetes.io/revision: 1
    Selector:               name=webapp-mysql
    Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
    StrategyType:           RollingUpdate
    MinReadySeconds:        0
    RollingUpdateStrategy:  25% max unavailable, 25% max surge
    Pod Template:
      Labels:  name=webapp-mysql
      Containers:
       webapp-mysql:
        Image:      mmumshad/simple-webapp-mysql
        Port:       8080/TCP
        Host Port:  0/TCP
        Environment:
          DB_Host:      mysql-service
          
    DB_User:      sql-user
    
          DB_Password:  paswrd
        Mounts:         <none>
      Volumes:          <none>
      Node-Selectors:   <none>
      Tolerations:      <none>
    Conditions:
      Type           Status  Reason
      ----           ------  ------
      Available      True    MinimumReplicasAvailable
      Progressing    True    NewReplicaSetAvailable
    OldReplicaSets:  <none>
    NewReplicaSet:   webapp-mysql-7dd5888bd4 (1/1 replicas created)
    Events:
      Type    Reason             Age    From                   Message
      ----    ------             ----   ----                   -------
      Normal  ScalingReplicaSet  2m22s  deployment-controller  Scaled up replica set webapp-mysql-7dd5888bd4 from 0 to 1
    
    controlplane ~ âœ  k describe po -n epsilon mysql 
    Name:             mysql
    Namespace:        epsilon
    Priority:         0
    Service Account:  default
    Node:             controlplane/192.168.0.190
    Start Time:       Wed, 09 Apr 2025 03:57:47 +0000
    Labels:           name=mysql
    Annotations:      <none>
    Status:           Running
    IP:               10.22.0.18
    IPs:
      IP:  10.22.0.18
    Containers:
      mysql:
        Container ID:   containerd://e8cf0fb4f72b739068fea8ac395195e0f59d3c93767d4a43b1c0c2aa7e88d0e1
        Image:          mysql:5.6
        Image ID:       docker.io/library/mysql@sha256:20575ecebe6216036d25dab5903808211f1e9ba63dc7825ac20cb975e34cfcae
        Port:           3306/TCP
        Host Port:      0/TCP
        State:          Running
          Started:      Wed, 09 Apr 2025 03:57:48 +0000
        Ready:          True
        Restart Count:  0
        Environment:
          
    MYSQL_ROOT_PASSWORD:  passwooooorrddd
    
        Mounts:
          /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-4cclv (ro)
    Conditions:
      Type                        Status
      PodReadyToStartContainers   True 
      Initialized                 True 
      Ready                       True 
      ContainersReady             True 
      PodScheduled                True 
    Volumes:
      kube-api-access-4cclv:
        Type:                    Projected (a volume that contains injected data from multiple sources)
        TokenExpirationSeconds:  3607
        ConfigMapName:           kube-root-ca.crt
        ConfigMapOptional:       <nil>
        DownwardAPI:             true
    QoS Class:                   BestEffort
    Node-Selectors:              <none>
    Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
    Events:
      Type    Reason     Age    From               Message
      ----    ------     ----   ----               -------
      Normal  Scheduled  2m53s  default-scheduler  Successfully assigned epsilon/mysql to controlplane
      Normal  Pulled     2m53s  kubelet            Container image "mysql:5.6" already present on machine
      Normal  Created    2m53s  kubelet            Created container: mysql
      Normal  Started    2m52s  kubelet            Started container mysql
    controlplane ~ âœ k get po -n epsilon mysql -o yaml > mysql.yaml
    
    controlplane ~ âœ  k edit deploy -n epsilon webapp-mysql # DB_User í™˜ê²½ë³€ìˆ˜ ê°’ ìˆ˜ì •.
    deployment.apps/webapp-mysql edited
    
    controlplane ~ âœ  vi mysql.yaml # MYSQL_ROOT_PASSWORD í™˜ê²½ë³€ìˆ˜ ê°’ ìˆ˜ì •.
    
    controlplane ~ âœ  k delete po -n epsilon mysql 
    pod "mysql" deleted
    
    controlplane ~ âœ  k apply -f mysql.yaml 
    pod/mysql created
    ```

6. zeta ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![36e1a636-902a-47cc-9047-01d0b4cc6105.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/d9828d96-9f33-418b-8bb9-9839686316a5/36e1a636-902a-47cc-9047-01d0b4cc6105.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466X5CVR3U7%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141324Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJGMEQCIGR5jOlL%2Bs8sdzIb5XDp7t1vuRXhijRjzwEYp1p2BJW0AiBURCBsN3bKJ7k6TMLPzk%2FFeGXV%2FhmoLeDalbnRPiWbVyqIBAin%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMWpPgSAHaXE1nZAZdKtwDM83NXpEr1oOVF6gORRHjaaZgxk1mcBrOn6aOUsxkoXX4NwJTKIR326sAWyJoKsrPl1Ifjefmnd6TihMTT%2B2He%2FFrx9Nb%2BnlcvD9muJvaBkFdVgK9GUAbAbEwmu7cXb%2F1towq9%2FRRUhVveWL3VJlUif%2BAnWHuE9%2F1bFE0ZwlEFLayoa%2B6FGN0vzCuIOBdsLOWGxy%2B3K5fry0zYDPfuhCe4mLubbpMJ7UGu%2F3cHFgdYvJ6EiKV7rJbmbes0xM27DhrS1CbZlY6hQOuWpEUkSyURk%2B6olHgEpIBp0MB538ZrggcjT7uliKJ5Ro0xRPOiVLEw8nM2lxY%2F7XCS0jpQNEENnhiJXMirKGhNIuzKrHa7RKqHkFCIRD0lgQTJK9rXWEMoYVPChEvanxVf4Sn3VybmCBRMA%2FPaPmsO%2F%2BT7KqaRNO%2BgNKceRx4X35kq4xMXDtch7X6swN52B1L18NwlD%2BBDqCuLV8R%2BaPtu8jzgdaMcr6mgpIybxFwVmhPoEvMmsJe61fi56pH155Neis3qAaXjn3LBaMcc4dFL1rq7%2BTrt1kSCc5B%2BB3jicRcExDa9P6IKcJcBPbt%2B8C7aFzNOTOM7ZerpjsbgzRSVKPKN%2BwK3Oc8gcYTpjU6YWo%2BEIAwyqDfvwY6pgFfLgxIdcQ2SdWt0%2BcjIMcqLvOsIMF69ZiUeoxc7o6IZPlIsWrosx%2BLle7DuWDy7ahMaEmTQ5lZCOOVgEVgG5kHL%2BhK0xtDXyOSnZLWP4eqH1Q5xgNWUvFJnP9FRtFW9TO9%2FiOEsXb6FrZLS7jFyyCaxsdvgSLQBE3vMpwqlzcnTAmzGqe2ZSgjUlyOhLGC0v4Ob1NeCqVCLJYTJBmTDbLK9oQBVslY&X-Amz-Signature=06bb0221daa2155dbb2d3d86f6b5ecc56e45848b77d0dab9ceda2bcdb342c5a9&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n zeta 
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          116s
    pod/webapp-mysql-7dd5888bd4-4fc56   1/1     Running   0          116s
    
    NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.110.154   <none>        3306/TCP         116s
    service/web-service     NodePort    10.43.163.116   <none>        8080:30088/TCP   116s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           116s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-7dd5888bd4   1         1         1       116s
    
    controlplane ~ âœ  k describe svc -n zeta web-service 
    Name:                     web-service
    Namespace:                zeta
    Labels:                   <none>
    Annotations:              <none>
    Selector:                 name=webapp-mysql
    Type:                     NodePort
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.163.116
    IPs:                      10.43.163.116
    Port:                     <unset>  8080/TCP
    TargetPort:               8080/TCP
    
    NodePort:                 <unset>  30088/TCP
    
    Endpoints:                10.22.0.23:8080
    Session Affinity:         None
    External Traffic Policy:  Cluster
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k edit svc -n zeta web-service # NodePortë²ˆí˜¸ ìˆ˜ì •.
    service/web-service edited
    ```


    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/ed76229c-cea3-4635-a7f0-f6ffa62d9fc2/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466X5CVR3U7%2F20250410%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250410T141324Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEC4aCXVzLXdlc3QtMiJGMEQCIGR5jOlL%2Bs8sdzIb5XDp7t1vuRXhijRjzwEYp1p2BJW0AiBURCBsN3bKJ7k6TMLPzk%2FFeGXV%2FhmoLeDalbnRPiWbVyqIBAin%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMWpPgSAHaXE1nZAZdKtwDM83NXpEr1oOVF6gORRHjaaZgxk1mcBrOn6aOUsxkoXX4NwJTKIR326sAWyJoKsrPl1Ifjefmnd6TihMTT%2B2He%2FFrx9Nb%2BnlcvD9muJvaBkFdVgK9GUAbAbEwmu7cXb%2F1towq9%2FRRUhVveWL3VJlUif%2BAnWHuE9%2F1bFE0ZwlEFLayoa%2B6FGN0vzCuIOBdsLOWGxy%2B3K5fry0zYDPfuhCe4mLubbpMJ7UGu%2F3cHFgdYvJ6EiKV7rJbmbes0xM27DhrS1CbZlY6hQOuWpEUkSyURk%2B6olHgEpIBp0MB538ZrggcjT7uliKJ5Ro0xRPOiVLEw8nM2lxY%2F7XCS0jpQNEENnhiJXMirKGhNIuzKrHa7RKqHkFCIRD0lgQTJK9rXWEMoYVPChEvanxVf4Sn3VybmCBRMA%2FPaPmsO%2F%2BT7KqaRNO%2BgNKceRx4X35kq4xMXDtch7X6swN52B1L18NwlD%2BBDqCuLV8R%2BaPtu8jzgdaMcr6mgpIybxFwVmhPoEvMmsJe61fi56pH155Neis3qAaXjn3LBaMcc4dFL1rq7%2BTrt1kSCc5B%2BB3jicRcExDa9P6IKcJcBPbt%2B8C7aFzNOTOM7ZerpjsbgzRSVKPKN%2BwK3Oc8gcYTpjU6YWo%2BEIAwyqDfvwY6pgFfLgxIdcQ2SdWt0%2BcjIMcqLvOsIMF69ZiUeoxc7o6IZPlIsWrosx%2BLle7DuWDy7ahMaEmTQ5lZCOOVgEVgG5kHL%2BhK0xtDXyOSnZLWP4eqH1Q5xgNWUvFJnP9FRtFW9TO9%2FiOEsXb6FrZLS7jFyyCaxsdvgSLQBE3vMpwqlzcnTAmzGqe2ZSgjUlyOhLGC0v4Ob1NeCqVCLJYTJBmTDbLK9oQBVslY&X-Amz-Signature=91f50c1932bd9264662b4f2278b642323605e0012f468d572b3f5872576a59cb&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k describe deploy -n zeta webapp-mysql 
    Name:                   webapp-mysql
    Namespace:              zeta
    CreationTimestamp:      Wed, 09 Apr 2025 04:09:24 +0000
    Labels:                 name=webapp-mysql
    Annotations:            deployment.kubernetes.io/revision: 1
    Selector:               name=webapp-mysql
    Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
    StrategyType:           RollingUpdate
    MinReadySeconds:        0
    RollingUpdateStrategy:  25% max unavailable, 25% max surge
    Pod Template:
      Labels:  name=webapp-mysql
      Containers:
       webapp-mysql:
        Image:      mmumshad/simple-webapp-mysql
        Port:       8080/TCP
        Host Port:  0/TCP
        Environment:
          DB_Host:      mysql-service
          DB_User:      sql-user
          DB_Password:  paswrd
        Mounts:         <none>
      Volumes:          <none>
      Node-Selectors:   <none>
      Tolerations:      <none>
    Conditions:
      Type           Status  Reason
      ----           ------  ------
      Available      True    MinimumReplicasAvailable
      Progressing    True    NewReplicaSetAvailable
    OldReplicaSets:  <none>
    NewReplicaSet:   webapp-mysql-7dd5888bd4 (1/1 replicas created)
    Events:
      Type    Reason             Age    From                   Message
      ----    ------             ----   ----                   -------
      Normal  ScalingReplicaSet  4m17s  deployment-controller  Scaled up replica set webapp-mysql-7dd5888bd4 from 0 to 1
    
    controlplane ~ âœ  k edit deploy -n zeta webapp-mysql # DB_User í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •. 
    deployment.apps/webapp-mysql edited
    
    controlplane ~ âœ  k describe svc -n zeta mysql-service 
    Name:                     mysql-service
    Namespace:                zeta
    Labels:                   <none>
    Annotations:              <none>
    Selector:                 name=mysql
    Type:                     ClusterIP
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.110.154
    IPs:                      10.43.110.154
    Port:                     <unset>  3306/TCP
    TargetPort:               3306/TCP
    Endpoints:                10.22.0.22:3306
    Session Affinity:         None
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k describe po -n zeta mysql 
    Name:             mysql
    Namespace:        zeta
    Priority:         0
    Service Account:  default
    Node:             controlplane/192.168.0.190
    Start Time:       Wed, 09 Apr 2025 04:09:24 +0000
    Labels:           name=mysql
    Annotations:      <none>
    Status:           Running
    IP:               10.22.0.22
    IPs:
      IP:  10.22.0.22
    Containers:
      mysql:
        Container ID:   containerd://28fbc8ee55aad069ba3d4cfdd17c9a328b4ae916f3d3c5a4c17e3b6dba4e5d30
        Image:          mysql:5.6
        Image ID:       docker.io/library/mysql@sha256:20575ecebe6216036d25dab5903808211f1e9ba63dc7825ac20cb975e34cfcae
        Port:           3306/TCP
        Host Port:      0/TCP
        State:          Running
          Started:      Wed, 09 Apr 2025 04:09:25 +0000
        Ready:          True
        Restart Count:  0
        Environment:
          
    MYSQL_ROOT_PASSWORD:  passwooooorrddd
    
        Mounts:
          /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-tcq84 (ro)
    Conditions:
      Type                        Status
      PodReadyToStartContainers   True 
      Initialized                 True 
      Ready                       True 
      ContainersReady             True 
      PodScheduled                True 
    Volumes:
      kube-api-access-tcq84:
        Type:                    Projected (a volume that contains injected data from multiple sources)
        TokenExpirationSeconds:  3607
        ConfigMapName:           kube-root-ca.crt
        ConfigMapOptional:       <nil>
        DownwardAPI:             true
    QoS Class:                   BestEffort
    Node-Selectors:              <none>
    Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
    Events:
      Type    Reason     Age   From               Message
      ----    ------     ----  ----               -------
      Normal  Scheduled  8m7s  default-scheduler  Successfully assigned zeta/mysql to controlplane
      Normal  Pulled     8m7s  kubelet            Container image "mysql:5.6" already present on machine
      Normal  Created    8m7s  kubelet            Created container: mysql
      Normal  Started    8m7s  kubelet            Started container mysql
      
    controlplane ~ âœ  k get po -n zeta mysql -o yaml > mysql-zeta.yaml
    
    controlplane ~ âœ  vi mysql-zeta.yaml # MYSQL_ROOT_PASSWORD í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •.
    
    controlplane ~ âœ  k delete po -n zeta mysql --force
    Warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
    pod "mysql" force deleted
    
    controlplane ~ âœ  k apply -f mysql-zeta.yaml 
    pod/mysql created
    ```


## Control Plane Failure


í´ëŸ¬ìŠ¤í„°ì— ë…¸ë“œê°€ ìƒíƒœë¥¼ ì‚´í•Œìœ¼ë¡œì¨ ì‹œì‘.


í´ëŸ¬ìŠ¤í„° ìœ„ ì‹¤í–‰ ì¤‘ì¸  podì˜ ìƒíƒœ í™•ì¸.


kubeadm toolì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ë¥¼ ë°°í¬í•  ê²½ìš° controlplane êµ¬ì„± ìš”ì†Œê°€ podë¡œ ë°°í¬ë˜ì—ˆë‹¤ë©´ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ podê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸ ê°€ëŠ¥.


ì´ ê²½ìš° ì„œë¹„ìŠ¤ì™€ ê°™ì´ ì„œë¹„ìŠ¤ë¡œ ë°°í¬ë˜ì—ˆë‹¤ë©´ ë§ˆìŠ¤í„° ë…¸ë“œì˜ kube apiserver, controll manager, scheduler, worker ë…¸ë“œì˜ kubeletê³¼ kube proxy ì„œë¹„ìŠ¤ì™€ ê°™ì€ ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸.


ë‹¤ìŒìœ¼ë¡œ controlplane êµ¬ì„± ìš”ì†Œì˜ ë¡œê·¸ í™•ì¸. kubeadmì˜ ê²½ìš° controlplane êµ¬ì„±ìš”ì†Œë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” podì˜ ë¡œê·¸ë¥¼ ë³´ëŠ” ë°  `kubectl logs` ëª…ë ¹ì–´ ì‚¬ìš©. ë§ˆìŠ¤í„° ë…¸ë“œì— ê¸°ë³¸ì ìœ¼ë¡œ êµ¬ì„±ëœ ì„œë¹„ìŠ¤ì˜ ê²½ìš°, í˜¸ìŠ¤íŠ¸ ë¡œê¹… ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ ë¡œê·¸ë¥¼ í™•ì¸.


[https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/)


## Practice Test - Control Plane Failure

1. í´ëŸ¬ìŠ¤í„°ê°€ ë§ê°€ì§. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë˜ì§€ ì•ŠìŒ. ë¬¸ì œ í•´ê²°í•˜ê¸°.

    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS   ROLES           AGE   VERSION
    controlplane   Ready    control-plane   12m   v1.32.0
    
    controlplane ~ âœ  k get po
    NAME                   READY   STATUS    RESTARTS   AGE
    app-7f9667c9d9-cqtzk   0/1     Pending   0          47s
    
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS             RESTARTS     AGE
    coredns-7484cd47db-6xv8z               1/1     Running            0            12m
    coredns-7484cd47db-xmf2s               1/1     Running            0            12m
    etcd-controlplane                      1/1     Running            0            12m
    kube-apiserver-controlplane            1/1     Running            0            12m
    kube-controller-manager-controlplane   1/1     Running            0            12m
    kube-proxy-dddt8                       1/1     Running            0            12m
    kube-scheduler-controlplane            0/1     CrashLoopBackOff   3 (6s ago)   61s
    
    controlplane ~ âœ  k logs -n kube-system kube-scheduler-controlplane 
    
    controlplane ~ âœ  k describe -n kube-system po kube-scheduler-controlplane 
    Name:                 kube-scheduler-controlplane
    Namespace:            kube-system
    Priority:             2000001000
    Priority Class Name:  system-node-critical
    Node:                 controlplane/192.168.100.171
    Start Time:           Thu, 10 Apr 2025 01:49:01 +0000
    Labels:               component=kube-scheduler
                          tier=control-plane
    Annotations:          kubernetes.io/config.hash: e62b9c3ab48bb2ebb392179898b5495e
                          kubernetes.io/config.mirror: e62b9c3ab48bb2ebb392179898b5495e
                          kubernetes.io/config.seen: 2025-04-10T02:00:13.632750216Z
                          kubernetes.io/config.source: file
    Status:               Running
    SeccompProfile:       RuntimeDefault
    IP:                   192.168.100.171
    IPs:
      IP:           192.168.100.171
    Controlled By:  Node/controlplane
    Containers:
      kube-scheduler:
        Container ID:  containerd://9c127a2fd4a2d7da6d3483c512dc934a942b5f078e59b4d4024d7f332388c473
        Image:         registry.k8s.io/kube-scheduler:v1.32.0
        Image ID:      registry.k8s.io/kube-scheduler@sha256:84c998f7610b356a5eed24f801c01b273cf3e83f081f25c9b16aa8136c2cafb1
        Port:          <none>
        Host Port:     <none>
        Command:
          kube-schedulerrrr
          --authentication-kubeconfig=/etc/kubernetes/scheduler.conf
          --authorization-kubeconfig=/etc/kubernetes/scheduler.conf
          --bind-address=127.0.0.1
          --kubeconfig=/etc/kubernetes/scheduler.conf
          --leader-elect=true
        State:          Waiting
          Reason:       CrashLoopBackOff
        Last State:     Terminated
          Reason:       StartError
          Message:      failed to create containerd task: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "kube-schedulerrrr": executable file not found in $PATH: unknown
          Exit Code:    128
          Started:      Thu, 01 Jan 1970 00:00:00 +0000
          Finished:     Thu, 10 Apr 2025 02:01:21 +0000
        Ready:          False
        Restart Count:  3
        Requests:
          cpu:        100m
        Liveness:     http-get https://127.0.0.1:10259/livez delay=10s timeout=15s period=10s #success=1 #failure=8
        Readiness:    http-get https://127.0.0.1:10259/readyz delay=0s timeout=15s period=1s #success=1 #failure=3
        Startup:      http-get https://127.0.0.1:10259/livez delay=10s timeout=15s period=10s #success=1 #failure=24
        Environment:  <none>
        Mounts:
          /etc/kubernetes/scheduler.conf from kubeconfig (ro)
    Conditions:
      Type                        Status
      PodReadyToStartContainers   True 
      Initialized                 True 
      Ready                       False 
      ContainersReady             False 
      PodScheduled                True 
    Volumes:
      kubeconfig:
        Type:          HostPath (bare host directory volume)
        Path:          /etc/kubernetes/scheduler.conf
        HostPathType:  FileOrCreate
    QoS Class:         Burstable
    Node-Selectors:    <none>
    Tolerations:       :NoExecute op=Exists
    Events:
      Type     Reason   Age                From     Message
      ----     ------   ----               ----     -------
      Normal   Pulled   41s (x4 over 96s)  kubelet  Container image "registry.k8s.io/kube-scheduler:v1.32.0" already present on machine
      Normal   Created  41s (x4 over 95s)  kubelet  Created container: kube-scheduler
      
    Warning  Failed   41s (x4 over 95s)  kubelet  Error: failed to create containerd task: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "kube-schedulerrrr": executable file not found in $PATH: unknown
    
      Warning  BackOff  9s (x14 over 94s)  kubelet  Back-off restarting failed container kube-scheduler in pod kube-scheduler-controlplane_kube-system(e62b9c3ab48bb2ebb392179898b5495e)
    
    controlplane ~ âœ  ls /etc/kubernetes/manifests/
    etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml
    
    controlplane ~ âœ  vi /etc/kubernetes/manifests/kube-scheduler.yaml # command ë¶€ë¶„ ìˆ˜ì •.
    
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-7484cd47db-6xv8z               1/1     Running   0          15m
    coredns-7484cd47db-xmf2s               1/1     Running   0          15m
    etcd-controlplane                      1/1     Running   0          15m
    kube-apiserver-controlplane            1/1     Running   0          15m
    kube-controller-manager-controlplane   1/1     Running   0          15m
    kube-proxy-dddt8                       1/1     Running   0          15m
    kube-scheduler-controlplane            0/1     Running   0          2s
    ```

2. app deploymentë¥¼ pod 2ê°œë¡œ í™•ì¥.

    ```bash
    controlplane ~ âœ  k edit deploy app 
    deployment.apps/app edited
    
    controlplane ~ âœ  k get deploy
    NAME   READY   UP-TO-DATE   AVAILABLE   AGE
    app    1/2     1            1           8m24s
    ```


    replicasë¥¼ 2ë¡œ ì„¤ì •í•˜ì˜€ì§€ë§Œ podê°€ 2ê°œ ìƒì„±ë˜ì§€ëŠ” ì•ŠìŒ.

3. deploymentë¥¼ 2ë¡œ í™•ì¥í–ˆì§€ë§Œ pod ìˆ˜ê°€ ì¦ê°€í•œ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ ì•ŠìŒ. ì¡°ì‚¬í•˜ê³  ë¬¸ì œ í•´ê²°. deploymentì™€ replicasetì„ ê´€ë¦¬í•˜ëŠ” êµ¬ì„± ìš”ì†Œ ê´€ì°°.

    ```bash
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS             RESTARTS       AGE
    coredns-7484cd47db-6xv8z               1/1     Running            0              27m
    coredns-7484cd47db-xmf2s               1/1     Running            0              27m
    etcd-controlplane                      1/1     Running            0              27m
    kube-apiserver-controlplane            1/1     Running            0              27m
    kube-controller-manager-controlplane   0/1     CrashLoopBackOff   6 (4m5s ago)   9m58s
    kube-proxy-dddt8                       1/1     Running            0              27m
    kube-scheduler-controlplane            1/1     Running            0              11m
    
    controlplane ~ âœ  k logs -n kube-system kube-controller-manager-controlplane 
    I0410 02:12:07.432277       1 serving.go:386] Generated self-signed cert in-memory
    E0410 02:12:07.432378       1 run.go:72] "command failed" err="stat /etc/kubernetes/controller-manager-XXXX.conf: no such file or directory"
    
    controlplane ~ âœ  ls /etc/kubernetes/
    admin.conf               kubelet.conf  pki             super-admin.conf
    controller-manager.conf  manifests     scheduler.conf
    
    controlplane ~ âœ  vi /etc/kubernetes/manifests/kube-controller-manager.yaml # kubeconfig í”Œë˜ê·¸ ìˆ˜ì •.
    
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-7484cd47db-6xv8z               1/1     Running   0          29m
    coredns-7484cd47db-xmf2s               1/1     Running   0          29m
    etcd-controlplane                      1/1     Running   0          29m
    kube-apiserver-controlplane            1/1     Running   0          29m
    kube-controller-manager-controlplane   1/1     Running   0          29s
    kube-proxy-dddt8                       1/1     Running   0          29m
    kube-scheduler-controlplane            1/1     Running   0          13m
    
    controlplane ~ âœ  k get po
    NAME                   READY   STATUS    RESTARTS   AGE
    app-7f9667c9d9-54x7x   1/1     Running   0          13s
    app-7f9667c9d9-cqtzk   1/1     Running   0          18m
    ```

4. ìŠ¤ì¼€ì¼ë§ì— ë‹¤ì‹œ ë¬¸ì œ ë°œìƒ. deploymentë¥¼ replicas 3ìœ¼ë¡œ í™•ì¥í•˜ë ¤ê³  í–ˆì§€ë§Œ ì•ˆ ë¨.

    ```bash
    controlplane ~ âœ  k get -n kube-system po
    NAME                                   READY   STATUS             RESTARTS     AGE
    coredns-7484cd47db-6xv8z               1/1     Running            0            32m
    coredns-7484cd47db-xmf2s               1/1     Running            0            32m
    etcd-controlplane                      1/1     Running            0            32m
    kube-apiserver-controlplane            1/1     Running            0            32m
    kube-controller-manager-controlplane   0/1     CrashLoopBackOff   4 (2s ago)   101s
    kube-proxy-dddt8                       1/1     Running            0            32m
    kube-scheduler-controlplane            1/1     Running            0            17m
    
    controlplane ~ âœ  k logs -n kube-system kube-controller-manager-controlplane 
    I0410 02:21:56.220641       1 serving.go:386] Generated self-signed cert in-memory
    
    E0410 02:21:56.727556       1 run.go:72] "command failed" err="unable to load client CA provider: open /etc/kubernetes/pki/ca.crt: no such file or directory"
    
    
    controlplane ~ âœ  ls /etc/kubernetes/pki/
    apiserver.crt                 apiserver-kubelet-client.key  front-proxy-ca.key
    apiserver-etcd-client.crt     ca.crt                        front-proxy-client.crt
    apiserver-etcd-client.key     ca.key                        front-proxy-client.key
    apiserver.key                 etcd                          sa.key
    apiserver-kubelet-client.crt  front-proxy-ca.crt            sa.pub
    # hostì—ëŠ” ca.crt íŒŒì¼ì´ ìˆìŒ. ì´ê±¸ ë§ˆìš´íŠ¸í•´ì„œ ì‚¬ìš©.
    
    controlplane ~ âœ  vi /etc/kubernetes/manifests/kube-controller-manager.yaml
    # volumeMountëŠ” ë¬¸ì œê°€ ì—†ìŒ. hostpath ì˜¤ë¥˜. volumeì˜ hostpath ìˆ˜ì •.
    
    controlplane ~ âœ  k get -n kube-system po
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-7484cd47db-6xv8z               1/1     Running   0          39m
    coredns-7484cd47db-xmf2s               1/1     Running   0          39m
    etcd-controlplane                      1/1     Running   0          39m
    kube-apiserver-controlplane            1/1     Running   0          39m
    kube-controller-manager-controlplane   1/1     Running   0          40s
    kube-proxy-dddt8                       1/1     Running   0          39m
    kube-scheduler-controlplane            1/1     Running   0          23m
    
    controlplane ~ âœ  k get po
    NAME                   READY   STATUS    RESTARTS   AGE
    app-7f9667c9d9-54x7x   1/1     Running   0          10m
    app-7f9667c9d9-cqtzk   1/1     Running   0          27m
    app-7f9667c9d9-z4xrz   1/1     Running   0          26s
    ```


## Worker Node Failure


í´ëŸ¬ìŠ¤í„°ì— ë…¸ë“œ ìƒíƒœ í™•ì¸. not ready ìƒíƒœë¼ë©´ `kubectl describe` ëª…ë ¹ì–´ë¡œ node ìƒì„¸ ì •ë³´ í™•ì¸. ê° ë…¸ë“œì—ëŠ” ë…¸ë“œê°€ ì‹¤íŒ¨í•œ ì´ìœ ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆëŠ” ì¼ë ¨ì˜ ì¡°ê±´ì´ ìˆìŒ.


ìƒíƒœì— ë”°ë¼ true, false, unknownìœ¼ë¡œ ì„¤ì •ë¨. ë…¸ë“œì— ë””ìŠ¤í¬ ê³µê°„ì´ ì—†ìœ¼ë©´ out of disc í”Œë˜ê·¸ê°€ trueë¡œ ì„¤ì •ë¨. ë©”ëª¨ë¦¬ê°€ ì—†ìœ¼ë©´ memory pressureê°€ true, ë””ìŠ¤í¬ ìš©ëŸ‰ì´ ë¶€ì¡±í•˜ë©´ disc pressureê°€ true. ë„ˆë¬´ ë§ì€ í”„ë¡œì„¸ìŠ¤ê°€ ìˆìœ¼ë©´ PID pressureê°€ true. ë§ˆì§€ë§‰ìœ¼ë¡œ ì „ì²´ì ìœ¼ë¡œ healthyì´ë©´ ready í”Œë˜ê·¸ê°€ true.


worker ë…¸ë“œê°€ master ë…¸ë“œì™€ í†µì‹ ì´ ë©ˆì·„ì„ ë•Œ ì´ëŸ¬í•œ ìƒíƒœë“¤ì´ unknownìœ¼ë¡œ ì„¤ì •ë¨. lastheartbeattime í•„ë“œë¥¼ í™•ì¸í•˜ì—¬ ë…¸ë“œê°€ ì¶©ëŒí–ˆì„ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì‹œê°„ì„ í™•ì¸. ì´ëŸ° ê²½ìš° ë…¸ë“œ ìì²´ì˜ ìƒíƒœ í™•ì¸. ë…¸ë“œê°€ ì˜¨ë¼ì¸ ìƒíƒœì´ê±°ë‚˜ ì¶©ëŒí•œ ê²½ìš°.ì¶©ëŒí•œ ê²½ìš° ë°±ì—… ê°€ì ¸ì˜¤ê¸°. ë…¸ë“œì—ì„œ ê°€ëŠ¥í•œ CPU ë©”ëª¨ë¦¬ì™€ ë””ìŠ¤í¬ ê³µê°„ì„ í™•ì¸.


```bash
top

df -h
```


kubelet ìƒíƒœ í™•ì¸.


ë¬¸ì œì— ëŒ€í•œ kubelet log í™•ì¸.


kubelet ì¸ì¦ì„œ í™•ì¸. ë§Œë£Œë˜ì§€ ì•Šì•˜ëŠ”ì§€, ì˜¬ë°”ë¥¸ ê·¸ë£¹ì˜ ì¼ì›ì¸ì§€, ê·¸ë¦¬ê³  ì¸ì¦ì„œê°€ ì˜¬ë°”ë¥¸ CAì— ì˜í•´ ë°œê¸‰ë˜ì—ˆëŠ”ì§€ í™•ì¸.


## Practice Test - Worker Node Failure

1. í´ëŸ¬ìŠ¤í„° ê³ ì¹˜ê¸°.

    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS     ROLES           AGE     VERSION
    controlplane   Ready      control-plane   6m29s   v1.32.0
    node01         NotReady   <none>          5m56s   v1.32.0
    
    controlplane ~ âœ  k describe no node01 
    Name:               node01
    Roles:              <none>
    Labels:             beta.kubernetes.io/arch=amd64
                        beta.kubernetes.io/os=linux
                        kubernetes.io/arch=amd64
                        kubernetes.io/hostname=node01
                        kubernetes.io/os=linux
    Annotations:        flannel.alpha.coreos.com/backend-data: {"VNI":1,"VtepMAC":"52:c3:57:d4:e0:f1"}
                        flannel.alpha.coreos.com/backend-type: vxlan
                        flannel.alpha.coreos.com/kube-subnet-manager: true
                        flannel.alpha.coreos.com/public-ip: 192.168.193.168
                        kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/containerd/containerd.sock
                        node.alpha.kubernetes.io/ttl: 0
                        volumes.kubernetes.io/controller-managed-attach-detach: true
    CreationTimestamp:  Thu, 10 Apr 2025 02:40:35 +0000
    Taints:             node.kubernetes.io/unreachable:NoExecute
                        node.kubernetes.io/unreachable:NoSchedule
    Unschedulable:      false
    Lease:
      HolderIdentity:  node01
      AcquireTime:     <unset>
      RenewTime:       Thu, 10 Apr 2025 02:45:31 +0000
    Conditions:
      Type                 Status    LastHeartbeatTime                 LastTransitionTime                Reason              Message
      ----                 ------    -----------------                 ------------------                ------              -------
      NetworkUnavailable   False     Thu, 10 Apr 2025 02:40:40 +0000   Thu, 10 Apr 2025 02:40:40 +0000   FlannelIsUp         Flannel is running on this node
      MemoryPressure       Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      DiskPressure         Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      PIDPressure          Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      Ready                Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
    ```


    ```bash
    node01 ~ âœ  systemctl status containerd
    â— containerd.service - containerd container runtime
         Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabled)
         Active: active (running) since Thu 2025-04-10 02:39:23 UTC; 17min ago
           Docs: https://containerd.io
       Main PID: 947 (containerd)
          Tasks: 46
         Memory: 36.1M
         CGroup: /system.slice/containerd.service
                 â”œâ”€ 947 /usr/bin/containerd
                 â”œâ”€2745 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id ad16ee49a6a48b7370fa4f0f93c616a34ba22a4bd16b7d41c1ca134b0a972dce -address /run/containerd/containerd.sock
                 â””â”€2763 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id 12a38ba7e3c8eaef26110a8676d7d35d2039ea40ce36ad9d7647dd99b9a36ee7 -address /run/containerd/containerd.sock
    
    node01 ~ âœ  systemctl status kubelet
    â—‹ kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: inactive (dead) since Thu 2025-04-10 02:45:38 UTC; 7min ago
           Docs: https://kubernetes.io/docs/
        Process: 2605 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET>
       Main PID: 2605 (code=exited, status=0/SUCCESS)
       
    node01 ~ âœ  systemctl restart kubelet
    
    node01 ~ âœ  systemctl status kubelet
    â— kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: active (running) since Thu 2025-04-10 02:55:50 UTC; 20s ago
           Docs: https://kubernetes.io/docs/
       Main PID: 10423 (kubelet)
          Tasks: 23 (limit: 77143)
         Memory: 25.1M
         CGroup: /system.slice/kubelet.service
                 â””â”€10423 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --conta>
    ```

2. í´ëŸ¬ìŠ¤í„°ì— ë‹¤ì‹œ ë¬¸ì œ ìƒê¹€. ë¬¸ì œ ì¡°ì‚¬í•˜ê³  ê³ ì¹˜ê¸°.

    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS     ROLES           AGE   VERSION
    controlplane   Ready      control-plane   20m   v1.32.0
    node01         NotReady   <none>          20m   v1.32.0
    
    controlplane ~ âœ  k describe no node01 
    Name:               node01
    Roles:              <none>
    Labels:             beta.kubernetes.io/arch=amd64
                        beta.kubernetes.io/os=linux
                        kubernetes.io/arch=amd64
                        kubernetes.io/hostname=node01
                        kubernetes.io/os=linux
    Annotations:        flannel.alpha.coreos.com/backend-data: {"VNI":1,"VtepMAC":"52:c3:57:d4:e0:f1"}
                        flannel.alpha.coreos.com/backend-type: vxlan
                        flannel.alpha.coreos.com/kube-subnet-manager: true
                        flannel.alpha.coreos.com/public-ip: 192.168.193.168
                        kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/containerd/containerd.sock
                        node.alpha.kubernetes.io/ttl: 0
                        volumes.kubernetes.io/controller-managed-attach-detach: true
    CreationTimestamp:  Thu, 10 Apr 2025 02:40:35 +0000
    Taints:             node.kubernetes.io/unreachable:NoExecute
                        node.kubernetes.io/unreachable:NoSchedule
    Unschedulable:      false
    Lease:
      HolderIdentity:  node01
      AcquireTime:     <unset>
      RenewTime:       Thu, 10 Apr 2025 02:57:42 +0000
    Conditions:
      Type                 Status    LastHeartbeatTime                 LastTransitionTime                Reason              Message
      ----                 ------    -----------------                 ------------------                ------              -------
      NetworkUnavailable   False     Thu, 10 Apr 2025 02:40:40 +0000   Thu, 10 Apr 2025 02:40:40 +0000   FlannelIsUp         Flannel is running on this node
      MemoryPressure       Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      DiskPressure         Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      PIDPressure          Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      Ready                Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
    Addresses:
      InternalIP:  192.168.193.168
      Hostname:    node01
    Capacity:
      cpu:                16
      ephemeral-storage:  772706776Ki
      hugepages-1Gi:      0
      hugepages-2Mi:      0
      memory:             65838276Ki
      pods:               110
    Allocatable:
      cpu:                16
      ephemeral-storage:  712126563583
      hugepages-1Gi:      0
      hugepages-2Mi:      0
      memory:             65735876Ki
      pods:               110
    System Info:
      Machine ID:                 132e3d2451f947fe9214456160254717
      System UUID:                4f584368-3e3d-3ef3-87e6-241933a2478b
      Boot ID:                    b2f91f92-8f5d-4045-afa2-6f1609cbd289
      Kernel Version:             5.15.0-1077-gcp
      OS Image:                   Ubuntu 22.04.4 LTS
      Operating System:           linux
      Architecture:               amd64
      Container Runtime Version:  containerd://1.6.26
      Kubelet Version:            v1.32.0
      Kube-Proxy Version:         v1.32.0
    PodCIDR:                      172.17.1.0/24
    PodCIDRs:                     172.17.1.0/24
    Non-terminated Pods:          (2 in total)
      Namespace                   Name                     CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age
      ---------                   ----                     ------------  ----------  ---------------  -------------  ---
      kube-flannel                kube-flannel-ds-pnqsj    100m (0%)     0 (0%)      50Mi (0%)        0 (0%)         20m
      kube-system                 kube-proxy-cmvtk         0 (0%)        0 (0%)      0 (0%)           0 (0%)         20m
    Allocated resources:
      (Total limits may be over 100 percent, i.e., overcommitted.)
      Resource           Requests   Limits
      --------           --------   ------
      cpu                100m (0%)  0 (0%)
      memory             50Mi (0%)  0 (0%)
      ephemeral-storage  0 (0%)     0 (0%)
      hugepages-1Gi      0 (0%)     0 (0%)
      hugepages-2Mi      0 (0%)     0 (0%)
    Events:
      Type     Reason                   Age                    From             Message
      ----     ------                   ----                   ----             -------
      Normal   Starting                 20m                    kube-proxy       
      Normal   NodeAllocatableEnforced  20m                    kubelet          Updated Node Allocatable limit across pods
      Warning  InvalidDiskCapacity      20m                    kubelet          invalid capacity 0 on image filesystem
      Warning  CgroupV1                 20m                    kubelet          cgroup v1 support is in maintenance mode, please migrate to cgroup v2
    ```


    ```bash
    node01 ~ âœ  systemctl status containerd
    â— containerd.service - containerd container runtime
         Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabled)
         Active: active (running) since Thu 2025-04-10 02:39:23 UTC; 23min ago
           Docs: https://containerd.io
       Main PID: 947 (containerd)
          Tasks: 46
         Memory: 35.1M
         CGroup: /system.slice/containerd.service
                 â”œâ”€ 947 /usr/bin/containerd
                 â”œâ”€2745 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id ad16ee49a6a48b7370fa4f0f>
                 â””â”€2763 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id 12a38ba7e3c8eaef26110a86>
    
    node01 ~ âœ  systemctl status kubelet
    â— kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: activating (auto-restart) (Result: exit-code) since Thu 2025-04-10 03:02:59 UTC; 8s ago
           Docs: https://kubernetes.io/docs/
        Process: 14034 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELE>
       Main PID: 14034 (code=exited, status=1/FAILURE)
       
    node01 ~ âœ– sudo journalctl -u kubelet -f
    Apr 10 03:04:21 node01 kubelet[14756]: I0410 03:04:21.236944   14756 server.go:215] "--pod-infra-container-image will not be pruned by the image garbage collector in kubelet and should also be set in the remote runtime"
    Apr 10 03:04:21 node01 kubelet[14756]: E0410 03:04:21.238395   14756 run.go:72] "command failed" err="failed to construct kubelet dependencies: unable to load client CA file /etc/kubernetes/pki/WRONG-CA-FILE.crt: open /etc/kubernetes/pki/WRONG-CA-FILE.crt: no such file or directory"
    
    node01 ~ âœ  ls /var/lib/kubelet/
    checkpoints  cpu_manager_state  kubeadm-flags.env     pki      plugins_registry  pods
    config.yaml  device-plugins     memory_manager_state  plugins  pod-resources
    
    node01 ~ âœ  vi /var/lib/kubelet/config.yaml # x509.clientCAFile ë¶€ë¶„ ìˆ˜ì •.
    
    node01 ~ âœ  systemctl status kubelet
    â— kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: active (running) since Thu 2025-04-10 03:07:35 UTC; 6min ago
           Docs: https://kubernetes.io/docs/
       Main PID: 16591 (kubelet)
          Tasks: 23 (limit: 77143)
         Memory: 29.9M
         CGroup: /system.slice/kubelet.service
                 â””â”€16591 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf>
    ```

3. í´ëŸ¬ìŠ¤í„°ì— ë‹¤ì‹œ ë¬¸ì œ ìƒê¹€. ë¬¸ì œ ì¡°ì‚¬í•˜ê³  ê³ ì¹˜ê¸°.

    kubeletì€ ì •ìƒ ì‘ë™. ë¡œê·¸ í™•ì¸.


    ```bash
    node01 ~ âœ  sudo journalctl -u kubelet -f
    Apr 10 03:19:34 node01 kubelet[19807]: E0410 03:19:34.348346   19807 kubelet_node_status.go:108] "Unable to register node with API server" err="Post \"https://controlplane:6553/api/v1/nodes\": dial tcp 192.168.227.136:6553: connect: connection refused" node="node01"
    
    node01 ~ âœ  ls /etc/kubernetes/
    kubelet.conf  manifests  pki
    
    node01 ~ âœ  vi /etc/kubernetes/kubelet.conf 
    
    node01 ~ âœ  systemctl restart kubelet
    ```


    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS   ROLES           AGE   VERSION
    controlplane   Ready    control-plane   44m   v1.32.0
    node01         Ready    <none>          43m   v1.32.0
    ```


## Network Troubleshooting


## Practice Test - Troubleshoot Network

