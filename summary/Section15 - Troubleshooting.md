# ğŸ¨ Section15 - Troubleshooting

## Application Failure


```mermaid
graph BT
  DB@{shape: circle} ~~~ DB-Service
  DB-Service@{ shape: tri } --> WEB
  WEB@{shape: circle} --> WEB-Service
  WEB-Service@{ shape: tri } --> User@{ img: "https://img.icons8.com/?size=100&id=108652&format=png&color=000000", w: 60, h: 60}
```


ì• í”Œë¦¬ì¼€ì´ì…˜ ì ‘ê·¼ì— ë¬¸ì œê°€ ë°œìƒ. ë¨¼ì € curlì„ ì‚¬ìš©í•˜ì—¬ node port IPë¡œ ì ‘ê·¼ web serverì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸.


ë‹¤ìŒìœ¼ë¡œ service í™•ì¸. web podì˜ ì„œë¹„ìŠ¤ë¥¼ ë°œê²¬í•˜ì˜€ëŠ”ê°€? ë°œê²¬í•˜ì§€ ëª»í–ˆë‹¤ë©´ ì„œë¹„ìŠ¤ë¥¼ describeí•˜ì—¬ endpointë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ. ì„œë¹„ìŠ¤ì— êµ¬ì„±ëœ selectorë¥¼ podì— ìˆëŠ” selectorì™€ ë¹„êµí•˜ì—¬ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸.


ë‹¤ìŒìœ¼ë¡œëŠ” pod ìì²´ í™•ì¸í•˜ê³  ì‘ë™ ì¤‘ì¸ì§€ í™•ì¸. podì˜ ìƒíƒœì™€ ì¬ì‹œì‘ íšŸìˆ˜ë¥¼ í†µí•´ podì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ ì•Œ ìˆ˜ ìˆìŒ. describe ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ podì™€ ê´€ë ¨ëœ ì´ë²¤íŠ¸ í™•ì¸. log ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¡œê·¸ í™•ì¸. ì¥ì• ë¡œ ì¸í•´ podê°€ ì¬ì‹œì‘ë˜ëŠ” ê²½ìš°, í˜„ì¬ ë²„ì „ì˜ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ ì¤‘ì¸ podì˜ ë¡œê·¸ì— ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤íŒ¨í•œ ì´ìœ ê°€ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ. ê·¸ëŸ¬ë¯€ë¡œ `-f` ì˜µì…˜ìœ¼ë¡œ podê°€ ì¬ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê±°ë‚˜ `--previous` ì˜µì…˜ìœ¼ë¡œ ì´ì „ podì˜ ë¡œê·¸ë¥¼ í™•ì¸.


ë‹¤ìŒì€ ì´ì „ì²˜ëŸ¼ DBì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ DB pod ìì²´ í™•ì¸.


[https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/)


## Practice Test - Application Failure

1. ê°„ë‹¨í•œ 2 ê³„ì¸µ ì‘ìš©í”„ë¡œê·¸ë¨ì€ alpha ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/589d7af2-3bdd-4c9c-a588-ac45518b06af/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4666T5EM5FK%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141006Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBsaCXVzLXdlc3QtMiJIMEYCIQC7tP6H0idRJDSXt5spgwBnbxV4ETHIIJvZLNR%2FH2QZyQIhAKD6f7jcLLiaDtfnBAD64IONvfX%2FGe5%2Fet9M37B1wka6KogECKT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgwkohluDdiJ04X6UUMq3AMib9mxpaiM9OnyghD67dS0b0C62BJkLcp2D6zFjzeGn7YWCe%2B5UDxemyO2wqRKniueErg0R3nKtI1CbvSQi8SExca6IRQcRaSrfFrU%2BTiZnaj%2FTDFHcqqWgBY6RnskHJOiqmJGr2CLX%2FnZioZOR5NBfSz5KbFSSlvMGx6o6SksMfpuNol2ze23yC9gUBWH%2BlGj49iF44y9EISSw4JC4ucjI03%2FM%2FGwyjtnurYaAYDgcu9xn4f0dOxenqWJ9uBCc4WuXjfR06J1K%2BuG13XbvhhZDRNa3vejZ7edFJPfoVYV4ZgrlWhv5gzDE%2BR9UAmBoSRt149hucjnci7%2BcMADrxfUn7bkhrlf%2Fu9MG49zRRnD58N2T8Ma0fqDur%2FAsmOI%2Bl37t7pYcT4fPtrLFA1NOI2nsX89c7BX%2FawYBVNZSyw79MPMG93tu%2B1IHatrWacSFTrgoczXibcWSEvhuSedI8U7egpOLwjHjwyAIMTWSXG5aD5IrG2TO7lx6s3RCiHKBWxN0oOeBz1KNhAEURk%2BqtHxSVIPiXVBV2WNWyevRE3RbupbEUQT%2B%2F1TntHOg59leTLPtuOCbCP1hFrWPT3DNlKYsga4T1SXE7in6y66sfmZqycAeT5hw0eoCVyV0jCOq5PABjqkAfVZjqyVunm9YfsRSnogSSCcgyAiJ969uizLe0IahXjC6wLX2wWBz8h8gIhxrezuJhSPTSRlhL%2BEK9zt1O0rx9hXJdeArmJy5ccy00RROeeQ99kTxCyOLFZv%2Bgtxs0TpHSNQ%2FkVeWALublvTiKmO25TqulT6YVpGH338q%2Fw7mzhgMZHmrXevx3GyIQKctL3WVMvLPh2jLLPtn0Tt4%2BwOa6NXRaaV&X-Amz-Signature=8e5da4d7cbb75be5befae56520c97c2047fd6fd46cdfb9b24cc34acc00f70a63&X-Amz-SignedHeaders=host&x-id=GetObject)


    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/ae7912dd-e66e-487e-affc-c1bb880f3aaa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4666T5EM5FK%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141006Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBsaCXVzLXdlc3QtMiJIMEYCIQC7tP6H0idRJDSXt5spgwBnbxV4ETHIIJvZLNR%2FH2QZyQIhAKD6f7jcLLiaDtfnBAD64IONvfX%2FGe5%2Fet9M37B1wka6KogECKT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgwkohluDdiJ04X6UUMq3AMib9mxpaiM9OnyghD67dS0b0C62BJkLcp2D6zFjzeGn7YWCe%2B5UDxemyO2wqRKniueErg0R3nKtI1CbvSQi8SExca6IRQcRaSrfFrU%2BTiZnaj%2FTDFHcqqWgBY6RnskHJOiqmJGr2CLX%2FnZioZOR5NBfSz5KbFSSlvMGx6o6SksMfpuNol2ze23yC9gUBWH%2BlGj49iF44y9EISSw4JC4ucjI03%2FM%2FGwyjtnurYaAYDgcu9xn4f0dOxenqWJ9uBCc4WuXjfR06J1K%2BuG13XbvhhZDRNa3vejZ7edFJPfoVYV4ZgrlWhv5gzDE%2BR9UAmBoSRt149hucjnci7%2BcMADrxfUn7bkhrlf%2Fu9MG49zRRnD58N2T8Ma0fqDur%2FAsmOI%2Bl37t7pYcT4fPtrLFA1NOI2nsX89c7BX%2FawYBVNZSyw79MPMG93tu%2B1IHatrWacSFTrgoczXibcWSEvhuSedI8U7egpOLwjHjwyAIMTWSXG5aD5IrG2TO7lx6s3RCiHKBWxN0oOeBz1KNhAEURk%2BqtHxSVIPiXVBV2WNWyevRE3RbupbEUQT%2B%2F1TntHOg59leTLPtuOCbCP1hFrWPT3DNlKYsga4T1SXE7in6y66sfmZqycAeT5hw0eoCVyV0jCOq5PABjqkAfVZjqyVunm9YfsRSnogSSCcgyAiJ969uizLe0IahXjC6wLX2wWBz8h8gIhxrezuJhSPTSRlhL%2BEK9zt1O0rx9hXJdeArmJy5ccy00RROeeQ99kTxCyOLFZv%2Bgtxs0TpHSNQ%2FkVeWALublvTiKmO25TqulT6YVpGH338q%2Fw7mzhgMZHmrXevx3GyIQKctL3WVMvLPh2jLLPtn0Tt4%2BwOa6NXRaaV&X-Amz-Signature=4337be4b406455febab2ef2f6a38f2f83f4a0d5ea46749328f907383567f75c5&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n alpha
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          21s
    pod/webapp-mysql-5c4c675768-5xrpw   1/1     Running   0          21s
    
    NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    
    service/mysql
             ClusterIP   10.43.134.208   <none>        3306/TCP         21s
    service/web-service   NodePort    10.43.209.34    <none>        8080:30081/TCP   21s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           21s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-5c4c675768   1         1         1       21s
    ```


    ê¸°ì¡´ì— ìƒì„±ëœ serviceì´ë¦„ì€ mysql. ì•„í‚¤í…ì²˜ì—ëŠ” mysql-serviceë¡œ ë˜ì–´ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ìˆ˜ì •.


    ```yaml
    controlplane ~ âœ  k get svc -n alpha mysql -o yaml > mysql-svc.yaml
    controlplane ~ âœ  vi mysql-svc.yaml # metadataì˜ name ìˆ˜ì •.
    controlplane ~ âœ  k delete svc -n alpha mysql
    controlplane ~ âœ  k apply -f mysql-svc.yaml
    ```

2. beta ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/cd4ebe10-dd16-4e22-9b8d-e488b94023cb/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TSV6PL2S%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141008Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJGMEQCIAkoKH4pnL011YAA%2FuYg6bprVLFPjGQdrNpeXPP%2FKq0pAiBsYNaWxNgqzpq5WnJ%2FsIxPODut8AgBa6TP3mLZk95%2BfSqIBAil%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMbXtTF6%2Bo0qaOVKUOKtwD8zoQAYUeL6o4FOcSOZAW1m7RXhurpOnQX1ByZQPGcvyBTDwc0qLKZuwAJWIkmnmz5zKqcG4SJOdstyEDiuxYgOQzIgaYSKb7aQIzkoRwiMUo%2BOdbh9nIU6in1nOb244%2FeUJe76w4k1FWCKvYXY3xr5U9p1q6oWKF0A8jQsApvre4tWAwuuPif6F%2BijkyoFv9EITsPwCVK7t1pcRq3nKN%2F26RklFO2IEzH3hbBuZn4p0mdaPWakQwtnD2KaphGdn%2FI9Y4ZNurc7J5RzF940Ut5UPBK83nFUUCvtIuFhqdGd9UMo762nzcyZbx3MdTyTImybeH0Ab2f3iriGLb8%2Fk9HJAsetwTQ%2FIdzxgnotRZY%2BT%2Fk8YE8GYS9dimcg1YU0QdIdmjpuWoCXWih5A5zhoV7VjMifSpnObQIxcK6sjwr9QDZnvhsjjSHiz7UyPDqSkYfXUiOE61%2FG%2FadJNO1s%2BjGxljmBc6I8T%2BZUM9X%2B3pGMfjyzE%2F%2FkiYnur%2Bv1sfeip10NedkRm5Cbo3Tz23FYmJohzJaSSDFpwzas3UPYHoWYi0%2BsNqUM0jmcmqIwpDn6yxkJ8QDt9XCSg2NAsgiiR2Su5kKy%2FeEJZBKWhBj4rKJ35AOxk4FVLhcIQNXE4wpcqTwAY6pgGXA9hQyWhXH1ydDM73Nd0ypqcYW6zAU9pTexhAe7FtnNj9WEmrSFeaikYvItxhJCsnnICZJ4iGGTJ9dX3jyqxsqhSYRdKU9kgOu5LH89yUz7tmCS3ZGjjRNZpfA3A7usIpX8k96rf95yroWC3e4ScLUCTE%2F4FQ54xjbpFu8VJSpPGZIEj8YmbsWUOuRdzz5jKxtkmxX3dgNG%2BLE4i4F9FjTLtb60VA&X-Amz-Signature=fb746e2b6035741848af06dbf2b2766f18191a6d10d25ffbb699a10218cd1fd0&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n beta 
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          21s
    pod/webapp-mysql-5c4c675768-smch7   1/1     Running   0          21s
    
    NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.243.177   <none>        3306/TCP         21s
    service/web-service     NodePort    10.43.198.16    <none>        8080:30081/TCP   21s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           21s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-5c4c675768   1         1         1       21s
    
    controlplane ~ âœ  k describe po -n beta mysql 
    Name:             mysql
    ......
        
    Port:           3306/TCP
    
        Host Port:      0/TCP
        State:          Running
    ......
    
    controlplane ~ âœ  k describe svc -n beta mysql-service 
    Name:                     mysql-service
    Namespace:                beta
    Labels:                   <none>
    Annotations:              <none>
    Selector:                 name=mysql
    Type:                     ClusterIP
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.243.177
    IPs:                      10.43.243.177
    Port:                     <unset>  3306/TCP
    
    TargetPort:               8080/TCP
    
    Endpoints:                10.22.0.11:8080
    Session Affinity:         None
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k edit svc -n beta mysql-service # mysql podì˜ portì™€ ë¶ˆì¼ì¹˜í•˜ë¯€ë¡œ targetPort ìˆ˜ì •
    ```

3. gamma namespaceì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ë°˜ì‘í•˜ì§€ ì•Šê±°ë‚˜ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/21708f85-5d81-4c4a-8d94-3feda2068e48/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VKIY7NII%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141009Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJIMEYCIQDMwr6Iv%2FMG1W5LStgldEoFnP4qBi8V4xoJF4YOcTrQDAIhAJA3LWjQEDpfY3%2Bkx%2BHS7NmcGztWkHBW%2BwZJfqkqmkREKogECKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgzllNOakUgfH6Bc3BUq3AN6k7hBkjSp9Oj17AZ42N%2B%2B9hQwiyt2ol7ODpFZ0LPoCGwEziCUIhHqHwBHOnNbrDVacW%2Fr8VJUqWg%2BbhVGfqSPw5NKnVXw9ZQuGf2T44U4vX0cbrk5bs1Kt8LX%2FMKq%2FzHgOpP0l2rcwMQJ%2B26DnJs01BQRiZ3bXNlWwQvUrDVTwAcUbVwj2D3%2BOnlQF%2BSvsZXGU06XWwY9rULrV%2FLITJE9dlz8oTKdF8IunqOPylMYw2RDnRLuqJMkb%2B0xlzBfbG1tT6So5%2FnotyaN1UrWI8DERCw3%2BDSJiR9%2FX3nReKmTBpP3kIO0KmaFVPKVouaaZscCEU2%2BGgNsn9pn2VT2DhmOwcS6d03579g%2BPsqLgkq1BpxvAI38%2B0JbMXqQrDkhzyWcqmfXzXnVcG9r9KMHtL5WFpqBJvjnDN70GycEbo%2FjcIezeYFi5RK04nzN%2FoBWYA4KmK%2F5k2y6xUwkppgxdhCPf1bMskDBFgk0B%2F3s6glhitZwqXwxPh1k1nqdaeHV4HXCf7WI2qrRI5TkI2aSKqV9c%2F3pNJ6C0oQVDPPePUWc7v53q2n3mQg6N80Legtx6PzQBDuzA2PT9nwE7snWiO5KPL%2Bik8BOgjlZ%2BfUMQqc7Gp62o4J34WEv7Ko7NTC%2FyJPABjqkAVs5ydi2hUQZ5YCXvbwlKVJFAVEvAaQRK0BxxAuyTCnoKWabB8e%2BAOfq95GJfMmYZQpbVLALcDfRchBYCBCO1Fsq8U%2F93KZcMT0ZK2H5PCDfCTvTKSlxBNNl50spA4UFos%2BZtgjiEXuTvvoATCSUDkBqZJk5x2vJaij7Vjf84iwHlJL1uaQohFDtDkRTbznFIXR%2BPzlBc1SCYupiz6VX4tswSj9i&X-Amz-Signature=8a7999b1242e53ab6e74bf39370edf98ef465390680722030c627c92c425aa31&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n gamma
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          4m
    pod/webapp-mysql-5c4c675768-8ww9w   1/1     Running   0          4m
    
    NAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.84.214   <none>        3306/TCP         4m
    service/web-service     NodePort    10.43.167.25   <none>        8080:30081/TCP   4m
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           4m
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-5c4c675768   1         1         1       4m
    controlplane ~ âœ  k describe po -n gamma mysql 
    Name:             mysql
    Namespace:        gamma
    Priority:         0
    Service Account:  default
    Node:             controlplane/192.168.27.174
    Start Time:       Wed, 09 Apr 2025 03:38:24 +0000
    
    Labels:           name=mysql
    
    Annotations:      <none>
    Status:           Running
    IP:               10.22.0.15
    controlplane ~ âœ  k describe svc -n gamma mysql-service 
    Name:                     mysql-service
    Namespace:                gamma
    Labels:                   <none>
    Annotations:              <none>
    
    Selector:                 name=sql00001
    
    Type:                     ClusterIP
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.84.214
    IPs:                      10.43.84.214
    Port:                     <unset>  3306/TCP
    TargetPort:               3306/TCP
    Endpoints:                
    Session Affinity:         None
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k edit svc -n gamma mysql-service #selector ì˜¤ë¥˜
    service/mysql-service edited
    ```

4. delta ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/e2c5b54a-2cdb-4456-a5eb-c53c3ebe8c58/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SZX5XEFO%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJHMEUCIEqM0V9GmHAJIltAxLa7XRkGp6YKDonu31kprkfA8EaCAiEA3S%2BEksFVpIQ7nQSQ96wBAt%2FcXIs7Wju%2Bu1uYvELV6HoqiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDCLc9H5pOcR4Nzq7pircA7QYRLQiO47iWvsxuJCkeYF533yXgHojbbtX9%2BRlSL0oa74I4WWaw7hgJuvalFs4vPCv4c%2Fw3oeACqzTb223YFXy4kM2nbYmIF5HVbZx3yjBgCxrIbiGWS3rG%2FKeC2WVR%2F0FEUDD8T0pt1%2BlO65JmFygE0ZIuzCIdRF7HEfufj7hx3J9hLHmrM8wNrm4iXLw9Z%2BfNmAqH7rZKJfAMpDOe1ghNPaabblsZKYN8MywDbEv12Da%2FcpH9Qgvf7ogWujA4Ce%2Byrx1ED5biJ%2BTt5LlIdP4wb%2F%2BgFAlyH7l8l7TAlWcgtp7fq2dWQ1vnoNVvoRHbRokDko%2B7LXfvgBs0h6f8kd%2FmrlDkUyXIctHrYMel%2BT3rEhkt19Vfqh888eZBKEonMsSd1ouSYXCxRPwin7qL8%2BfQetpIFGrhUKdi605xGx2oXZCHWqMZGIu0Aal5dzgUc5E%2FEV58%2Faz4sSkvHXsoOYZqTuhiRZzv9eIOK2usW5aUX%2BSoL6pVXnCwwWWIbl22g9SfrLyCXjWynrJhvzp2ruP0VXD3YUT9vs03XETMzJQpsBNEhX247mEOY6PPUh8PcvqnXZ4IXJ9T7x2jXuvZZVubJx8eXQyH7XbxSsIFgPBSfXbSr6H%2Bix0EIdNMKvEk8AGOqUB0Kl6pvECOsl3ceoH0Zg7sdzNOaaaTqcG%2BNE5MtW%2BboMCYhM7KHWGvvhXYod5CR7iGm%2FXLuYP2Ni5xyqEyQFSYhBgU7Z4jk31kNij0d8JhvjtLz6MN1eL%2BcRz6%2B1jnkMFw17MVgCbHhPFlFdxpD0UPl2bZkZrChSgqxiVsuvmtFNBFtzPHRh6YiO5AGHYMZ%2FXaH9G6mW6loald9XPQk7IZTIH6b22&X-Amz-Signature=a118e84dcbb1447c5e65d2c790f35cc8ad7715b01e0a34f184ece076449b77e1&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k describe deploy -n delta webapp-mysql 
    Name:                   webapp-mysql
    Namespace:              delta
    CreationTimestamp:      Wed, 09 Apr 2025 03:45:58 +0000
    Labels:                 name=webapp-mysql
    Annotations:            deployment.kubernetes.io/revision: 1
    Selector:               name=webapp-mysql
    Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
    StrategyType:           RollingUpdate
    MinReadySeconds:        0
    RollingUpdateStrategy:  25% max unavailable, 25% max surge
    Pod Template:
      Labels:  name=webapp-mysql
      Containers:
       webapp-mysql:
        Image:      mmumshad/simple-webapp-mysql
        Port:       8080/TCP
        Host Port:  0/TCP
        Environment:
          DB_Host:      mysql-service
         
     DB_User:      sql-user
    
          DB_Password:  paswrd
        Mounts:         <none>
      Volumes:          <none>
      Node-Selectors:   <none>
      Tolerations:      <none>
    Conditions:
      Type           Status  Reason
      ----           ------  ------
      Available      True    MinimumReplicasAvailable
      Progressing    True    NewReplicaSetAvailable
    OldReplicaSets:  <none>
    NewReplicaSet:   webapp-mysql-7dd5888bd4 (1/1 replicas created)
    Events:
      Type    Reason             Age   From                   Message
      ----    ------             ----  ----                   -------
      Normal  ScalingReplicaSet  74s   deployment-controller  Scaled up replica set webapp-mysql-7dd5888bd4 from 0 to 1
    
    controlplane ~ âœ  k edit deploy -n delta webapp-mysql # DB_User í™˜ê²½ë³€ìˆ˜ ê°’ ìˆ˜ì •.
    deployment.apps/webapp-mysql edited
    ```

5. epsilon ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/636892d0-f438-46e1-b54f-3b5802587e41/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4665QTBHPZM%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJHMEUCIQC9dV1s71owJhfns8BizXT4Yzx5vXhtfegs60b6BkmWmwIgZMf4tH9uAD%2Bu0A6zKjtunjpVxXPx7F2Te2JFfKtfUV0qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDIhOpKnV%2B5hme%2BI%2FMyrcA%2BzPqoOes8X5ms4OV1AP7LHsAUst17H%2BBSNqrQr2oT%2Bw7LTR8C4vxoPnp%2BcHTFgM1f%2FoFpp5BBEqSL8RyS%2FUE%2BjIQyItnIzuPD1KI0ATmw%2FH01ipdc0YQ%2BbzXPvyhIoCeM8EmahzmUzawnbeEL1XlzDdZcdLLlXZowWi66nXQBg1Tqg4XN1UYsReJy4Hm%2Bmha5ne1ssojuIUaTMOm1%2FsxnBCP33Rv10KJqlbipxKmMqMwJKUpCnhF8eXIe7dxVihqPsRcjx7yQ3i0Cc%2FvAscJ%2BArOADgQMQFbvsV8PD1Jt6yJI3X9kqsTkKsX3W%2FZg6Eg71Btpk770njPW%2B0udeyl9S46mKaQTUd8AWG1UXe5v1Nl5xees8a05VpTyzzJxGj%2FG69P6Mb86ehtIQ9fvVPFvlWPbg6pMBWimGtLRzuB4aHEDIRmurNOihh1gq7e%2FHL81aKSc3SRhF23WzajOsLT91nfnbV0gpYQT6aH%2BgWIdPvUYXXaRRLDbQlQfxnTnW0sbUmSuPY2L8f7fi2%2B4CwNwot4Ph%2FK78jc3CHPCHkJY6JVXsQuvd8B0yuYfK1i5TgCFdr%2BkYyXLcCE0l34cW8wqDzWWFnw5ZGDhulfhKe4t3xFmhtDXCdw9%2F1ghiXMNnFk8AGOqUBc0Mhb3Z1vx%2Bb8DOd4OHxs0QsK2W5zV6Bi3EDs0MAzcKVKrHNXK12ATjYjDXXCSQinqSpDKTkE6fo3UwJn2bYj%2FpnAzqGOk%2BuB475jteaU0E4e0l%2BOxcXxPlY7KOFm7zgmtVQ8H%2Fhl2YHaFOUAx0hrIXlCWwk9wrnyuJ%2FS12XgwmTAQ6xw9t44BcbODzxu2DhXKFtOeF353Uhu5zuOlSYTNxOlzpn&X-Amz-Signature=aa6ebba999ef37f47d939fead92963d09226602557840aa6f145b2d59f8bf81a&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n epsilon 
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          2m6s
    pod/webapp-mysql-7dd5888bd4-qtzl7   1/1     Running   0          2m6s
    
    NAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.78.185   <none>        3306/TCP         2m6s
    service/web-service     NodePort    10.43.198.25   <none>        8080:30081/TCP   2m6s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           2m6s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-7dd5888bd4   1         1         1       2m6s
    
    controlplane ~ âœ  k describe deploy -n epsilon webapp-mysql 
    Name:                   webapp-mysql
    Namespace:              epsilon
    CreationTimestamp:      Wed, 09 Apr 2025 03:57:47 +0000
    Labels:                 name=webapp-mysql
    Annotations:            deployment.kubernetes.io/revision: 1
    Selector:               name=webapp-mysql
    Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
    StrategyType:           RollingUpdate
    MinReadySeconds:        0
    RollingUpdateStrategy:  25% max unavailable, 25% max surge
    Pod Template:
      Labels:  name=webapp-mysql
      Containers:
       webapp-mysql:
        Image:      mmumshad/simple-webapp-mysql
        Port:       8080/TCP
        Host Port:  0/TCP
        Environment:
          DB_Host:      mysql-service
          
    DB_User:      sql-user
    
          DB_Password:  paswrd
        Mounts:         <none>
      Volumes:          <none>
      Node-Selectors:   <none>
      Tolerations:      <none>
    Conditions:
      Type           Status  Reason
      ----           ------  ------
      Available      True    MinimumReplicasAvailable
      Progressing    True    NewReplicaSetAvailable
    OldReplicaSets:  <none>
    NewReplicaSet:   webapp-mysql-7dd5888bd4 (1/1 replicas created)
    Events:
      Type    Reason             Age    From                   Message
      ----    ------             ----   ----                   -------
      Normal  ScalingReplicaSet  2m22s  deployment-controller  Scaled up replica set webapp-mysql-7dd5888bd4 from 0 to 1
    
    controlplane ~ âœ  k describe po -n epsilon mysql 
    Name:             mysql
    Namespace:        epsilon
    Priority:         0
    Service Account:  default
    Node:             controlplane/192.168.0.190
    Start Time:       Wed, 09 Apr 2025 03:57:47 +0000
    Labels:           name=mysql
    Annotations:      <none>
    Status:           Running
    IP:               10.22.0.18
    IPs:
      IP:  10.22.0.18
    Containers:
      mysql:
        Container ID:   containerd://e8cf0fb4f72b739068fea8ac395195e0f59d3c93767d4a43b1c0c2aa7e88d0e1
        Image:          mysql:5.6
        Image ID:       docker.io/library/mysql@sha256:20575ecebe6216036d25dab5903808211f1e9ba63dc7825ac20cb975e34cfcae
        Port:           3306/TCP
        Host Port:      0/TCP
        State:          Running
          Started:      Wed, 09 Apr 2025 03:57:48 +0000
        Ready:          True
        Restart Count:  0
        Environment:
          
    MYSQL_ROOT_PASSWORD:  passwooooorrddd
    
        Mounts:
          /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-4cclv (ro)
    Conditions:
      Type                        Status
      PodReadyToStartContainers   True 
      Initialized                 True 
      Ready                       True 
      ContainersReady             True 
      PodScheduled                True 
    Volumes:
      kube-api-access-4cclv:
        Type:                    Projected (a volume that contains injected data from multiple sources)
        TokenExpirationSeconds:  3607
        ConfigMapName:           kube-root-ca.crt
        ConfigMapOptional:       <nil>
        DownwardAPI:             true
    QoS Class:                   BestEffort
    Node-Selectors:              <none>
    Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
    Events:
      Type    Reason     Age    From               Message
      ----    ------     ----   ----               -------
      Normal  Scheduled  2m53s  default-scheduler  Successfully assigned epsilon/mysql to controlplane
      Normal  Pulled     2m53s  kubelet            Container image "mysql:5.6" already present on machine
      Normal  Created    2m53s  kubelet            Created container: mysql
      Normal  Started    2m52s  kubelet            Started container mysql
    controlplane ~ âœ k get po -n epsilon mysql -o yaml > mysql.yaml
    
    controlplane ~ âœ  k edit deploy -n epsilon webapp-mysql # DB_User í™˜ê²½ë³€ìˆ˜ ê°’ ìˆ˜ì •.
    deployment.apps/webapp-mysql edited
    
    controlplane ~ âœ  vi mysql.yaml # MYSQL_ROOT_PASSWORD í™˜ê²½ë³€ìˆ˜ ê°’ ìˆ˜ì •.
    
    controlplane ~ âœ  k delete po -n epsilon mysql 
    pod "mysql" deleted
    
    controlplane ~ âœ  k apply -f mysql.yaml 
    pod/mysql created
    ```

6. zeta ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë¨. ê·¸ë¦° ì›¹ í˜ì´ì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨. app íƒ­ì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œë¥¼ í•´ê²° ë° ìˆ˜ì •.
ì£¼ì–´ì§„ ì•„í‚¤í…ì²˜ì— ê³ ì¹˜ê¸°. ì•„ë˜ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì£¼ì–´ì§„ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì‚¬ìš©. í•„ìš”ì— ë”°ë¼ ê°œì²´ë¥¼ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œ ë˜ëŠ” ì¬ìƒì„±.

    ![36e1a636-902a-47cc-9047-01d0b4cc6105.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/d9828d96-9f33-418b-8bb9-9839686316a5/36e1a636-902a-47cc-9047-01d0b4cc6105.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663YFO2PPG%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJHMEUCIFZX7bX1IKpKUDAbjIfKEQHZOT6Ufai2R8791hVMzhcyAiEA3iF29iNXQjYhAUNCzb8trx960IxYIqP8et1MQJgfrd0qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDGdPeWpNvuR8ZFnOaCrcA%2FMqkUP3VAIK28p5mPbzgGyFvsENA9sz7MR049dpYsyqJ2WitXJ2DMeHSB3QF4MlRMGtgGGzNdfTnMOzs%2BgTmohJXh9%2FbCTWeS9ND4ZDGkdNO%2FzyINp9oG9nYNVQO%2BMHUXfujGMnmtiSITfjBpSJmCRovEy7%2B7J8DbW8pW%2B5kzNqRxVb54wYuEDviNIUn8jWlP6CKphgUe6Kdo77e%2Fz3d%2FN8xfoQdBVVgqQPV0F4K7eX2%2B9bmEq2NO%2BVnVlKExa6Uh%2ByxwoZHra1atzSiCbGHvpaFOM%2BVgJdQ%2BqEMr1qEgtyF5wSRkkyaS4F%2FMGWooGWrrs7dd%2BOTYyFDpzgzhd%2B3kWXJT4DC4OAs9WXQVB%2BiwqkX%2FFBV583iUNbaLx5hb4Wkud6wa5%2BzHv%2FujDDlO6qE8WBBjJQct0M7y9uk1QAPxuQLTvUyXUfdMz3tfm4yonvWSbSB7M17IpEb6d9%2FlGlmTTrf%2Bg%2FfPA9h2poxURy3%2FkXYEvD6%2F9qPYlC3yMx6ZX0KBmyAXogfA1DJBXszSiueLvHIDdAzvf3jPdqncNWAMh%2BIM9fJK4P6%2Bto2h5O%2FX6xLJR5HXo45WLDh4qXZtNFCYxSD7KE3NU9uMPsttnGzY09fVBA03nwbmCGPky4MKbKk8AGOqUBGifj5OSfo3IJSMK3OcGCjfJ6nVagAaBTup6or6h40uOH5iziJeNCQeCixWWyqmZrzbfkhYAaEv8EAIyTV62IHePZT9g9WpQzTJEn6ZJeGp%2FP1D40N9u4ivnhBuxoavfuKTEId%2FdIK6SstSoNPa2LG5q9IphZ%2F4qfTpu2oooKcjNC%2Bi97NrImVwjS2iU%2F7vBs1TaliwnRaxoOAcvnJ5RbxbCVoch1&X-Amz-Signature=de7e856e0deb042ca3ae86eae4672035dcb35346cd8c18a6ea78ae6b0a959fba&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k get all -n zeta 
    NAME                                READY   STATUS    RESTARTS   AGE
    pod/mysql                           1/1     Running   0          116s
    pod/webapp-mysql-7dd5888bd4-4fc56   1/1     Running   0          116s
    
    NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    service/mysql-service   ClusterIP   10.43.110.154   <none>        3306/TCP         116s
    service/web-service     NodePort    10.43.163.116   <none>        8080:30088/TCP   116s
    
    NAME                           READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webapp-mysql   1/1     1            1           116s
    
    NAME                                      DESIRED   CURRENT   READY   AGE
    replicaset.apps/webapp-mysql-7dd5888bd4   1         1         1       116s
    
    controlplane ~ âœ  k describe svc -n zeta web-service 
    Name:                     web-service
    Namespace:                zeta
    Labels:                   <none>
    Annotations:              <none>
    Selector:                 name=webapp-mysql
    Type:                     NodePort
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.163.116
    IPs:                      10.43.163.116
    Port:                     <unset>  8080/TCP
    TargetPort:               8080/TCP
    
    NodePort:                 <unset>  30088/TCP
    
    Endpoints:                10.22.0.23:8080
    Session Affinity:         None
    External Traffic Policy:  Cluster
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k edit svc -n zeta web-service # NodePortë²ˆí˜¸ ìˆ˜ì •.
    service/web-service edited
    ```


    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/ed76229c-cea3-4635-a7f0-f6ffa62d9fc2/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663YFO2PPG%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJHMEUCIFZX7bX1IKpKUDAbjIfKEQHZOT6Ufai2R8791hVMzhcyAiEA3iF29iNXQjYhAUNCzb8trx960IxYIqP8et1MQJgfrd0qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDGdPeWpNvuR8ZFnOaCrcA%2FMqkUP3VAIK28p5mPbzgGyFvsENA9sz7MR049dpYsyqJ2WitXJ2DMeHSB3QF4MlRMGtgGGzNdfTnMOzs%2BgTmohJXh9%2FbCTWeS9ND4ZDGkdNO%2FzyINp9oG9nYNVQO%2BMHUXfujGMnmtiSITfjBpSJmCRovEy7%2B7J8DbW8pW%2B5kzNqRxVb54wYuEDviNIUn8jWlP6CKphgUe6Kdo77e%2Fz3d%2FN8xfoQdBVVgqQPV0F4K7eX2%2B9bmEq2NO%2BVnVlKExa6Uh%2ByxwoZHra1atzSiCbGHvpaFOM%2BVgJdQ%2BqEMr1qEgtyF5wSRkkyaS4F%2FMGWooGWrrs7dd%2BOTYyFDpzgzhd%2B3kWXJT4DC4OAs9WXQVB%2BiwqkX%2FFBV583iUNbaLx5hb4Wkud6wa5%2BzHv%2FujDDlO6qE8WBBjJQct0M7y9uk1QAPxuQLTvUyXUfdMz3tfm4yonvWSbSB7M17IpEb6d9%2FlGlmTTrf%2Bg%2FfPA9h2poxURy3%2FkXYEvD6%2F9qPYlC3yMx6ZX0KBmyAXogfA1DJBXszSiueLvHIDdAzvf3jPdqncNWAMh%2BIM9fJK4P6%2Bto2h5O%2FX6xLJR5HXo45WLDh4qXZtNFCYxSD7KE3NU9uMPsttnGzY09fVBA03nwbmCGPky4MKbKk8AGOqUBGifj5OSfo3IJSMK3OcGCjfJ6nVagAaBTup6or6h40uOH5iziJeNCQeCixWWyqmZrzbfkhYAaEv8EAIyTV62IHePZT9g9WpQzTJEn6ZJeGp%2FP1D40N9u4ivnhBuxoavfuKTEId%2FdIK6SstSoNPa2LG5q9IphZ%2F4qfTpu2oooKcjNC%2Bi97NrImVwjS2iU%2F7vBs1TaliwnRaxoOAcvnJ5RbxbCVoch1&X-Amz-Signature=5695429f3b4647b54a0af269fd395b712719836a565e407d38a5bdc467d251e9&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    controlplane ~ âœ  k describe deploy -n zeta webapp-mysql 
    Name:                   webapp-mysql
    Namespace:              zeta
    CreationTimestamp:      Wed, 09 Apr 2025 04:09:24 +0000
    Labels:                 name=webapp-mysql
    Annotations:            deployment.kubernetes.io/revision: 1
    Selector:               name=webapp-mysql
    Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
    StrategyType:           RollingUpdate
    MinReadySeconds:        0
    RollingUpdateStrategy:  25% max unavailable, 25% max surge
    Pod Template:
      Labels:  name=webapp-mysql
      Containers:
       webapp-mysql:
        Image:      mmumshad/simple-webapp-mysql
        Port:       8080/TCP
        Host Port:  0/TCP
        Environment:
          DB_Host:      mysql-service
          DB_User:      sql-user
          DB_Password:  paswrd
        Mounts:         <none>
      Volumes:          <none>
      Node-Selectors:   <none>
      Tolerations:      <none>
    Conditions:
      Type           Status  Reason
      ----           ------  ------
      Available      True    MinimumReplicasAvailable
      Progressing    True    NewReplicaSetAvailable
    OldReplicaSets:  <none>
    NewReplicaSet:   webapp-mysql-7dd5888bd4 (1/1 replicas created)
    Events:
      Type    Reason             Age    From                   Message
      ----    ------             ----   ----                   -------
      Normal  ScalingReplicaSet  4m17s  deployment-controller  Scaled up replica set webapp-mysql-7dd5888bd4 from 0 to 1
    
    controlplane ~ âœ  k edit deploy -n zeta webapp-mysql # DB_User í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •. 
    deployment.apps/webapp-mysql edited
    
    controlplane ~ âœ  k describe svc -n zeta mysql-service 
    Name:                     mysql-service
    Namespace:                zeta
    Labels:                   <none>
    Annotations:              <none>
    Selector:                 name=mysql
    Type:                     ClusterIP
    IP Family Policy:         SingleStack
    IP Families:              IPv4
    IP:                       10.43.110.154
    IPs:                      10.43.110.154
    Port:                     <unset>  3306/TCP
    TargetPort:               3306/TCP
    Endpoints:                10.22.0.22:3306
    Session Affinity:         None
    Internal Traffic Policy:  Cluster
    Events:                   <none>
    
    controlplane ~ âœ  k describe po -n zeta mysql 
    Name:             mysql
    Namespace:        zeta
    Priority:         0
    Service Account:  default
    Node:             controlplane/192.168.0.190
    Start Time:       Wed, 09 Apr 2025 04:09:24 +0000
    Labels:           name=mysql
    Annotations:      <none>
    Status:           Running
    IP:               10.22.0.22
    IPs:
      IP:  10.22.0.22
    Containers:
      mysql:
        Container ID:   containerd://28fbc8ee55aad069ba3d4cfdd17c9a328b4ae916f3d3c5a4c17e3b6dba4e5d30
        Image:          mysql:5.6
        Image ID:       docker.io/library/mysql@sha256:20575ecebe6216036d25dab5903808211f1e9ba63dc7825ac20cb975e34cfcae
        Port:           3306/TCP
        Host Port:      0/TCP
        State:          Running
          Started:      Wed, 09 Apr 2025 04:09:25 +0000
        Ready:          True
        Restart Count:  0
        Environment:
          
    MYSQL_ROOT_PASSWORD:  passwooooorrddd
    
        Mounts:
          /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-tcq84 (ro)
    Conditions:
      Type                        Status
      PodReadyToStartContainers   True 
      Initialized                 True 
      Ready                       True 
      ContainersReady             True 
      PodScheduled                True 
    Volumes:
      kube-api-access-tcq84:
        Type:                    Projected (a volume that contains injected data from multiple sources)
        TokenExpirationSeconds:  3607
        ConfigMapName:           kube-root-ca.crt
        ConfigMapOptional:       <nil>
        DownwardAPI:             true
    QoS Class:                   BestEffort
    Node-Selectors:              <none>
    Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
    Events:
      Type    Reason     Age   From               Message
      ----    ------     ----  ----               -------
      Normal  Scheduled  8m7s  default-scheduler  Successfully assigned zeta/mysql to controlplane
      Normal  Pulled     8m7s  kubelet            Container image "mysql:5.6" already present on machine
      Normal  Created    8m7s  kubelet            Created container: mysql
      Normal  Started    8m7s  kubelet            Started container mysql
      
    controlplane ~ âœ  k get po -n zeta mysql -o yaml > mysql-zeta.yaml
    
    controlplane ~ âœ  vi mysql-zeta.yaml # MYSQL_ROOT_PASSWORD í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •.
    
    controlplane ~ âœ  k delete po -n zeta mysql --force
    Warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
    pod "mysql" force deleted
    
    controlplane ~ âœ  k apply -f mysql-zeta.yaml 
    pod/mysql created
    ```


## Control Plane Failure


í´ëŸ¬ìŠ¤í„°ì— ë…¸ë“œê°€ ìƒíƒœë¥¼ ì‚´í•Œìœ¼ë¡œì¨ ì‹œì‘.


í´ëŸ¬ìŠ¤í„° ìœ„ ì‹¤í–‰ ì¤‘ì¸  podì˜ ìƒíƒœ í™•ì¸.


kubeadm toolì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ë¥¼ ë°°í¬í•  ê²½ìš° controlplane êµ¬ì„± ìš”ì†Œê°€ podë¡œ ë°°í¬ë˜ì—ˆë‹¤ë©´ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ podê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸ ê°€ëŠ¥.


ì´ ê²½ìš° ì„œë¹„ìŠ¤ì™€ ê°™ì´ ì„œë¹„ìŠ¤ë¡œ ë°°í¬ë˜ì—ˆë‹¤ë©´ ë§ˆìŠ¤í„° ë…¸ë“œì˜ kube apiserver, controll manager, scheduler, worker ë…¸ë“œì˜ kubeletê³¼ kube proxy ì„œë¹„ìŠ¤ì™€ ê°™ì€ ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸.


ë‹¤ìŒìœ¼ë¡œ controlplane êµ¬ì„± ìš”ì†Œì˜ ë¡œê·¸ í™•ì¸. kubeadmì˜ ê²½ìš° controlplane êµ¬ì„±ìš”ì†Œë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” podì˜ ë¡œê·¸ë¥¼ ë³´ëŠ” ë°  `kubectl logs` ëª…ë ¹ì–´ ì‚¬ìš©. ë§ˆìŠ¤í„° ë…¸ë“œì— ê¸°ë³¸ì ìœ¼ë¡œ êµ¬ì„±ëœ ì„œë¹„ìŠ¤ì˜ ê²½ìš°, í˜¸ìŠ¤íŠ¸ ë¡œê¹… ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ ë¡œê·¸ë¥¼ í™•ì¸.


[https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/)


## Practice Test - Control Plane Failure

1. í´ëŸ¬ìŠ¤í„°ê°€ ë§ê°€ì§. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë˜ì§€ ì•ŠìŒ. ë¬¸ì œ í•´ê²°í•˜ê¸°.

    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS   ROLES           AGE   VERSION
    controlplane   Ready    control-plane   12m   v1.32.0
    
    controlplane ~ âœ  k get po
    NAME                   READY   STATUS    RESTARTS   AGE
    app-7f9667c9d9-cqtzk   0/1     Pending   0          47s
    
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS             RESTARTS     AGE
    coredns-7484cd47db-6xv8z               1/1     Running            0            12m
    coredns-7484cd47db-xmf2s               1/1     Running            0            12m
    etcd-controlplane                      1/1     Running            0            12m
    kube-apiserver-controlplane            1/1     Running            0            12m
    kube-controller-manager-controlplane   1/1     Running            0            12m
    kube-proxy-dddt8                       1/1     Running            0            12m
    kube-scheduler-controlplane            0/1     CrashLoopBackOff   3 (6s ago)   61s
    
    controlplane ~ âœ  k logs -n kube-system kube-scheduler-controlplane 
    
    controlplane ~ âœ  k describe -n kube-system po kube-scheduler-controlplane 
    Name:                 kube-scheduler-controlplane
    Namespace:            kube-system
    Priority:             2000001000
    Priority Class Name:  system-node-critical
    Node:                 controlplane/192.168.100.171
    Start Time:           Thu, 10 Apr 2025 01:49:01 +0000
    Labels:               component=kube-scheduler
                          tier=control-plane
    Annotations:          kubernetes.io/config.hash: e62b9c3ab48bb2ebb392179898b5495e
                          kubernetes.io/config.mirror: e62b9c3ab48bb2ebb392179898b5495e
                          kubernetes.io/config.seen: 2025-04-10T02:00:13.632750216Z
                          kubernetes.io/config.source: file
    Status:               Running
    SeccompProfile:       RuntimeDefault
    IP:                   192.168.100.171
    IPs:
      IP:           192.168.100.171
    Controlled By:  Node/controlplane
    Containers:
      kube-scheduler:
        Container ID:  containerd://9c127a2fd4a2d7da6d3483c512dc934a942b5f078e59b4d4024d7f332388c473
        Image:         registry.k8s.io/kube-scheduler:v1.32.0
        Image ID:      registry.k8s.io/kube-scheduler@sha256:84c998f7610b356a5eed24f801c01b273cf3e83f081f25c9b16aa8136c2cafb1
        Port:          <none>
        Host Port:     <none>
        Command:
          kube-schedulerrrr
          --authentication-kubeconfig=/etc/kubernetes/scheduler.conf
          --authorization-kubeconfig=/etc/kubernetes/scheduler.conf
          --bind-address=127.0.0.1
          --kubeconfig=/etc/kubernetes/scheduler.conf
          --leader-elect=true
        State:          Waiting
          Reason:       CrashLoopBackOff
        Last State:     Terminated
          Reason:       StartError
          Message:      failed to create containerd task: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "kube-schedulerrrr": executable file not found in $PATH: unknown
          Exit Code:    128
          Started:      Thu, 01 Jan 1970 00:00:00 +0000
          Finished:     Thu, 10 Apr 2025 02:01:21 +0000
        Ready:          False
        Restart Count:  3
        Requests:
          cpu:        100m
        Liveness:     http-get https://127.0.0.1:10259/livez delay=10s timeout=15s period=10s #success=1 #failure=8
        Readiness:    http-get https://127.0.0.1:10259/readyz delay=0s timeout=15s period=1s #success=1 #failure=3
        Startup:      http-get https://127.0.0.1:10259/livez delay=10s timeout=15s period=10s #success=1 #failure=24
        Environment:  <none>
        Mounts:
          /etc/kubernetes/scheduler.conf from kubeconfig (ro)
    Conditions:
      Type                        Status
      PodReadyToStartContainers   True 
      Initialized                 True 
      Ready                       False 
      ContainersReady             False 
      PodScheduled                True 
    Volumes:
      kubeconfig:
        Type:          HostPath (bare host directory volume)
        Path:          /etc/kubernetes/scheduler.conf
        HostPathType:  FileOrCreate
    QoS Class:         Burstable
    Node-Selectors:    <none>
    Tolerations:       :NoExecute op=Exists
    Events:
      Type     Reason   Age                From     Message
      ----     ------   ----               ----     -------
      Normal   Pulled   41s (x4 over 96s)  kubelet  Container image "registry.k8s.io/kube-scheduler:v1.32.0" already present on machine
      Normal   Created  41s (x4 over 95s)  kubelet  Created container: kube-scheduler
      
    Warning  Failed   41s (x4 over 95s)  kubelet  Error: failed to create containerd task: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "kube-schedulerrrr": executable file not found in $PATH: unknown
    
      Warning  BackOff  9s (x14 over 94s)  kubelet  Back-off restarting failed container kube-scheduler in pod kube-scheduler-controlplane_kube-system(e62b9c3ab48bb2ebb392179898b5495e)
    
    controlplane ~ âœ  ls /etc/kubernetes/manifests/
    etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml
    
    controlplane ~ âœ  vi /etc/kubernetes/manifests/kube-scheduler.yaml # command ë¶€ë¶„ ìˆ˜ì •.
    
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-7484cd47db-6xv8z               1/1     Running   0          15m
    coredns-7484cd47db-xmf2s               1/1     Running   0          15m
    etcd-controlplane                      1/1     Running   0          15m
    kube-apiserver-controlplane            1/1     Running   0          15m
    kube-controller-manager-controlplane   1/1     Running   0          15m
    kube-proxy-dddt8                       1/1     Running   0          15m
    kube-scheduler-controlplane            0/1     Running   0          2s
    ```

2. app deploymentë¥¼ pod 2ê°œë¡œ í™•ì¥.

    ```bash
    controlplane ~ âœ  k edit deploy app 
    deployment.apps/app edited
    
    controlplane ~ âœ  k get deploy
    NAME   READY   UP-TO-DATE   AVAILABLE   AGE
    app    1/2     1            1           8m24s
    ```


    replicasë¥¼ 2ë¡œ ì„¤ì •í•˜ì˜€ì§€ë§Œ podê°€ 2ê°œ ìƒì„±ë˜ì§€ëŠ” ì•ŠìŒ.

3. deploymentë¥¼ 2ë¡œ í™•ì¥í–ˆì§€ë§Œ pod ìˆ˜ê°€ ì¦ê°€í•œ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ ì•ŠìŒ. ì¡°ì‚¬í•˜ê³  ë¬¸ì œ í•´ê²°. deploymentì™€ replicasetì„ ê´€ë¦¬í•˜ëŠ” êµ¬ì„± ìš”ì†Œ ê´€ì°°.

    ```bash
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS             RESTARTS       AGE
    coredns-7484cd47db-6xv8z               1/1     Running            0              27m
    coredns-7484cd47db-xmf2s               1/1     Running            0              27m
    etcd-controlplane                      1/1     Running            0              27m
    kube-apiserver-controlplane            1/1     Running            0              27m
    kube-controller-manager-controlplane   0/1     CrashLoopBackOff   6 (4m5s ago)   9m58s
    kube-proxy-dddt8                       1/1     Running            0              27m
    kube-scheduler-controlplane            1/1     Running            0              11m
    
    controlplane ~ âœ  k logs -n kube-system kube-controller-manager-controlplane 
    I0410 02:12:07.432277       1 serving.go:386] Generated self-signed cert in-memory
    E0410 02:12:07.432378       1 run.go:72] "command failed" err="stat /etc/kubernetes/controller-manager-XXXX.conf: no such file or directory"
    
    controlplane ~ âœ  ls /etc/kubernetes/
    admin.conf               kubelet.conf  pki             super-admin.conf
    controller-manager.conf  manifests     scheduler.conf
    
    controlplane ~ âœ  vi /etc/kubernetes/manifests/kube-controller-manager.yaml # kubeconfig í”Œë˜ê·¸ ìˆ˜ì •.
    
    controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-7484cd47db-6xv8z               1/1     Running   0          29m
    coredns-7484cd47db-xmf2s               1/1     Running   0          29m
    etcd-controlplane                      1/1     Running   0          29m
    kube-apiserver-controlplane            1/1     Running   0          29m
    kube-controller-manager-controlplane   1/1     Running   0          29s
    kube-proxy-dddt8                       1/1     Running   0          29m
    kube-scheduler-controlplane            1/1     Running   0          13m
    
    controlplane ~ âœ  k get po
    NAME                   READY   STATUS    RESTARTS   AGE
    app-7f9667c9d9-54x7x   1/1     Running   0          13s
    app-7f9667c9d9-cqtzk   1/1     Running   0          18m
    ```

4. ìŠ¤ì¼€ì¼ë§ì— ë‹¤ì‹œ ë¬¸ì œ ë°œìƒ. deploymentë¥¼ replicas 3ìœ¼ë¡œ í™•ì¥í•˜ë ¤ê³  í–ˆì§€ë§Œ ì•ˆ ë¨.

    ```bash
    controlplane ~ âœ  k get -n kube-system po
    NAME                                   READY   STATUS             RESTARTS     AGE
    coredns-7484cd47db-6xv8z               1/1     Running            0            32m
    coredns-7484cd47db-xmf2s               1/1     Running            0            32m
    etcd-controlplane                      1/1     Running            0            32m
    kube-apiserver-controlplane            1/1     Running            0            32m
    kube-controller-manager-controlplane   0/1     CrashLoopBackOff   4 (2s ago)   101s
    kube-proxy-dddt8                       1/1     Running            0            32m
    kube-scheduler-controlplane            1/1     Running            0            17m
    
    controlplane ~ âœ  k logs -n kube-system kube-controller-manager-controlplane 
    I0410 02:21:56.220641       1 serving.go:386] Generated self-signed cert in-memory
    
    E0410 02:21:56.727556       1 run.go:72] "command failed" err="unable to load client CA provider: open /etc/kubernetes/pki/ca.crt: no such file or directory"
    
    
    controlplane ~ âœ  ls /etc/kubernetes/pki/
    apiserver.crt                 apiserver-kubelet-client.key  front-proxy-ca.key
    apiserver-etcd-client.crt     ca.crt                        front-proxy-client.crt
    apiserver-etcd-client.key     ca.key                        front-proxy-client.key
    apiserver.key                 etcd                          sa.key
    apiserver-kubelet-client.crt  front-proxy-ca.crt            sa.pub
    # hostì—ëŠ” ca.crt íŒŒì¼ì´ ìˆìŒ. ì´ê±¸ ë§ˆìš´íŠ¸í•´ì„œ ì‚¬ìš©.
    
    controlplane ~ âœ  vi /etc/kubernetes/manifests/kube-controller-manager.yaml
    # volumeMountëŠ” ë¬¸ì œê°€ ì—†ìŒ. hostpath ì˜¤ë¥˜. volumeì˜ hostpath ìˆ˜ì •.
    
    controlplane ~ âœ  k get -n kube-system po
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-7484cd47db-6xv8z               1/1     Running   0          39m
    coredns-7484cd47db-xmf2s               1/1     Running   0          39m
    etcd-controlplane                      1/1     Running   0          39m
    kube-apiserver-controlplane            1/1     Running   0          39m
    kube-controller-manager-controlplane   1/1     Running   0          40s
    kube-proxy-dddt8                       1/1     Running   0          39m
    kube-scheduler-controlplane            1/1     Running   0          23m
    
    controlplane ~ âœ  k get po
    NAME                   READY   STATUS    RESTARTS   AGE
    app-7f9667c9d9-54x7x   1/1     Running   0          10m
    app-7f9667c9d9-cqtzk   1/1     Running   0          27m
    app-7f9667c9d9-z4xrz   1/1     Running   0          26s
    ```


## Worker Node Failure


í´ëŸ¬ìŠ¤í„°ì— ë…¸ë“œ ìƒíƒœ í™•ì¸. not ready ìƒíƒœë¼ë©´ `kubectl describe` ëª…ë ¹ì–´ë¡œ node ìƒì„¸ ì •ë³´ í™•ì¸. ê° ë…¸ë“œì—ëŠ” ë…¸ë“œê°€ ì‹¤íŒ¨í•œ ì´ìœ ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆëŠ” ì¼ë ¨ì˜ ì¡°ê±´ì´ ìˆìŒ.


ìƒíƒœì— ë”°ë¼ true, false, unknownìœ¼ë¡œ ì„¤ì •ë¨. ë…¸ë“œì— ë””ìŠ¤í¬ ê³µê°„ì´ ì—†ìœ¼ë©´ out of disc í”Œë˜ê·¸ê°€ trueë¡œ ì„¤ì •ë¨. ë©”ëª¨ë¦¬ê°€ ì—†ìœ¼ë©´ memory pressureê°€ true, ë””ìŠ¤í¬ ìš©ëŸ‰ì´ ë¶€ì¡±í•˜ë©´ disc pressureê°€ true. ë„ˆë¬´ ë§ì€ í”„ë¡œì„¸ìŠ¤ê°€ ìˆìœ¼ë©´ PID pressureê°€ true. ë§ˆì§€ë§‰ìœ¼ë¡œ ì „ì²´ì ìœ¼ë¡œ healthyì´ë©´ ready í”Œë˜ê·¸ê°€ true.


worker ë…¸ë“œê°€ master ë…¸ë“œì™€ í†µì‹ ì´ ë©ˆì·„ì„ ë•Œ ì´ëŸ¬í•œ ìƒíƒœë“¤ì´ unknownìœ¼ë¡œ ì„¤ì •ë¨. lastheartbeattime í•„ë“œë¥¼ í™•ì¸í•˜ì—¬ ë…¸ë“œê°€ ì¶©ëŒí–ˆì„ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì‹œê°„ì„ í™•ì¸. ì´ëŸ° ê²½ìš° ë…¸ë“œ ìì²´ì˜ ìƒíƒœ í™•ì¸. ë…¸ë“œê°€ ì˜¨ë¼ì¸ ìƒíƒœì´ê±°ë‚˜ ì¶©ëŒí•œ ê²½ìš°.ì¶©ëŒí•œ ê²½ìš° ë°±ì—… ê°€ì ¸ì˜¤ê¸°. ë…¸ë“œì—ì„œ ê°€ëŠ¥í•œ CPU ë©”ëª¨ë¦¬ì™€ ë””ìŠ¤í¬ ê³µê°„ì„ í™•ì¸.


```bash
top

df -h
```


kubelet ìƒíƒœ í™•ì¸.


ë¬¸ì œì— ëŒ€í•œ kubelet log í™•ì¸.


kubelet ì¸ì¦ì„œ í™•ì¸. ë§Œë£Œë˜ì§€ ì•Šì•˜ëŠ”ì§€, ì˜¬ë°”ë¥¸ ê·¸ë£¹ì˜ ì¼ì›ì¸ì§€, ê·¸ë¦¬ê³  ì¸ì¦ì„œê°€ ì˜¬ë°”ë¥¸ CAì— ì˜í•´ ë°œê¸‰ë˜ì—ˆëŠ”ì§€ í™•ì¸.


## Practice Test - Worker Node Failure

1. í´ëŸ¬ìŠ¤í„° ê³ ì¹˜ê¸°.

    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS     ROLES           AGE     VERSION
    controlplane   Ready      control-plane   6m29s   v1.32.0
    node01         NotReady   <none>          5m56s   v1.32.0
    
    controlplane ~ âœ  k describe no node01 
    Name:               node01
    Roles:              <none>
    Labels:             beta.kubernetes.io/arch=amd64
                        beta.kubernetes.io/os=linux
                        kubernetes.io/arch=amd64
                        kubernetes.io/hostname=node01
                        kubernetes.io/os=linux
    Annotations:        flannel.alpha.coreos.com/backend-data: {"VNI":1,"VtepMAC":"52:c3:57:d4:e0:f1"}
                        flannel.alpha.coreos.com/backend-type: vxlan
                        flannel.alpha.coreos.com/kube-subnet-manager: true
                        flannel.alpha.coreos.com/public-ip: 192.168.193.168
                        kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/containerd/containerd.sock
                        node.alpha.kubernetes.io/ttl: 0
                        volumes.kubernetes.io/controller-managed-attach-detach: true
    CreationTimestamp:  Thu, 10 Apr 2025 02:40:35 +0000
    Taints:             node.kubernetes.io/unreachable:NoExecute
                        node.kubernetes.io/unreachable:NoSchedule
    Unschedulable:      false
    Lease:
      HolderIdentity:  node01
      AcquireTime:     <unset>
      RenewTime:       Thu, 10 Apr 2025 02:45:31 +0000
    Conditions:
      Type                 Status    LastHeartbeatTime                 LastTransitionTime                Reason              Message
      ----                 ------    -----------------                 ------------------                ------              -------
      NetworkUnavailable   False     Thu, 10 Apr 2025 02:40:40 +0000   Thu, 10 Apr 2025 02:40:40 +0000   FlannelIsUp         Flannel is running on this node
      MemoryPressure       Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      DiskPressure         Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      PIDPressure          Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      Ready                Unknown   Thu, 10 Apr 2025 02:44:39 +0000   Thu, 10 Apr 2025 02:46:25 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
    ```


    ```bash
    node01 ~ âœ  systemctl status containerd
    â— containerd.service - containerd container runtime
         Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabled)
         Active: active (running) since Thu 2025-04-10 02:39:23 UTC; 17min ago
           Docs: https://containerd.io
       Main PID: 947 (containerd)
          Tasks: 46
         Memory: 36.1M
         CGroup: /system.slice/containerd.service
                 â”œâ”€ 947 /usr/bin/containerd
                 â”œâ”€2745 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id ad16ee49a6a48b7370fa4f0f93c616a34ba22a4bd16b7d41c1ca134b0a972dce -address /run/containerd/containerd.sock
                 â””â”€2763 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id 12a38ba7e3c8eaef26110a8676d7d35d2039ea40ce36ad9d7647dd99b9a36ee7 -address /run/containerd/containerd.sock
    
    node01 ~ âœ  systemctl status kubelet
    â—‹ kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: inactive (dead) since Thu 2025-04-10 02:45:38 UTC; 7min ago
           Docs: https://kubernetes.io/docs/
        Process: 2605 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET>
       Main PID: 2605 (code=exited, status=0/SUCCESS)
       
    node01 ~ âœ  systemctl restart kubelet
    
    node01 ~ âœ  systemctl status kubelet
    â— kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: active (running) since Thu 2025-04-10 02:55:50 UTC; 20s ago
           Docs: https://kubernetes.io/docs/
       Main PID: 10423 (kubelet)
          Tasks: 23 (limit: 77143)
         Memory: 25.1M
         CGroup: /system.slice/kubelet.service
                 â””â”€10423 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --conta>
    ```

2. í´ëŸ¬ìŠ¤í„°ì— ë‹¤ì‹œ ë¬¸ì œ ìƒê¹€. ë¬¸ì œ ì¡°ì‚¬í•˜ê³  ê³ ì¹˜ê¸°.

    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS     ROLES           AGE   VERSION
    controlplane   Ready      control-plane   20m   v1.32.0
    node01         NotReady   <none>          20m   v1.32.0
    
    controlplane ~ âœ  k describe no node01 
    Name:               node01
    Roles:              <none>
    Labels:             beta.kubernetes.io/arch=amd64
                        beta.kubernetes.io/os=linux
                        kubernetes.io/arch=amd64
                        kubernetes.io/hostname=node01
                        kubernetes.io/os=linux
    Annotations:        flannel.alpha.coreos.com/backend-data: {"VNI":1,"VtepMAC":"52:c3:57:d4:e0:f1"}
                        flannel.alpha.coreos.com/backend-type: vxlan
                        flannel.alpha.coreos.com/kube-subnet-manager: true
                        flannel.alpha.coreos.com/public-ip: 192.168.193.168
                        kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/containerd/containerd.sock
                        node.alpha.kubernetes.io/ttl: 0
                        volumes.kubernetes.io/controller-managed-attach-detach: true
    CreationTimestamp:  Thu, 10 Apr 2025 02:40:35 +0000
    Taints:             node.kubernetes.io/unreachable:NoExecute
                        node.kubernetes.io/unreachable:NoSchedule
    Unschedulable:      false
    Lease:
      HolderIdentity:  node01
      AcquireTime:     <unset>
      RenewTime:       Thu, 10 Apr 2025 02:57:42 +0000
    Conditions:
      Type                 Status    LastHeartbeatTime                 LastTransitionTime                Reason              Message
      ----                 ------    -----------------                 ------------------                ------              -------
      NetworkUnavailable   False     Thu, 10 Apr 2025 02:40:40 +0000   Thu, 10 Apr 2025 02:40:40 +0000   FlannelIsUp         Flannel is running on this node
      MemoryPressure       Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      DiskPressure         Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      PIDPressure          Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
      Ready                Unknown   Thu, 10 Apr 2025 02:55:50 +0000   Thu, 10 Apr 2025 02:58:35 +0000   NodeStatusUnknown   Kubelet stopped posting node status.
    Addresses:
      InternalIP:  192.168.193.168
      Hostname:    node01
    Capacity:
      cpu:                16
      ephemeral-storage:  772706776Ki
      hugepages-1Gi:      0
      hugepages-2Mi:      0
      memory:             65838276Ki
      pods:               110
    Allocatable:
      cpu:                16
      ephemeral-storage:  712126563583
      hugepages-1Gi:      0
      hugepages-2Mi:      0
      memory:             65735876Ki
      pods:               110
    System Info:
      Machine ID:                 132e3d2451f947fe9214456160254717
      System UUID:                4f584368-3e3d-3ef3-87e6-241933a2478b
      Boot ID:                    b2f91f92-8f5d-4045-afa2-6f1609cbd289
      Kernel Version:             5.15.0-1077-gcp
      OS Image:                   Ubuntu 22.04.4 LTS
      Operating System:           linux
      Architecture:               amd64
      Container Runtime Version:  containerd://1.6.26
      Kubelet Version:            v1.32.0
      Kube-Proxy Version:         v1.32.0
    PodCIDR:                      172.17.1.0/24
    PodCIDRs:                     172.17.1.0/24
    Non-terminated Pods:          (2 in total)
      Namespace                   Name                     CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age
      ---------                   ----                     ------------  ----------  ---------------  -------------  ---
      kube-flannel                kube-flannel-ds-pnqsj    100m (0%)     0 (0%)      50Mi (0%)        0 (0%)         20m
      kube-system                 kube-proxy-cmvtk         0 (0%)        0 (0%)      0 (0%)           0 (0%)         20m
    Allocated resources:
      (Total limits may be over 100 percent, i.e., overcommitted.)
      Resource           Requests   Limits
      --------           --------   ------
      cpu                100m (0%)  0 (0%)
      memory             50Mi (0%)  0 (0%)
      ephemeral-storage  0 (0%)     0 (0%)
      hugepages-1Gi      0 (0%)     0 (0%)
      hugepages-2Mi      0 (0%)     0 (0%)
    Events:
      Type     Reason                   Age                    From             Message
      ----     ------                   ----                   ----             -------
      Normal   Starting                 20m                    kube-proxy       
      Normal   NodeAllocatableEnforced  20m                    kubelet          Updated Node Allocatable limit across pods
      Warning  InvalidDiskCapacity      20m                    kubelet          invalid capacity 0 on image filesystem
      Warning  CgroupV1                 20m                    kubelet          cgroup v1 support is in maintenance mode, please migrate to cgroup v2
    ```


    ```bash
    node01 ~ âœ  systemctl status containerd
    â— containerd.service - containerd container runtime
         Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabled)
         Active: active (running) since Thu 2025-04-10 02:39:23 UTC; 23min ago
           Docs: https://containerd.io
       Main PID: 947 (containerd)
          Tasks: 46
         Memory: 35.1M
         CGroup: /system.slice/containerd.service
                 â”œâ”€ 947 /usr/bin/containerd
                 â”œâ”€2745 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id ad16ee49a6a48b7370fa4f0f>
                 â””â”€2763 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id 12a38ba7e3c8eaef26110a86>
    
    node01 ~ âœ  systemctl status kubelet
    â— kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: activating (auto-restart) (Result: exit-code) since Thu 2025-04-10 03:02:59 UTC; 8s ago
           Docs: https://kubernetes.io/docs/
        Process: 14034 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELE>
       Main PID: 14034 (code=exited, status=1/FAILURE)
       
    node01 ~ âœ– sudo journalctl -u kubelet -f
    Apr 10 03:04:21 node01 kubelet[14756]: I0410 03:04:21.236944   14756 server.go:215] "--pod-infra-container-image will not be pruned by the image garbage collector in kubelet and should also be set in the remote runtime"
    Apr 10 03:04:21 node01 kubelet[14756]: E0410 03:04:21.238395   14756 run.go:72] "command failed" err="failed to construct kubelet dependencies: unable to load client CA file /etc/kubernetes/pki/WRONG-CA-FILE.crt: open /etc/kubernetes/pki/WRONG-CA-FILE.crt: no such file or directory"
    
    node01 ~ âœ  ls /var/lib/kubelet/
    checkpoints  cpu_manager_state  kubeadm-flags.env     pki      plugins_registry  pods
    config.yaml  device-plugins     memory_manager_state  plugins  pod-resources
    
    node01 ~ âœ  vi /var/lib/kubelet/config.yaml # x509.clientCAFile ë¶€ë¶„ ìˆ˜ì •.
    
    node01 ~ âœ  systemctl status kubelet
    â— kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /usr/lib/systemd/system/kubelet.service.d
                 â””â”€10-kubeadm.conf
         Active: active (running) since Thu 2025-04-10 03:07:35 UTC; 6min ago
           Docs: https://kubernetes.io/docs/
       Main PID: 16591 (kubelet)
          Tasks: 23 (limit: 77143)
         Memory: 29.9M
         CGroup: /system.slice/kubelet.service
                 â””â”€16591 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf>
    ```

3. í´ëŸ¬ìŠ¤í„°ì— ë‹¤ì‹œ ë¬¸ì œ ìƒê¹€. ë¬¸ì œ ì¡°ì‚¬í•˜ê³  ê³ ì¹˜ê¸°.

    kubeletì€ ì •ìƒ ì‘ë™. ë¡œê·¸ í™•ì¸.


    ```bash
    node01 ~ âœ  sudo journalctl -u kubelet -f
    Apr 10 03:19:34 node01 kubelet[19807]: E0410 03:19:34.348346   19807 kubelet_node_status.go:108] "Unable to register node with API server" err="Post \"https://controlplane:6553/api/v1/nodes\": dial tcp 192.168.227.136:6553: connect: connection refused" node="node01"
    
    node01 ~ âœ  ls /etc/kubernetes/
    kubelet.conf  manifests  pki
    
    node01 ~ âœ  vi /etc/kubernetes/kubelet.conf 
    
    node01 ~ âœ  systemctl restart kubelet
    ```


    ```bash
    controlplane ~ âœ  k get no
    NAME           STATUS   ROLES           AGE   VERSION
    controlplane   Ready    control-plane   44m   v1.32.0
    node01         Ready    <none>          43m   v1.32.0
    ```


## Network Troubleshooting


### **Network Plugin in Kubernetes**


ì•„ë˜ì™€ ê°™ì´ ì´ìš© ê°€ëŠ¥í•œ ëª‡ëª‡ í”ŒëŸ¬ê·¸ì¸ì´ ìˆìŒ.


**1. Weave Net:**


`kubectl apply -f https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml`


ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš© ì°¸ì¡°.


[https://kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy](https://kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy)


**2. Calico :**


curlë¡œ ì„¤ì¹˜í•˜ê³ 


`curl https://raw.githubusercontent.com/projectcalico/calico/v3.25.0/manifests/calico.yaml -O`


ì•„ë˜ ëª…ë ¹ì–´ë¡œ manifest ì ìš©.


`kubectl apply -f calico.yaml`


CalicoëŠ” ê°€ì¥ ì§„ë³´ëœ CNI ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì„ ê°€ì§€ê³  ìˆìŒ.


ë””ë ‰í† ë¦¬ì— ë‹¤ì¤‘ CNI êµ¬ì„± íŒŒì¼ì´ ìˆìœ¼ë©´ kubeletì€ ì‚¬ì „ ìˆœ ì´ë¦„ìœ¼ë¡œ ì²˜ìŒìœ¼ë¡œ ì˜¤ëŠ” êµ¬ì„± íŒŒì¼ì„ ì‚¬ìš©.


### **DNS in Kubernetes**


Kubernetes usesÂ **CoreDNS**.Â **CoreDNS**Â is a flexible, extensible DNS server that can serve as the Kubernetes cluster DNS.


**Memory and Pods**


In large scale Kubernetes clusters, CoreDNS's memory usage is predominantly affected by the number of Pods and Services in the cluster. Other factors include the size of the filled DNS answer cache, and the rate of queries received (QPS) per CoreDNS instance.


Kubernetes resources forÂ **coreDNS**Â are:

1. _a service account named_Â _**coredns**__,_
2. _cluster-roles named_Â _**coredns**_Â _and_Â _**kube-dns**_
3. _clusterrolebindings named_Â _**coredns**_Â _and_Â _**kube-dns**__,_
4. _a deployment named_Â _**coredns**__,_
5. _a configmap named_Â _**coredns**_Â _and a_
6. _service named_Â _**kube-dns**__._

While analyzing the coreDNS deployment you can see that the theÂ _**Corefile plugin**_Â consists of important configuration which is defined as aÂ _**configmap**_.


PortÂ **53**Â is used for forÂ _DNS resolution_.


```bash
kubernetes cluster.local in-addr.arpa ip6.arpa {
    pods insecure
    fallthrough in-addr.arpa ip6.arpa
    ttl 30
}
```


This is the backend to k8s forÂ _cluster.local and reverse domains_.


`proxy . /etc/resolv.conf`


Forward out of cluster domains directly to rightÂ _authoritative DNS server_.


### Troubleshooting issues related to coreDNS


1. If you findÂ **CoreDNS**Â pods in pending state first check network plugin is installed.


2. coredns pods haveÂ **CrashLoopBackOff or Error state**


If you have nodes that are running SELinux with an older version of Docker you might experience a scenario where the coredns pods are not starting. To solve that you can try one of the following options:


a)Upgrade to a newer version of Docker.


b)DisableÂ **SELinux.**


c)Modify the coredns deployment to setÂ **allowPrivilegeEscalation**Â toÂ _true_:


```bash
kubectl -n kube-system get deployment coredns -o yaml | \
sed 's/allowPrivilegeEscalation: false/allowPrivilegeEscalation: true/g' | \
kubectl apply -f -
```


d)Another cause forÂ **CoreDNS**Â to have CrashLoopBackOff is when aÂ **CoreDNS**Â Pod deployed in Kubernetes detects a loop.


There are many ways to work around this issue, some are listed here:

- Add the following to your kubelet config yaml:Â _**resolvConf: <path-to-your-real-resolv-conf-file>**_Â This flag tellsÂ _**kubelet**_Â to pass an alternateÂ _**resolv.conf**_Â to Pods. For systems usingÂ **systemd-resolved**,Â _**/run/systemd/resolve/resolv.conf**_Â is typically the location of theÂ _**"real" resolv.conf**_, although this can be different depending on your distribution.
- Disable the local DNS cache on host nodes, and restoreÂ _**/etc/resolv.conf**_Â to the original.
- A quick fix is to edit yourÂ **Corefile**, replacing forwardÂ _**. /etc/resolv.conf**_Â with the IP address of your upstream DNS, for example forwardÂ **. 8.8.8.8**. But this only fixes the issue forÂ **CoreDNS**,Â _**kubelet**_Â will continue to forward the invalidÂ _**resolv.conf**_Â to all default dnsPolicy Pods, leaving them unable to resolve DNS.

3. IfÂ **CoreDNS**Â pods and theÂ **kube-dns**Â service is working fine, check theÂ **kube-dns**Â service has validÂ _**endpoints**_.


_kubectl -n kube-system get ep kube-dns_


If there are no endpoints for the service, inspect the service and make sure it uses the correct selectors and ports.


### **Kube-Proxy**


**kube-proxy**Â is a network proxy that runs on each node in the cluster.Â **kube-proxy**Â maintainsÂ _network rules on nodes_. These network rules allow network communication to the Pods from network sessions inside or outside of the cluster.


In a cluster configured withÂ **kubeadm**, you can findÂ **kube-proxy**Â as aÂ _**daemonset**_.


**kubeproxy**Â is responsible for watchingÂ _services and endpoint associated with each service_. When the client is going to connect to the service using theÂ _virtual IP_Â theÂ **kubeproxy**Â is responsible forÂ _sending traffic to actual pods_.


If you run aÂ `kubectl describe ds kube-proxy -n kube-system`Â you can see that theÂ **kube-proxy**Â binary runs with following command inside the kube-proxy container.


```bash
Command:
  /usr/local/bin/kube-proxy
  --config=/var/lib/kube-proxy/config.conf
  --hostname-override=$(NODE_NAME)
```


So it fetches the configuration from a configuration file ie,Â _**/var/lib/kube-proxy/config.conf**_Â and we can override the hostname with the node name of at which the pod is running.


In the config file we define theÂ **clusterCIDR, kubeproxy mode, ipvs, iptables, bindaddress, kube-config**Â etc.


### Troubleshooting issues related to kube-proxy


1. CheckÂ **kube-proxy**Â pod in theÂ **kube-system**Â namespace is running.


2. CheckÂ **kube-proxy**Â logs.


3. CheckÂ **configmap**Â is correctly defined and the config file for runningÂ **kube-proxy**Â binary is correct.


4.Â **kube-config**Â is defined in theÂ **config map**.


5. checkÂ **kube-proxy**Â isÂ _running_Â inside the container


```bash
# netstat -plan | grep kube-proxy
tcp        0      0 0.0.0.0:30081           0.0.0.0:*               LISTEN      1/kube-proxy
tcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      1/kube-proxy
tcp        0      0 172.17.0.12:33706       172.17.0.12:6443        ESTABLISHED 1/kube-proxy
tcp6       0      0 :::10256                :::*                    LISTEN      1/kube-proxy
```


_**References:**_


Debug Service issues:


[_`https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/`_](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/)


DNS Troubleshooting:


[_`https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/`_](https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/)


## Practice Test - Troubleshoot Network

1. triton ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬. green ì›¹ í˜ì´ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ  ë³´ì—¬ì•¼ í•¨. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³´ë ¤ë©´ app íƒ­ í´ë¦­. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œ í•´ê²°.

    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/a50f6a04-6611-47f7-8b7e-374b7f9a07fb/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SRESXQQX%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141022Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJIMEYCIQDd6nYLAIhstl3b8fB4gCHf3mUnnR2hN8mrJUvZKdfALgIhAOF2DIOB4YyRZB5ampgrVrwxHFRsgVI1h0FbYCkkWrmQKogECKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgyAGazdE3Hw8IbMqlkq3AO3r%2BIsix%2FWSZ9Ahla2nYUlN6euDZOTB2vrVMWXCxZ9%2Fo9PN%2Bw%2F9VrzeFr%2FZz8wUI8uHcEeNw7%2BEmZrrDrJQOd0w2kxtz9JDaVhAJJV61RBVlyKL6slyEjd2fE18MjiGF1XeUCmssNEMx9A4xzx4B7EpG2Rie4Ez%2Fx4ovu5qF6Dw3F1jBED5MPdPMlnwgHNRQa9YgFZNhXf0yeFcJz%2BlAaOG4ZY8w0r%2Bv60sug0D%2F3P7bl4uesmy9WYKdw7VQE52RL552TeScv20Ry1Di3Ky8lcNH9zMrEbKdheOr%2F3ef1Xysl4kTWPuHeUtQUfLwErcMvwh7oAljef87pqj7O%2B08orEsdrk3bdqGmJn7A53HPCB5o7Wpck%2FGjNQiDA%2BsY1vnRoTLr%2B29sWy3voLTyBq5soYhqnizJ4MR2qNnba7hB1E7Vr3tvSdXwCwlOqnzX8Er5Y0bITQbicT2cXSV2XDyiRR1CCrRjMay8UNzVMyWyFeCompOKJjWwVW4Du%2Bl3SKVTErRA3xlUcrmMRVUc1wy73Ax2mZbbau9PksB5mgamHax2QNYZ039LWiFjtZZbv%2Bmn9osM575u%2BwEe8BKVzn09j%2BWXffVUj1LZ8uU6zIZp2YkPJvPETbxyepiQI9DDYxJPABjqkARRFnGBMH4l947gKcDC4gDhHn6JcIrNcljduAEbgXGK5yHgUVXPVH1QDBLrbPu9jIqOfcj3V4zfpqqc95aP0MOBgkgbRXCB7StF9qu0dHwTBYZ2uReqLB1QIPn%2BnziXf%2BAbXqiWlah0kfLk%2FhliPSsL%2ByuPmvsXI%2B4h6BKvBXLX2fEsABEoJhp8YuUSLsLP9TcCCtICwNAXIhjGvBEqKWRrnMEdb&X-Amz-Signature=9e3b64caa16fa446848060e94cce2e6da4e53d2e9e723face7090f6f7f919570&X-Amz-SignedHeaders=host&x-id=GetObject)


    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b2ea2032-00e9-4883-a13b-cb03cf5b2334/d2fb6d51-982c-4812-8b98-50d1998f385a/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SRESXQQX%2F20250420%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250420T141022Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJIMEYCIQDd6nYLAIhstl3b8fB4gCHf3mUnnR2hN8mrJUvZKdfALgIhAOF2DIOB4YyRZB5ampgrVrwxHFRsgVI1h0FbYCkkWrmQKogECKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgyAGazdE3Hw8IbMqlkq3AO3r%2BIsix%2FWSZ9Ahla2nYUlN6euDZOTB2vrVMWXCxZ9%2Fo9PN%2Bw%2F9VrzeFr%2FZz8wUI8uHcEeNw7%2BEmZrrDrJQOd0w2kxtz9JDaVhAJJV61RBVlyKL6slyEjd2fE18MjiGF1XeUCmssNEMx9A4xzx4B7EpG2Rie4Ez%2Fx4ovu5qF6Dw3F1jBED5MPdPMlnwgHNRQa9YgFZNhXf0yeFcJz%2BlAaOG4ZY8w0r%2Bv60sug0D%2F3P7bl4uesmy9WYKdw7VQE52RL552TeScv20Ry1Di3Ky8lcNH9zMrEbKdheOr%2F3ef1Xysl4kTWPuHeUtQUfLwErcMvwh7oAljef87pqj7O%2B08orEsdrk3bdqGmJn7A53HPCB5o7Wpck%2FGjNQiDA%2BsY1vnRoTLr%2B29sWy3voLTyBq5soYhqnizJ4MR2qNnba7hB1E7Vr3tvSdXwCwlOqnzX8Er5Y0bITQbicT2cXSV2XDyiRR1CCrRjMay8UNzVMyWyFeCompOKJjWwVW4Du%2Bl3SKVTErRA3xlUcrmMRVUc1wy73Ax2mZbbau9PksB5mgamHax2QNYZ039LWiFjtZZbv%2Bmn9osM575u%2BwEe8BKVzn09j%2BWXffVUj1LZ8uU6zIZp2YkPJvPETbxyepiQI9DDYxJPABjqkARRFnGBMH4l947gKcDC4gDhHn6JcIrNcljduAEbgXGK5yHgUVXPVH1QDBLrbPu9jIqOfcj3V4zfpqqc95aP0MOBgkgbRXCB7StF9qu0dHwTBYZ2uReqLB1QIPn%2BnziXf%2BAbXqiWlah0kfLk%2FhliPSsL%2ByuPmvsXI%2B4h6BKvBXLX2fEsABEoJhp8YuUSLsLP9TcCCtICwNAXIhjGvBEqKWRrnMEdb&X-Amz-Signature=52ff7f10af4ac9d089f1f0870615b610529ad9e6a98666fa51088a3176d5407f&X-Amz-SignedHeaders=host&x-id=GetObject)


    ```bash
    root@controlplane ~ âœ  k describe po -n triton webapp-mysql-7bd5857746-mgnx6
    ......
    Events:
      Type     Reason                  Age                    From               Message
      ----     ------                  ----                   ----               -------
      Normal   Scheduled               5m44s                  default-scheduler  Successfully assigned triton/webapp-mysql-7bd5857746-mgnx6 to controlplane
      Warning  FailedCreatePodSandBox  5m44s                  kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox "0e75f4d9a7100b74cbddd9f16c6e5d6b5c12c10dde1a22cb77041ceb54b7c81a": plugin type="weave-net" name="weave" failed (add): unable to allocate IP address: Post "http://127.0.0.1:6784/ip/0e75f4d9a7100b74cbddd9f16c6e5d6b5c12c10dde1a22cb77041ceb54b7c81a": dial tcp 127.0.0.1:6784: connect: connection refused
    
    root@controlplane ~ âœ  kubectl apply -f https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml
    serviceaccount/weave-net created
    clusterrole.rbac.authorization.k8s.io/weave-net created
    clusterrolebinding.rbac.authorization.k8s.io/weave-net created
    role.rbac.authorization.k8s.io/weave-net created
    rolebinding.rbac.authorization.k8s.io/weave-net created
    daemonset.apps/weave-net created
    
    root@controlplane ~ âœ  k get po -n triton 
    NAME                            READY   STATUS    RESTARTS   AGE
    mysql                           1/1     Running   0          17m
    webapp-mysql-7bd5857746-mgnx6   1/1     Running   0          17m
    ```

2. ê°™ì€ 2-tier ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ì‹œ ë¬¸ì œ ë°œìƒ. green ì›¹ í˜ì´ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ  ë³´ì—¬ì•¼ í•¨. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³´ë ¤ë©´ app íƒ­ í´ë¦­. í˜„ì¬ ì‹¤íŒ¨. ë¬¸ì œ í•´ê²°.

    ```bash
    root@controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS             RESTARTS      AGE
    coredns-668d6bf9bc-fh8vv               1/1     Running            0             81m
    coredns-668d6bf9bc-q8q47               1/1     Running            0             81m
    etcd-controlplane                      1/1     Running            0             81m
    kube-apiserver-controlplane            1/1     Running            0             81m
    kube-controller-manager-controlplane   1/1     Running            0             81m
    kube-proxy-j29c4                       0/1     CrashLoopBackOff   3 (35s ago)   81s
    kube-scheduler-controlplane            1/1     Running            0             81m
    weave-net-9hwhw                        2/2     Running            0             2m17s
    
    root@controlplane ~ âœ  k logs -n kube-system kube-proxy-j29c4 
    E0411 01:35:34.015213       1 run.go:74] "command failed" err="failed complete: open /var/lib/kube-proxy/configuration.conf: no such file or directory"
    
    root@controlplane ~ âœ  k edit ds -n  kube-system kube-proxy 
    daemonset.apps/kube-proxy edited
    
    root@controlplane ~ âœ  k get po -n kube-system 
    NAME                                   READY   STATUS    RESTARTS   AGE
    coredns-668d6bf9bc-fh8vv               1/1     Running   0          91m
    coredns-668d6bf9bc-q8q47               1/1     Running   0          91m
    etcd-controlplane                      1/1     Running   0          91m
    kube-apiserver-controlplane            1/1     Running   0          91m
    kube-controller-manager-controlplane   1/1     Running   0          91m
    kube-proxy-ztjj8                       1/1     Running   0          6s
    kube-scheduler-controlplane            1/1     Running   0          91m
    weave-net-9hwhw                        2/2     Running   0          12m
    
    root@controlplane ~ âœ  k get po -n triton 
    NAME                            READY   STATUS    RESTARTS        AGE
    mysql                           1/1     Running   2 (2m55s ago)   12m
    webapp-mysql-7bd5857746-tlttr   1/1     Running   1 (4m19s ago)   12m
    ```

