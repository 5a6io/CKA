# ðŸ¨ Section9 - Networking

## Prerequisite -Switching Routing


`ip link` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ìŠ¤ìœ„ì¹˜ì— ì—°ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ë ¤ëŠ” Eth0ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì¸í„°íŽ˜ì´ìŠ¤ê°€ ë³´ìž„.


192.168.1.0 ì´ë¼ëŠ” ì£¼ì†Œë¥¼ ê°€ì§„ ë„¤íŠ¸ì›Œí¬ë¼ê³  ê°€ì •. ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— IP ì£¼ì†Œë¥¼ ê°€ì§„ ì‹œìŠ¤í…œì„ í• ë‹¹. `ip addr` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©.


linkê°€ ì˜¬ë¼ì˜¤ê³  IP ì£¼ì†Œê°€ í• ë‹¹ë˜ë©´ ì»´í“¨í„°ëŠ” ìŠ¤ìœ„ì¹˜ë¥¼ í†µí•´ ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ìžˆìŒ.


ìŠ¤ìœ„ì¹˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë‚´ì˜ í†µì‹ ë§Œ ê°€ëŠ¥í•˜ê²Œ í•˜ë¯€ë¡œ ë„¤íŠ¸ì›Œí¬ì—ì„œ í˜¸ìŠ¤íŠ¸ë¡œë¶€í„° íŒ¨í‚·ì„ ë°›ì„ ìˆ˜ ìžˆê³  ê°™ì€ ë„¤íŠ¸ì›Œí¬ ë‚´ ë‹¤ë¥¸ ì‹œìŠ¤í…œì— ë³´ë‚¼ ìˆ˜ ìžˆìŒ.


192.168.2.0ì— ì‹œìŠ¤í…œ Cì™€ Dë¥¼ í¬í•¨í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ê°€ ìžˆë‹¤ê³  ê°€ì •. ì‹œìŠ¤í…œì€ 192.168.2.10ê³¼ 192.168.2.11ì„ ê°ê° ê°€ì§.


192.168.1.11ì„ ê°€ì§„ ì‹œìŠ¤í…œ Bì— ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì˜ 192.168.2.10ì„ ê°€ì§„ ì‹œìŠ¤í…œ Cê°€ ë„ë‹¬í•˜ë ¤ë©´? ë¼ìš°í„°ê°€ ìžˆì–´ì•¼ í•¨.


ë¼ìš°í„°ëŠ” ë‘ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì‹œí‚¤ë„ë¡ í•¨.


ë§Žì€ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ë¥¼ ê°€ì§„ ë˜ ë‹¤ë¥¸ ì„œë²„ê°€ ìžˆë‹¤ê³  ê°€ì •. ë‘ ê°œì˜ ê°œë³„ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ë˜ê¸° ë•Œë¬¸ì— ê° ë„¤íŠ¸ì›Œí¬ì— ê°ê° ë‘ ê°œì˜ IPê°€ í• ë‹¹ë¨.


ì²« ë²ˆì§¸ ë„¤íŠ¸ì›Œí¬ëŠ” 192.168.1.1ì„ í• ë‹¹. ë‘ ë²ˆì§¸ëŠ” 192.168.2.1ì„ í• ë‹¹. ì´ì œ ë‘ ë„¤íŠ¸ì›Œí¬ê°€ í†µì‹ ì´ ê°€ëŠ¥í•˜ë„ë¡ ì—°ê²°ëœ ë¼ìš°í„°ê°€ ìžˆìŒ.


ì‹œìŠ¤í…œ Bê°€ ì‹œìŠ¤í…œ Cë¡œ íŒ¨í‚·ì„ ë³´ë‚´ë ¤ê³  í•  ë•Œ, íŒ¨í‚·ì„ ì „ì†¡í•˜ê¸° ìœ„í•´ ë¼ìš°í„°ê°€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì–´ë””ì— ìžˆëŠ”ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìžˆëŠ”ê°€? ë¼ìš°í„°ëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ë˜ ë‹¤ë¥¸ ìž¥ì¹˜ìž„. ì´ì™€ ê°™ì€ ë§Žì€ ê¸°ê¸°ê°€ ìžˆì„ ê²ƒ. gatewayë‚˜ routeë¥¼ ê°€ì§€ê³  ì‹œìŠ¤í…œì„ êµ¬ì„±.


ë„¤íŠ¸ì›Œí¬ê°€ ë°©ì´ë¼ë©´ ê²Œì´íŠ¸ì›¨ì´ëŠ” ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ë‚˜ ì¸í„°ë„·ìœ¼ë¡œ ê°€ëŠ” ì™¸ë¶€ ì„¸ê²Œë¡œ í†µí•˜ëŠ” ë¬¸.


ì‹œìŠ¤í…œì€ í†µê³¼í•˜ë ¤ë©´ ë¬¸ì´ ì–´ë””ì— ìžˆëŠ”ì§€ ì•Œì•„ì•¼ í•¨. ì‹œìŠ¤í…œì— ì¡´ìž¬í•˜ëŠ” ë¼ìš°íŒ… êµ¬ì„±ì„ ë³´ë ¤ë©´ `route` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰. ì»¤ë„ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì´ ë³´ìž„. í˜„ìž¬ëŠ” ë¼ìš°íŒ… êµ¬ì„±ì´ ì—†ìŒ. ë”°ë¼ì„œ ì‹œìŠ¤í…œ Bê°€ ì‹œìŠ¤í…œ Cì— ë„ë‹¬í•  ìˆ˜ ì—†ìŒ.


ì‹œìŠ¤í…œ Bì— ê²Œì´íŠ¸ì›¨ì´ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ `ip route add`  ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰. ê·¸ë¦¬ê³  192.168.1.1  ê²Œì´íŠ¸ì›¨ì´ë¥¼ í†µí•´ 192.168.2.0ì— ë„ë‹¬í•  ìˆ˜ ìžˆë„ë¡ ëª…ì‹œ. `route` ëª…ë ¹ì–´ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ ì¶”ê°€ëœ ê²½ë¡œê°€ ë³´ìž„.  â†’ ëª¨ë“  ì‹œìŠ¤í…œì—ì„œ êµ¬ì„±í•´ì•¼ í•¨.


ì´ëŸ¬í•œ ì‹œìŠ¤í…œì— ì¸í„°ë„· ì•¡ì„¸ìŠ¤ê°€ í•„ìš”í•˜ë‹¤ê³  ê°€ì •. 172.217.194.0 êµ¬ê¸€ì— ì ‘ê·¼í•˜ë ¤ê³  í•¨. ì¸í„°ë„·ì— ë¼ìš°í„°ë¥¼ ì—°ê²°í•˜ê³  ë¼ìš°íŒ… í…Œì´ë¸”ì— ìƒˆ ê²½ë¡œ ì¶”ê°€.


ì¸í„°ë„·ì—ëŠ” ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ì— ìˆ˜ë§Žì€ ë‹¤ì–‘í•œ ì‚¬ì´íŠ¸ê°€ ìžˆìŒ. ë™ì¼í•œ ë¼ìš°í„° IP ì£¼ì†Œë¥¼ ë¼ìš°íŒ… í…Œì´ë¸”ì— ì¶”ê°€í•˜ëŠ” ëŒ€ì‹  ê²½ë¡œë¥¼ ëª¨ë¥´ëŠ” ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ì´ ë¼ìš°í„°ë¥¼ ê¸°ë³¸  ê²Œì´íŠ¸ì›¨ì´ë¡œ ì‚¬ìš©í•˜ë¼ê³  ê°„ë‹¨ížˆ ë§í•  ìˆ˜ ìžˆìŒ. ì´ë ‡ê²Œ í•˜ë©´ ê¸°ì¡´ ë„¤íŠ¸ì›Œí¬ ì™¸ë¶€ì˜ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ìš”ì²­ì´ ì´ íŠ¹ì • ë¼ìš°í„°ë¡œ ì „ë‹¬ë¨. ë”°ë¼ì„œ ì´ì™€ ê°™ì€ ê°„ë‹¨í•  ì„¤ì •ì—ì„œëŠ” ë¼ìš°í„°ì˜ IP ì£¼ì†Œì— ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ê°€ ì„¤ì •ëœ ë‹¨ì¼ ë¼ìš°íŒ… í…Œì´ë¸” í•­ëª©ë§Œ ìžˆìœ¼ë©´ ë¨. defaultëŒ€ì‹  0.0.0.0ì´ë¼ê³ ë„ í•¨. ëª¨ë“  IP ë„ì°©ì§€.


ê²Œì´íŠ¸ì›¨ì´ í•„ë“œì— 0.0.0.0ì´ í•­ëª©ì´ ìžˆìœ¼ë©´ ê²Œì´íŠ¸ì›¨ì´ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ„. ì˜ˆë¥¼ ë“¤ì–´, ì‹œìŠ¤í…œ Cê°€ 192.168.2.0 ë„¤íŠ¸ì›Œí¬ì˜ ìž¥ì¹˜ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ ìžì²´ ë„¤íŠ¸ì›Œí¬ì— ìžˆê¸° ë•Œë¬¸ì— ê²Œì´íŠ¸ì›¨ì´ê°€ í•„ìš”í•˜ì§€ ì•ŠìŒ. ê·¸ëŸ¬ë‚˜ ì—¬ëŸ¬ ë¼ìš°í„°ê°€ ìžˆë‹¤ê³  ê°€ì •. í•˜ë‚˜ëŠ” ì¸í„°ë„·ì„ ìœ„í•œ ê²ƒì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ë‚´ë¶€ ì‚¬ì„¤ë§ì„ ìœ„í•œ ê²ƒ. ê° ë„¤íŠ¸ì›Œí¬ë§ˆë‹¤ ë‘ ê°œì˜ ê°œë³„ í•­ëª©ì´ ìžˆì–´ì•¼ í•¨. ë‚´ë¶€ ì‚¬ì„¤ ë„¤íŠ¸ì›Œí¬ë¥¼ ìœ„í•œ í•˜ë‚˜ì˜ í•­ëª©ê³¼ ê³µìš© ë„¤íŠ¸ì›Œí¬ë¥¼ í¬í•¨í•œ ëª¨ë“  ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ìœ„í•œ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ê°€ ìžˆëŠ” ë‹¤ë¥¸ í•­ëª©. ë”°ë¼ì„œ, ì‹œìŠ¤í…œì—ì„œ ì¸í„°ë„·ì— ì—°ê²°í•˜ëŠ” ë° ë¬¸ì œê°€ ìžˆëŠ” ê²½ìš° ì´ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ êµ¬ì„±ì„ ì‹œìž‘í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.

> ë¦¬ëˆ…ìŠ¤ í˜¸ìŠ¤íŠ¸ë¥¼ ë¼ìš°í„°ë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•

A, B, C í˜¸ìŠ¤íŠ¸ê°€ ìžˆìŒ. Aì™€ BëŠ” 192.168.1.0ì— ì—°ê²°ë¨. Bì™€ CëŠ” 192.168.2.0ì— ì—°ê²°ë¨. BëŠ” eth0ê³¼ eth1 ë‘ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼  ì‚¬ìš©í•˜ì—¬ ë‘ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ë¨.


AëŠ” 192.168.1.5ë¥¼ ê°€ì§€ê³  CëŠ” 192.168.2.5ë¥¼ ê°€ì§. BëŠ” 192.168.1.6ê³¼ 192.168.2.6 ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ì§.


Aì—ì„œ Cë¡œ ë„ë‹¬í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ëŠ”ê°€? Aì—ì„œ 192.168.2.5ë¡œ pingì„ ë³´ë‚´ë©´ ë„ë‹¬í•˜ì§€ ì•ŠìŒ. â†’ Aì—ê²Œ ë„¤íŠ¸ì›Œí¬ 2ì˜ ê²Œì´íŠ¸ì›¨ì´ê°€ Bë¥¼ í†µí•´ ì—´ë ¤ ìžˆìŒì„ ì•Œë ¤ì•¼ í•¨. ê·¸ë¦¬ê³  ë¼ìš°íŒ… í…Œì´ë¸”ì—  ì¶”ê°€. ê²Œì´íŠ¸ì›¨ì´ 192.168.1.6dì— ëŒ€í•´ 192.168.2.0 ë„¤íŠ¸ì›Œí¬ë¥¼ ì—°ê²°í•˜ë„ë¡ ê²½ë¡œ ì¶”ê°€. íŒ¨í‚·ì´ Cë¡œ ì „ë‹¬ë˜ë ¤ë©´ í˜¸ìŠ¤íŠ¸ Cê°€ í˜¸ìŠ¤íŠ¸ Aì—ê²Œ ì‘ë‹µì„ ë³´ë‚´ì•¼ í•¨.


CëŠ” 192.168.1.0 ë„¤íŠ¸ì›Œí¬ì˜ Aì— ë„ë‹¬í•˜ë ¤ê³  í•  ë•Œ ê°™ì€ ë¬¸ì œë¥¼ ì§ë©´í•¨. CëŠ” ë¼ìš°í„° ì—­í• ì„ í•˜ëŠ” Bë¥¼ í†µí•´ Aë¡œ ë„ë‹¬í•  ìˆ˜ ìžˆìŒì„ ì•Œì•„ì•¼ í•¨. ê·¸ëŸ¬ë¯€ë¡œ C ë¼ìš°íŒ… í…Œì´ë¸”ì—ë„ ë„£ìŒ. pingì„ ë³´ë‚´ë©´ ë” ì´ìƒ ë„ë‹¬í•  ìˆ˜ ì—†ë‹¤ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ.


ê·¸ëŸ¬ë‚˜ ì—¬ì „ížˆ ì‘ë‹µì´ ëŒì•„ì˜¤ì§€ ì•ŠìŒ. ê¸°ë³¸ì ìœ¼ë¡œ ë¦¬ëˆ…ìŠ¤ì—ì„œ íŒ¨í‚·ì€ í•œ ì¸í„°íŽ˜ì´ìŠ¤ì—ì„œ ë‹¤ìŒ ì¸í„°íŽ˜ì´ìŠ¤ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ. ì˜ˆë¥¼ ë“¤ì–´, Bì˜ eth0ì—ì„œ ë°›ì€ íŒ¨í‚·ì€ eth1ì„ í†µí•´ ë‹¤ë¥¸ ê³³ì€ ë‚˜ê°€ì§€ ì•ŠìŒ. ë³´ì•ˆ ì´ìœ ë•Œë¬¸.


ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ì„¤ë§ì— ì—°ê²°ëœ eth0ê³¼ í¼ë¸”ë¦­ë§ì— eth1ì´ ìžˆë‹¤ë©´ ëª…ì‹œì ìœ¼ë¡œ í—ˆìš©í•˜ì§€ ì•ŠëŠ”  í•œ í¼ë¸”ë¦­ì—ì„œ í”„ë¼ì´ë¹—ìœ¼ë¡œ ì‰½ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³  ì•Šê¸°ë¥¼ ì›í•¨. ê·¸ëŸ¬ë‚˜ ì´ê²½ìš° ë‘˜ë‹¤ ì‚¬ì„¤ë§ì„ ì•Œê³  ìžˆê³  ì•ˆì „í•˜ë¯€ë¡œ í•œ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ë¡œ íŒ¨í‚·ì„ ë³´ë‚´ë„ë¡ Bê°€ í—ˆë½í•  ìˆ˜ ìžˆìŒ.


ì¸í„°íŽ˜ì´ìŠ¤ ê°„ì˜ íŒ¨í‚· ì „ì†¡ ì—¬ë¶€ëŠ” ì´ ì‹œìŠ¤í…œì—ì„œ /proc/sys/net/ipv4/ip_forward íŒŒì¼ì˜ ì„¤ì •ì— ì˜í•´ ê²°ì •ë¨. ê¸°ë³¸ì ìœ¼ë¡œ ì´ íŒŒì¼ì˜ ê°’ì€ 0ìœ¼ë¡œ ì„¤ì •ë˜ì–´ìžˆìŒ. ì „ì†¡ì´ ë˜ì§€ ì•ŠìŒì„ ì˜ë¯¸. 1ë¡œ ì„¤ì •í•˜ë©´ pingì´ ì „ë‹¬ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆìŒ. ë‹¨ìˆœížˆ ì´ ê°’ì„ ì„¤ì •í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ìž¬ë¶€íŒ… ì‹œ ë³€ê²½ ì‚¬í•­ì´ ì§€ì†ë˜ì§€ ì•ŠìŒ. â†’ etc/sys/control.confì— net.ipv4.ip_forward = 1ë¡œ ìˆ˜ì •í•´ì•¼ í•¨.

> ì£¼ìš” ëª…ë ¹ì–´

`ip link` ëŠ” í˜¸ìŠ¤íŠ¸ì—ì„œ ìˆ˜ì •ëœ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ë‚˜ì—´.


`ip addr` ì€ ê·¸ ì¸í„°íŽ˜ì´ìŠ¤ì— í• ë‹¹ëœ IP ì£¼ì†Œë¥¼ í™•ì¸.


`ip addr add` ëŠ” ì¸í„°íŽ˜ì´ìŠ¤ì˜ IP ì£¼ì†Œë¥¼ ì„¤ì •í•˜ëŠ” ë° ì‚¬ìš©ë¨.


ì´ëŸ¬í•œ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì •í•˜ë©´ ìž¬ì‹œìž‘ë•Œê¹Œì§€ë§Œ ìœ íš¨í•¨. 


ë³€ê²½ì„ ìœ ì§€í•˜ë ¤ë©´ /etc/network/interfacesì— ì„¤ì •í•´ì•¼ í•¨.


`ip route` ë‚˜ `route` ëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ì„ ë³´ê¸° ìœ„í•´ ì‚¬ìš©ë¨.


`ip route add` ëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ì— ì¶”ê°€í•˜ëŠ” ë° ì‚¬ìš©ë¨.


ë¼ìš°í„°ë¡œ êµ¬ì„±ëœ í˜¸ìŠ¤íŠ¸ì™€ í•¨ê»˜ ìž‘ì—…í•˜ëŠ” ê²½ìš° í˜¸ìŠ¤íŠ¸ì—ì„œ ip í¬ì›Œë”©ì´ í™œì„±í™”ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸.


## Prerequisite - DNS


ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— ìžˆëŠ” Aì™€ Bë¼ëŠ” ë‘ ì»´í“¨í„°ê°€ ìžˆìŒ. 192.168.1.10ê³¼ 192.168.1.11ì´ë¼ëŠ” IP ì£¼ì†Œë¥¼ ê°€ì§.


ë‹¤ë¥¸ ì»´í“¨í„°ì˜ IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ í•œ ì»´í“¨í„°ì— ë‹¤ë¥¸ ì»´í“¨í„°ë¡œ pingí•  ìˆ˜ ìžˆìŒ.


Bê°€ ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ë¥¼ ê°€ì§€ê³  ìžˆìŒ. Bì˜ IP ì£¼ì†Œë¥¼ ê¸°ì–µí•˜ëŠ” ëŒ€ì‹  dbë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì§€ì •í•˜ê¸°ë¡œ í•¨.


IP ì£¼ì†Œ ëŒ€ì‹  dbë¼ëŠ” ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ Bë¡œ pingì„ ë³´ë‚´ê³  ì‹¶ìŒ.


DBì— pingì„ ë³´ë‚´ë ¤ê³  í•˜ë©´ Aê°€ dbì´ë¦„ì„ ê°€ì§„ í˜¸ìŠ¤íŠ¸ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆìŒ.


ê¸°ë³¸ì ìœ¼ë¡œ IP ì£¼ì†Œ 192.168.1.11ì˜ BëŠ” dbë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ë‹¤ê³  Aì—ê²Œ ì•Œë¦¬ê³  ì‹¶ìŒ. Aì—ì„œ /etc/hosts íŒŒì¼ì— ì¶”ê°€í•¨ìœ¼ë¡œì¨ í•  ìˆ˜ ìžˆìŒ. IP ì£¼ì†Œì™€ í˜¸ìŠ¤íŠ¸ê°€ Bì— í‘œì‹œí•  ì´ë¦„ì„ ìž‘ì„±. 192.168.1.11 IP ëŠ” dbë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ í˜¸ìŠ¤íŠ¸ë¼ê³  Aì—ê²Œ ì•Œë¦¼. ì´ì œ dbë¡œ Pingì´ ì˜¬ë°”ë¥¸ IPë¡œ ì „ì†¡ë˜ì–´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë¨.


Aì— 192.168.1.11ì˜ IPê°€ dbë¼ëŠ” í˜¸ìŠ¤íŠ¸ë¼ê³  ì•Œë¦¼. AëŠ” ê·¸ê²ƒì„ ë‹¹ì—°í•˜ê²Œ ì—¬ê¹€. Aì˜ /etc/hosts íŒŒì¼ì— ë¬´ì—‡ì„ ë„£ë“  ì°¸ì´ì§€ë§Œ ê·¸ê²ƒì´ ì°¸ì´ ì•„ë‹ ìˆ˜ ìžˆìŒ.


AëŠ” Bì˜ ì‹¤ì œ ì´ë¦„ì´ dbë¼ë©´ í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Bì—ì„œ `hostname`ì´ë¼ëŠ” ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ host-2ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ë‹¤ê³  ë‚˜ì˜¨ë‹¤. ê·¸ëŸ¬ë‚˜ AëŠ” ì‹ ê²½ì“°ì§€ ì•ŠëŠ”ë‹¤. hosts íŒŒì¼ì— ìžˆëŠ ë‚´ìš©ëŒ€ë¡œ í•œë‹¤.


/etc/hosts íŒŒì¼ì—ì„œ ì›í•˜ëŠ” ë§Œí¼ì˜ ì„œë²„ ì´ë¦„ì„ ê°€ì§ˆ ìˆ˜ ìžˆìŒ.


Aì—ì„œ pingì´ë‚˜ ssh ëª…ë ¹ì„ í†µí•´ ë˜ëŠ” ì´ ì‹œìŠ¤í…œ ë‚´ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ë„êµ¬ë¥¼ í†µí•´ ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ì˜ ì´ë¦„ì„ ì°¸ì¡°í•  ë•Œë§ˆë‹¤, í˜¸ìŠ¤íŠ¸ëŠ” /etc/hosts íŒŒì¼ì„ ì¡°ì‚¬í•˜ì—¬ í•´ë‹¹ í˜¸ìŠ¤íŠ¸ì˜ IPì£¼ì†Œë¥¼ ì°¾ìŒ.


ì†Œìˆ˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ êµ¬ì„±ëœ ìž‘ì€ ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ /etc/hosts íŒŒì¼ì˜ í•­ëª©ë“¤ì„ ì‰½ê²Œ ë„ë‹¬ ìˆ˜ ìžˆìŒ.


ê° ì‹œìŠ¤í…œë§ˆë‹¤ í™˜ê²½ì˜ ë‹¤ë¥¸ ì‹œìŠ¤í…œì´ ë¬´ì—‡ì¸ì§€ ì§€ì •. ì´ê²ƒì€ ê³¼ê±°ì— ë„ë‹¬í•˜ë˜ ë°©ë²•. í™˜ê²½ì´ ì»¤ì§€ê³  íŒŒì¼ë“¤ì´ ë„ˆë¬´ ë§Žì€ í•­ëª©ë“¤ë¡œ ì±„ì›Œì§ˆ ë•Œê¹Œì§€. â†’ ì´ëŸ¬í•œ í•­ëª©ë“¤ì„ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë„ˆë¬´ ì–´ë ¤ì›Œì§.


ì„œë²„ë“¤ ì¤‘ í•˜ë‚˜ì˜ IPê°€ ë°”ë€Œë©´ ì´ ëª¨ë“  í˜¸ìŠ¤íŠ¸ì˜ í•­ëª©ì„ ìˆ˜ì •í•´ì•¼ í•¨. â†’ ì´ ëª¨ë“  í•­ëª©ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•  ë‹¨ì¼ ì„œë²„ë¡œ ì˜®ê¸°ê¸°ë¡œ ê²°ì •. â†’ DNS ì„œë²„ë¼ê³  í•¨. ìžì‹ ì˜ /etc/hostsì—ì„œ ì°¾ëŠ” ëŒ€ì‹  serverì—ì„œ ì°¾ë„ë¡ ëª¨ë“  í˜¸ìŠ¤íŠ¸ì— ì§€ì‹œí•¨.


ì–´ë–»ê²Œ í˜¸ìŠ¤íŠ¸ê°€ DNS serverë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•˜ëŠ”ê°€? DNS serverëŠ” 192.168.1.100ì„ ê°€ì§. ëª¨ë“  í˜¸ìŠ¤íŠ¸ëŠ” `/etc/resolv.conf`ì— DNS resolutino êµ¬ì„± íŒŒì¼ì´ ìžˆìŒ. `nameserver    192.168.1.100` ë¼ê³  DNS serverì˜ ì£¼ì†Œë¥¼ ëª…ì‹œí•¨.


ë” ì´ìƒ í˜¸ìŠ¤íŠ¸ì˜ /etc/hosts íŒŒì¼ì— í•­ëª©ì´ í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ ê·¸ë ‡ë‹¤ê³  hosts íŒŒì¼ì— í•­ëª©ì´ ê°€ì§ˆ ìˆ˜ ì—†ëŠ” ê²ƒì€ ì•„ë‹˜. ì˜ˆë¥¼ ë“¤ì–´ ë‚˜ë§Œì˜ í…ŒìŠ¤íŠ¸ ì„œë²„ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ë ¤ê³  í•¨. ì´ë•Œ ì´ë¦„ì„ DNS serverì— ì¶”ê°€í•  í•„ìš” ì—†ìŒ. ì´ ê²½ìš° /etc/hosts íŒŒì¼ì— ì¶”ê°€í•˜ë©´ ë¨.


/etc/hostsì™€ DNS server ë‘ ê³³ì— í•­ëª©ì´ ìžˆë‹¤ë©´ /etc/hosts íŒŒì¼ì„ ë¨¼ì € ë´„. ì´ ê²½ìš° DNS serverì—ì„œ hostsë¥¼ ì°¾ì§€ ì•ŠìŒ. ê·¸ëŸ¬ë‚˜ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìžˆìŒ. /etc/nsswitch.confì—ì„œ ìˆœì„œë¥¼ ì •ì˜í•  ìˆ˜ ìžˆìŒ.


```bash
cat /etc/nsswitch.conf
...
hosts:          files dns
...
```


hosts í•­ëª©ì´ ìžˆëŠ” ì¤„ì€ ì²« ë²ˆì§¸ê°€ íŒŒì¼ì´ê³  ê·¸ ë‹¤ìŒì´ DNSìž„. ëª¨ë“  í˜¸ìŠ¤íŠ¸ë§ˆë‹¤ /etc/hosts íŒŒì¼ì„ ë¨¼ì € í™•ì¸í•¨. ê·¸ë¦¬ê³  ê±°ê¸°ì— ì—†ìœ¼ë©´ DNS serverë¥¼ í™•ì¸. ì´ ìˆœì„œë¥¼ ìˆ˜ì •í•¨ìœ¼ë¡œì¨ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìžˆìŒ.


/etc/hostsì™€ DNS ì„œë²„ ëª¨ë‘ ì•Œì§€ ëª»í•˜ëŠ” í•­ëª©ìž„. resolv.confì— ì—¬ëŸ¬ nameserverë¥¼ ì§€ì •í•  ìˆ˜ ìžˆì§€ë§Œ ì´ë¯¸ êµ¬ì„±í•œ DNS serverì— ì•Œì§€ ëª»í•˜ëŠ” hostëŠ” ê³µìš© nameserverë¡œ ê°€ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìžˆìŒ.

> Domain Names

root


top level domain name


subdomain


![1200px-DNS_schema.svg.png](https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/DNS_schema.svg/1200px-DNS_schema.svg.png)


ì¡°ì§ ë‚´ì—ì„œ apps.google.comì— ë„ë‹¬í•˜ë ¤ê³  í•  ë•Œ, ë¨¼ì €  ìš”ì²­ì´ ì¡°ì§ì˜ ë‚´ë¶€ DNS ì„œë²„ì— ë„ë‹¬. ì•Œì§€ ëª»í•˜ë©´ ì¸í„°ë„·ìœ¼ë¡œ ìš”ì²­ì„ ë„˜ê¹€. ì¸í„°ë„·ì—ì„œ apps.google.comìœ¼ë¡œ ë„˜ê¸°ë ¤ëŠ” ì„œë²„ì˜ IP ì£¼ì†ŒëŠ” ì—¬ëŸ¬ ì„œë²„ì˜ ë„ì›€ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìžˆìŒ.


root DNS ì„œë²„ëŠ” ìš”ì²­ì„ í™•ì¸í•˜ê³  .com ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” DNS ì„œë²„ë¡œ ì „ë‹¬. .com DNS ì„œë²„ëŠ” ìš”ì²­ì„ í™•ì¸í•˜ì—¬ googleì— ì „ë‹¬. Googleì˜ DNS ì„œë²„ëŠ” app ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” IPë¥¼ ì œê³µ.


ëª¨ë“  ê²°ê³¼ë¥¼ ê°€ì†í™”í•˜ê¸° ìœ„í•´ ì¡°ì§ì˜ DNS ì„œë²„ëŠ” ì´ IPë¥¼ ì¼ë°˜ì ìœ¼ë¡œ ëª‡ ì´ˆì—ì„œ ëª‡ ë¶„ê¹Œì§€ ì¼ì • ê¸°ê°„ ë™ì•ˆ ìºì‹±í•  ìˆ˜ ìžˆë„ë¡ ì„ íƒ ê°€ëŠ¥. ë§¤ë²ˆ ì´ ì „ì²´ ê³¼ì •ì„ í•  í•„ìš” ì—†ìŒ.


pingì„ ë³´ë‚´ëŠ” ë° webìœ¼ë¡œ ìž…ë ¥í•˜ì—¬ web.mycompany.comìœ¼ë¡œ ì „ë‹¬í•˜ê³  ì‹¶ìŒ. â†’ /etc/resolv.conf íŒŒì¼ì— searchë¼ëŠ” í•­ëª©ì„ ìž…ë ¥í•˜ê³  mycompany.comì„ ì§€ì •. ë‹¤ì‹œ ping webì„ í•˜ë©´ web.mycompany.comìœ¼ë¡œ pingì´ ë³´ë‚´ì§. mycompany.comê³¼ prod.mycompany.comì´ë¼ê³  í•˜ë©´ webì´ë¼ê³  í–ˆì„ ë•Œ web.mycompany.comì´ë‚˜ web.prod.mycompany.comì„ ì˜ë¯¸í•  ê²ƒìž„. ê·¸ëž˜ì„œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì°¾ì„ ë•Œ ëª¨ë“  ë„ë©”ì¸ ì´ë¦„ì„ ê²€ìƒ‰í•˜ë ¤ê³  í•¨.

> record type

A í˜¸ìŠ¤íŠ¸ ì´ë¦„ì— IPë¥¼ ì €ìž¥.  ex) A   web-server     192.168.1.1


AAAA í˜¸ìŠ¤íŠ¸ ì´ë¦„ì— IPv6 ì €ìž¥.   ex) AAAA    web-server     2001:0db8:85a3:0000:0000:8a2e:0370:7334


CNAME í•œ ì´ë¦„ì— ë‹¤ë¥¸ ì´ë¦„ ë§µí•‘.  ex) CNAME    food.web-server     eat.web-server, hungry.web-server


ì´ ì™¸ì—ë„ ë” ìžˆìŒ.

> nslookup

pingì´ í•­ìƒ DNSë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë° ì í•©í•œ ë„êµ¬ê°€ ì•„ë‹ ìˆ˜ ìž‡ìŒ. nslookupê³¼ ê°™ì€ ëª‡ëª‡ ë„êµ¬ê°€ ìžˆìŒ.


DNS ì„œë²„ë¡œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì§ˆì˜í•  ë•Œ `nslookup` ì‚¬ìš©. `nslookup`ì€ ë¡œì»¬ì— /etc/hosts íŒŒì¼ì€ ê³ ë ¤í•˜ì§€ ì•ŠìŒ. `nslookup` ì€ DNS ì„œë²„ì—ë§Œ ì§ˆì˜í•¨.

> dig

 `dig`ë„ ë§ˆì°¬ê°€ì§€. digëŠ” DNS nameì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìžˆëŠ” ë˜ ë‹¤ë¥¸ ìœ ìš©í•œ ë„êµ¬. ì„œë²„ì— ì €ìž¥ëœ ìœ ì‚¬í•œ í˜•ì‹ìœ¼ë¡œ ë” ë§Žì€ ì„¸ë¶€ ì‚¬í•­ì„ ë°˜í™˜.

> Core DNS

CoreDNS ë°”ì´ë„ˆë¦¬ëŠ” Github ë¦´ë¦¬ìŠ¤ íŽ˜ì´ì§€ì—ì„œ ë‹¤ìš´ë¡œë“œ í•˜ê±°ë‚˜ ë„ì»¤ ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ ê°€ëŠ¥. curlì´ë‚˜ wgetì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìš´ë¡œë“œ. DNS serverë¥¼ ì‹œìž‘í•˜ê¸° ìœ„í•´ ì‹¤í–‰íŒŒì¼ ì‹œìž‘. DNS ì„œë²„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 53ë²ˆ í¬íŠ¸. í˜„ìž¬ í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ ë§µí•‘ëœ IP ì£¼ì†Œê°€ ì—†ìŒ.  DNS ì„œë²„ì˜ /etc/hosts íŒŒì¼ì— ëª¨ë‘ ìž…ë ¥. ê·¸ë¦¬ê³  ì´ íŒŒì¼ì„ ì‚¬ìš©í•˜ë„ë¡ CoreDNSë¥¼ êµ¬ì„±. CoreDNSëŠ” Corefileì´ë¼ëŠ” íŒŒì¼ì—ì„œ IPì—ì„œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ìœ¼ë¡œì˜ ë§µí•‘ì„ ê°€ì ¸ì˜¤ë„ë¡ í•¨. DNS ì„œë²„ê°€ ì‹¤í–‰ë˜ë©´ ì´ì œ ì„œë²„ì˜ /etc/hosts íŒŒì¼ì—ì„œ IPì™€ ì´ë¦„ì„ ì„ íƒí•¨. CoreDNSëŠ” í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ DNS í•­ëª©ì„ êµ¬ì„±í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•ë„ ìžˆìŒ.


[https://coredns.io/plugins/kubernetes/](https://coredns.io/plugins/kubernetes/)


## Prerequisite - Network Namespaces


ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëŠ” ë„¤íŠ¸ì›Œí¬ ë¶„ë¦¬ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë„ì»¤ì™€ ê°™ì´ ì»¨í…Œì´ë„ˆì— ì˜í•´ ì‚¬ìš©ë¨.


ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëž€? í˜¸ìŠ¤íŠ¸ê°€ ì§‘ì´ë¼ë©´ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëŠ” ë°©ì´ë‹¤.ë°©ì€ ì•„ì´ë³„ë¡œ í”„ë¼ì´ë²„ì‹œë¥¼ ì œê³µí•˜ë„ë¡ í•œë‹¤.ì•„ì´ë“¤ì€ ìžì‹  ë°©ë§Œ ë³¼ ìˆ˜ ìžˆë‹¤. ê·¸ëž˜ì„œ ê·¸ë“¤ ë°© ë°–ì—ì„œëŠ” ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ. ê·¸ë“¤ì€ ì§‘ì— ì‚´ê³  ìžˆëŠ” ì‚¬ëžŒì´ í•œ ëª…ë§Œ ìžˆë‹¤ê³  ê°„ì£¼í•˜ì§€ë§Œ ë¶€ëª¨ëŠ” ëª¨ë“  ê³µê°„ì„ ë³¼ ìˆ˜ ìžˆë‹¤. ì›í•œë‹¤ë©´ ë°© ë‘ ì‚¬ì´ì˜ ì—°ê²°ì„ ë§Œë“¤ ìˆ˜ ìžˆë‹¤. ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ë•Œ ì»¨í…Œì´ë„ˆê°€ ê³ ë¦½ë˜ì–´ ìžˆëŠ”ì§€, í˜¸ìŠ¤íŠ¸ë‚˜ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³´ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•´ì•¼ í•¨. ê·¸ëž˜ì„œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ì— ê·¸ê²ƒì— ëŒ€í•œ íŠ¹ë³„í•œ ë°©ì„ ìƒì„±.


ì»¨í…Œì´ë„ˆì— ê´€í•´ì„œëŠ” ì»¨í…Œì´ë„ˆëŠ” ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ë§Œ ë³´ê³  ìžì²´ í˜¸ìŠ¤íŠ¸ì— ìžˆë‹¤ê³  ìƒê°. ê·¸ëŸ¬ë‚˜ ê¸°ë³¸ í˜¸ìŠ¤íŠ¸ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ í¬í•¨í•œ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ê°€ì‹œì„±ì„ ê°€ì§. â†’ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‚˜ì—´í•˜ë©´ ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìžˆìŒ. 


í”„ë¡œì„¸ìŠ¤ ID 1ì„ ê°€ì§„ ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ë¥¼ ë´„. ê¸°ë³¸ í˜¸ìŠ¤íŠ¸ì—ì„œ ë£¨íŠ¸ ì‚¬ìš©ìžì™€ ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‚˜ì—´í•˜ë©´, ì´ë²ˆì—ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ì™€ í•¨ê»˜ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ IDê°€ í‘œì‹œë¨. â†’ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì™€ ì™¸ë¶€ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ IDë¡œ ì‹¤í–‰ë˜ëŠ” ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ìž„. â†’  ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ê°€ ë™ìž‘í•˜ëŠ” ë°©ë²•.


ë„¤íŠ¸ì›Œí‚¹ì— ëŒ€í•´ì„œ í˜¸ìŠ¤íŠ¸ëŠ” LANì— ì—°ê²°ë˜ëŠ” ìžì²´ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ê°€ì§. í˜¸ìŠ¤íŠ¸ëŠ” ë‚˜ë¨¸ì§€ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì§„ ìžì²´ ë¼ìš°íŒ…ê³¼ ARP í…Œì´ë¸”ì„ ê°€ì§. ì»¨í…Œì´ë„ˆë¡œë¶€í„° ëª¨ë“  ì„¸ë¶€ ì‚¬í•­ì„ ê°ì¶”ê³  ì‹¶ìŒ.


ì»¨í…Œì´ë„ˆê°€  ìƒì„±ë  ë•Œ, í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì •ë³´ì— ëŒ€í•œ ê°€ì‹œì„±ì´ ì—†ëŠ” ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ìƒì„±. ê·¸ê²ƒì˜ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆëŠ” ìžì²´ ê°€ìƒ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ê°€ì§ˆ ìˆ˜ ìžˆìŒ.


ë¦¬ëˆ…ìŠ¤ í˜¸ìŠ¤íŠ¸ì—ì„œ ìƒˆ ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ `ip netns add` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰. ì´ ê²½ìš° ë‘ ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ìƒì„±. `ip netns` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚˜ì—´.


ì´ì œ ìš°ë¦¬ê°€ ë§Œë“  ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ì—ì„œ ë™ì¼í•œ ê²ƒì„ ì–´ë–»ê²Œ ë³¼ ìˆ˜ ìžˆëŠ”ê°€? â†’ redë‚˜ blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ì—ì„œ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ëŠ”ê°€? `ip netns exec`  ëª…ë ¹ì–´ ë’¤ì— ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ì´ë¦„ì„ ë¶™ìž„. `ip link`  ëª…ë ¹ì–´ê°€ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ì•ˆì—ì„œ ì‹¤í–‰ë¨.


```bash
ip netns exec red ip link
```


ë˜ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” `ip link` ëª…ë ¹ì–´ì—  `-n`  ì˜µì…˜ì„ ì¶”ê°€.


```bash
ip -n red link
```


ë‘ ê²°ê³¼ ëª¨ë‘ ê°™ìŒ. ë‘ ë²ˆì§¸ ë°©ë²•ì€ ë” ê°„ë‹¨í•˜ì§€ë§Œ, ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ë¶€ì—ì„œ ip ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë ¤ëŠ” ê²½ìš°ì—ë§Œ ìž‘ë™.


ë³´ë‹¤ì‹œí”¼ ë£¨í”„ë°± ì¸í„°íŽ˜ì´ìŠ¤ë§Œ ë‚˜ì—´ë˜ì–´ ìžˆì–´ í˜¸ìŠ¤íŠ¸ì—ì„œ eth ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ë³¼ ìˆ˜ ì—†ìŒ. ê·¸ëž˜ì„œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ê°€ì§€ê³  ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ë³´ì§€ ëª»í•˜ë„ë¡ ì„±ê³µì ìœ¼ë¡œ ë§‰ì•˜ìŒ.


ARP í…Œì´ë¸”ë„ ë§ˆì°¬ê°€ì§€ìž„. í˜¸ìŠ¤íŠ¸ì—ì„œ `arp`ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ í•­ëª© ëª©ë¡ì´ í‘œì‹œë˜ì§€ë§Œ, ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•˜ë©´ í•­ëª©ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ. ë¼ìš°íŒ… í…Œì´ë¸”ë„ ë§ˆì°¬ê°€ì§€. í˜„ìž¬ ì´ ë„¤íŠ¸ì›Œí¬ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë“¤ì€ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì—†ê³ , ìžì²´ ì¸í„°íŽ˜ì´ìŠ¤ë„ ì—†ìœ¼ë©°, ê¸°ë³¸ í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ë³¼ ìˆ˜ ì—†ìŒ.


ë¨¼ì € ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ìžì²´ ê°„ì˜ ì—°ê²°ì„±ì„ í™•ì¸í•´ë³´ìž. ì¼€ì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ê° ê¸°ê¸°ì˜ ì¸í„°ë„· ì¸í„°íŽ˜ì´ìŠ¤ì— ë‘ ê°œì˜ ë¬¼ë¦¬ì  ê¸°ê¸°ë¥¼ ì—°ê²°í•˜ëŠ” ê²ƒì²˜ëŸ¼, ê°€ìƒ ì´ë”ë„· ìŒ ë˜ëŠ” ê°€ìƒ ì¼€ì´ë¸”(íŒŒì´í”„)ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ê°œì˜ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ í•¨ê»˜ ì—°ê²°í•  ìˆ˜ ìžˆìŒ. ì¼€ì´ë¸”ì„ ë§Œë“¤ê¸° ìœ„í•´  vethë¡œ ì„¤ì •ëœ ìœ í˜•ì„ ê°€ì§€ê³   `ip link`  ëª…ë ¹ì–´ ì‹¤í–‰í•˜ê³  v8 redì™€ v8 blue ë‘ ëì„ ëª…ì‹œí•¨.


```bash
ip link add veth-red type veth peer name veth-blue
```


ê·¸ ë‹¤ìŒì€ ì ì ˆí•œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ê° ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ë¶€ì°©. `ip link set veth red netns red` ëª…ë ¹ì–´ ì‚¬ìš©. blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ë¶€ì°©í•˜ë©´ ë¨.


```bash
ip link set veth-red netns red
ip link set veth-blue netns blue
```


ê·¸ëŸ° ë‹¤ìŒ ê° ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— IPì£¼ì†Œë¥¼ í• ë‹¹í•  ìˆ˜ ìžˆìŒ. `ip addr` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— IP ì£¼ì†Œë¥¼ í• ë‹¹í•  ê²ƒ.


```bash
ip -n red addr add 192.168.15.1 dev veth-red
ip -n blue addr add 192.168.15.2 dev veth-blue
```


ê·¸ëŸ° ë‹¤ìŒ `ip link set up` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ í˜¸ì¶œ.


```bash
ip -n red link set veth-red up
ip -n blue link set veth-blue up
```


linkê°€ ì˜¬ë¼ê°€ê³  ì´ì œ  ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ê°€ ì„œë¡œ ì—°ê²°ë  ìˆ˜ ìžˆìŒ. red ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì—ì„œ blueì˜ IPë¡œ pingì„ ì‹œë„. red ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì˜ ARP í…Œì´ë¸”ì„ ë³´ë©´ blueê°€ 192.168.15.2ì— MAC ì£¼ì†Œë¡œ ì‹ë³„ëœ ê²ƒì„ ë³¼ ìˆ˜ ìžˆìŒ. ë§ˆì°¬ê°€ì§€ë¡œ blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì˜ ARP í…Œì´ë¸”ì„ ë³´ë©´ redë„ ì‹ë³„ëœ ê²ƒì„ ë³¼ ìˆ˜ ìžˆìŒ.


```bash
ip netns exec red ping 192.168.15.2
ip netns exec red arp
ip netns exec blue arp
```


í˜¸ìŠ¤íŠ¸ì˜ ARP í…Œì´ë¸”ì„ ê°€ì§€ê³  ë¹„êµí•˜ë©´ í˜¸ìŠ¤íŠ¸ ARP í…Œì´ë¸”ì€ ìš°ë¦¬ê°€ ë§Œë“  ìƒˆë¡œìš´ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ëŒ€í•´ ì „í˜€ ì•Œì§€ ëª» í•¨. ê·¸ ì•ˆì— ìš°ë¦¬ê°€ ë§Œë“  ì¸í„°íŽ˜ì´ìŠ¤ì— ëŒ€í•´ì„œë„ ì „í˜€ ì•Œì§€ ëª» í•¨.


ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ê°€ ë” ë§Žìœ¼ë©´ ì–´ë–»ê²Œ í•˜ëŠ”ê°€? ì–´ë–»ê²Œ í•˜ë©´ ëª¨ë‘ê°€ ì„œë¡œ ì†Œí†µí•  ìˆ˜ ìžˆëŠ”ê°€? ì‹¤ì œ ì„¸ê³„ì™€ ë§ˆì°¬ê°€ì§€ë¡œ í˜¸ìŠ¤íŠ¸ ë‚´ë¶€ì— ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ ìƒì„±.


ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ë ¤ë©´ ìŠ¤ìœ„ì¹˜ê°€ í•„ìš”í•˜ë¯€ë¡œ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ë ¤ë©´ ê°€ìƒ ìŠ¤ìœ„ì¹˜ê°€ í•„ìš”. ê·¸ëž˜ì„œ í˜¸ìŠ¤íŠ¸ ë‚´ì— ê°€ìƒ ìŠ¤ìœ„ì¹˜ë¥¼ ìƒì„±í•˜ê³  ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ì—°ê²°. í•˜ì§€ë§Œ í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ ê°€ìƒ ìŠ¤ìœ„ì¹˜ë¥¼ ë§Œë“¤ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ëŠ”ê°€? Linux Bridge, Open vSwitch ë“± ë„¤ì´í‹°ë¸Œ ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•˜ì—¬ í•  ìˆ˜ ìžˆìŒ.


ì´ ê²½ìš° Linux Bridge ì‚¬ìš©. ë‚´ë¶€ ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ë¸Œë¦¿ì§€ë¡œ ì„¤ì •ëœ ìœ í˜•ì„ ê°€ì§€ê³  `ip link add` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ì— ìƒˆ ì¸í„°íŽ˜ì´ìŠ¤ ì¶”ê°€.


```bash
ip link add v-net-0 type bridge
```


í˜¸ìŠ¤íŠ¸ ê´€ì ì—ì„œ ë³´ë©´ ê·¸ì € ë˜ ë‹¤ë¥¸ ì¸í„°íŽ˜ì´ìŠ¤. eth ì¸í„°íŽ˜ì´ìŠ¤ì™€ ê°™ì´. ë‹¤ë¥¸ ì¸í„°íŽ˜ì´ìŠ¤ë“¤ê³¼ `ip link` ëª…ë ¹ì–´ ì¶œë ¥ì— ë‚˜íƒ€ë‚¨. í˜„ìž¬ëŠ” ë‚´ë ¤ê°€ ìžˆìŒìœ¼ë¡œ ì˜¬ë ¤ì•¼ í•¨. `ip link set up` ì„ ì‚¬ìš©. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì˜ ê²½ìš°, ì´ ì¸í„°íŽ˜ì´ìŠ¤ëŠ” ì—°ê²°í•  ìˆ˜ ìžˆëŠ” ìŠ¤ìœ„ì¹˜ì™€ ê°™ìŒ. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ëŒ€í•œ ìŠ¤ìœ„ì¹˜ì´ìž í˜¸ìŠ¤íŠ¸ì˜ ì¸í„°íŽ˜ì´ìŠ¤.


```bash
ip link set dev v-net-0 up
```


ì´ì œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ìŠ¤ìœ„ì¹˜ì— ì—°ê²°. ì´ì „ì— ë‘ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ì§ì ‘ ì—°ê²°í•˜ê³  ì‹¶ì–´ veth-redì™€ veth-blue ìŒì„ ê°€ì§€ë¡œ ì¼€ì´ë¸”ì„ ìƒì„±. ì´ì œ ëª¨ë“  ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ë¸Œë¦¿ì§€ì— ì—°ê²°í•  ê²ƒì´ë¯€ë¡œ ë” ì´ìƒ ì¼€ì´ë¸”ì€ í•„ìš”í•˜ì§€ ì•ŠìŒ. ì´ê²ƒì„ ì œê±°.


```bash
ip -n red link del veth-red
```


delete ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ í•œ ê°œë§Œ ì§€ìš°ë©´ ìŒì´ì—ˆê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ìª½ìœ¼ë¡œ ìžë™ì ìœ¼ë¡œ ì œê±°ë¨.


ì´ì œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ bridgeì— ì—°ê²°í•  ìˆ˜ ìžˆëŠ” ìƒˆ ì¼€ì´ë¸” ìƒì„±. `ip link add` ã…ì—¬ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì´ì „ì²˜ëŸ¼ í•œìª½ ëì— veth-redê°€ ìžˆëŠ” ìŒì„ ë§Œë“¤ì§€ë§Œ ì´ë²ˆì—ëŠ” ëì— ë‹¤ë¥¸ ì•„ë¦„ì´ ë¶™ì—¬ì§. 


```bash
ip link add veth-red type veth peer name veth-red-br
```


veth-red-brì€ ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•˜ëŠ” ê²ƒ. ì´ ëª…ëª… ê·œì¹™ì€  red ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì™€ ì—°ê´€ëœ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ì‰½ê²Œ ì‹ë³„í•˜ëŠ” ë° ë„ì›€ì´ ë¨. ë§ˆì°¬ê°€ì§€ë¡œ, blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¥¼ ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•  ì¼€ì´ë¸” ìƒì„±.


```bash
ip link add veth-blue type veth peer name veth-blue-br
```


ì¼€ì´ë¸”ì´ ì¤€ë¹„ë˜ì—ˆìœ¼ë¯€ë¡œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ì—°ê²°. ì¸í„°íŽ˜ì´ìŠ¤ í•œìª½ ëì„ red ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ì—°ê²°í•˜ë ¤ë©´ `ip link set veth-red netns red` ëª…ë ¹ì–´ ì‹¤í–‰. ë‹¤ë¥¸ ìª½ ëì„ ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•˜ë ¤ë©´ `ip link set veth-red-br master v-net-0` ë¥¼ ì‹¤í–‰. blueë„ ë§ˆì°¬ê°€ì§€.


```bash
ip link set veth-red netns red
ip link set veth-red-br master v-net-0

ip link set veth-blue netns blue
ip link set veth-blue-br master v-net-0
```


ì´ì œ ë§í¬ì— IP ì£¼ì†Œë¥¼ ì„¤ì •í•˜ê³  ì˜¬ë¦¼. ì´ì „ê³¼ ê°™ì€ IP ì£¼ì†Œ ì‚¬ìš©í•˜ê³  ìž¥ì¹˜ë¥¼ ì˜¬ë¦¼.


```bash
ip -n red addr add 192.168.15.1 dev veth-red
ip -n blue addr add 192.168.15.2 dev veth-blue
ip -n red link set veth-red up
ip -n blue link set veth-blue up
```


ì´ì œ ì»¨í…Œì´ë„ˆë“¤ì€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì„œë¡œ ì—°ê²° ê°€ëŠ¥. ë‚˜ë¨¸ì§€ ë‘ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë„ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•˜ëŠ” ë™ì¼í•œ ì ˆì°¨ë¥¼ ë”°ë¦„.


í˜¸ìŠ¤íŠ¸ì—ëŠ” 192.168.1.2ë¥¼ í• ë‹¹. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì˜ ì¸í„°íŽ˜ì´ìŠ¤ ì¤‘ í•˜ë‚˜ì— ë„ë‹¬í•˜ë ¤ê³  í•˜ë©´ ì–´ë–»ê²Œ ë˜ëŠ”ê°€? ë„ë‹¬í•˜ì§€ ëª»í•¨. í˜¸ìŠ¤íŠ¸ì™€ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëŠ” ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì— ìžˆìŒ. ê·¸ëŸ¬ë‚˜ ì´ ì‚¬ì´ë¥¼ ì •ë§ ì—°ê²°í•˜ê³  ì‹¶ë‹¤ë©´? ê°€ìƒ ìŠ¤ìœ„ì¹˜ëŠ” ì‹¤ì œë¡œ í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°íŽ˜ì´ìŠ¤ë¼ê³  í–ˆìŒ. ê·¸ëŸ¬ë¯€ë¡œ í˜¸ìŠ¤íŠ¸ì˜ 192.168.15 ë„¤íŠ¸ì›Œí¬ ì¸í„°íŽ˜ì´ìŠ¤ê°€ ìžˆìŒ. ì´ ì¸í„°íŽ˜ì´ìŠ¤ëŠ” ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ë„ë‹¬í•  ìˆ˜ ìžˆë„ë¡ IP ì£¼ì†Œë¥¼ í• ë‹¹í•˜ê¸°ë§Œ í•˜ë©´ ë¨. `ip addr` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´  192.168.15.5ë¥¼ ì¸í„°íŽ˜ì´ìŠ¤ì— ì„¤ì •.


```bash
ip addr add 192.168.15.5/24 dev v-net-0
```


ì´ì œ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì—ì„œ red ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¡œ pingì„ ë³´ë‚¼ ìˆ˜ ìžˆìŒ.


ì´ ì „ì²´ ë„¤íŠ¸ì›Œí¬ëŠ” ì—¬ì „ížˆ ë¹„ê³µê°œì´ë©° í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ ì œí•œë˜ì–´ ìžˆìŒ. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ë¶€ì—ì„œëŠ” ì™¸ë¶€ ì„¸ê³„ì— ë„ë‹¬í•  ìˆ˜ ì—†ìœ¼ë©°, ì™¸ë¶€ ì„¸ê³„ì˜ ëˆ„êµ¬ë„ ë‚´ë¶€ì— í˜¸ìŠ¤íŒ…ëœ ì„œë¹„ìŠ¤ë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë„ë‹¬í•  ìˆ˜ ì—†ìŒ.


ì™¸ë¶€ ì„¸ê³„ë¡œ í†µí•˜ëŠ” ìœ ì¼í•œ ë¬¸ì€ í˜¸ìŠ¤íŠ¸ì˜ ì´ë”ë„· í¬íŠ¸. ê·¸ë ‡ë‹¤ë©´ ì´ë”ë„· í¬íŠ¸ë¥¼ í†µí•´ íšŒì„  ë„¤íŠ¸ì›Œí¬ì— ë„ë‹¬í•˜ë„ë¡ ì´ ë¸Œë¦¬ì§€ë¥¼ ì–´ë–»ê²Œ êµ¬ì„±í•  ìˆ˜ ìžˆëŠ”ê°€? ì£¼ì†Œê°€ 192.168.1.3ì¸ ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ê°€ íšŒì„  ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ë˜ì–´ ìžˆë‹¤ê³  ê°€ì •. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ì—ì„œ ì–´ë¯ê²Œ í˜¸ìŠ¤íŠ¸ì— ë„ë‹¬í•  ìˆ˜ ìžˆëŠ”ê°€? ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì—ì„œ í˜¸ìŠ¤íŠ¸ë¡œ pingì„ ë³´ë‚´ë©´ ë¬´ìŠ¨ ì¼ì´ ë°œìƒí•˜ëŠ”ê°€? blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— ë”°ë¥´ë©´ í˜„ìž¬ ë„¤íŠ¸ì›Œí¬ 192.168.15ì™€ ë‹¤ë¥¸ 192.168.1ì˜ ë„¤íŠ¸ì›Œí¬ì— ë„ë‹¬í•˜ë ¤ê³  í•¨. ê·¸ëž˜ì„œ ê·¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì°¾ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê¸° ìœ„í•´ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì‚´íŽ´ë´„. ë¼ìš°íŒ… í…Œì´ë¸”ì—ëŠ” ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì •ë³´ê°€ ì—†ìŒ. ê·¸ëž˜ì„œ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•  ìˆ˜ ì—†ë‹¤ëŠ” ë©”ì‹œì§€ê°€ ë‹¤ì‹œ ì˜´. ë”°ë¼ì„œ ì™¸ë¶€ ì„¸ê³„ë¡œ í†µí•˜ëŠ” ê²Œì´íŠ¸ì›¨ì´ë‚˜ ë¬¸ì„ ì œê³µí•˜ê¸° ìœ„í•´ ë¼ìš°íŒ… í…Œì´ë¸”ì— í•­ëª©ì„ ì¶”ê°€í•´ì•¼ í•¨.


ì–´ë–»ê²Œ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì°¾ëŠ”ê°€? ê²Œì´íŠ¸ì›¨ì´ëŠ” ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°ë˜ëŠ” ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì˜ ì‹œìŠ¤í…œ.


ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì—ëŠ” ê°œì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì—°ê²°í•  ìˆ˜ ìžˆëŠ” ì¸í„°íŽ˜ì´ìŠ¤ê°€ ìžˆì–´ì„œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— í•‘ì„ ë³´ë‚¼ ìˆ˜ ìžˆìŒ. ê·¸ëŸ¬ë¯€ë¡œ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ê°€ ë‘ ë„¤íŠ¸ì›Œí¬ë¥¼ ì—°ê²°í•˜ëŠ” ê²Œì´íŠ¸ì›¨ì´.


```bash
ip netns exec blue ip route add 192.168.1.0/24 via 192.168.15.5
```


ì´ì œ blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì—ì„œ 192.168.1 ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ëª¨ë“  íŠ¸ëž˜í”½ì„ ë¼ìš°íŒ…í•  ìˆ˜ ìžˆìŒ. í˜¸ìŠ¤íŠ¸ëŠ” ë‘ IPë¥¼ ê°€ì§. í•˜ë‚˜ëŠ” ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬, ë˜ ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬. ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ”ê°€? âŒ. blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëŠ” ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì˜ ê²Œì´íŠ¸ì›¨ì´ë¡œë§Œ ë„ë‹¬í•  ìˆ˜ ìžˆìŒ. í•‘ì„ ë³´ë‚´ë©´ ë„¤íŠ¸ì›Œí¬ì— ë„ë‹¬í•  ìˆ˜ ì—†ë‹¤ëŠ” ë©”ì‹œì§€ë¥¼ ë°›ì§€ ì•Šì§€ë§Œ, í•‘ì— ëŒ€í•œ ì‘ë‹µì„ ë°›ì§€ ëª» í•¨. ì™œ ê·¸ëŸ¬ëŠ”ê°€? ì•Œì§€ ëª»í•˜ëŠ” ë‚´ë¶€ ì‚¬ì„¤ IPë¥¼ ê°€ì§€ê³  ìžˆì–´ì„œ ë„ë‹¬í•  ìˆ˜ ì—†ìŒ. ì´ì œëŠ” NATê°€ í•„ìš”í•¨.


NATëŠ” ì–´ë–»ê²Œ ì¶”ê°€í•˜ëŠ”ê°€? IP í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ í•  ìˆ˜ ìžˆìŒ. NAT IP í…Œì´ë¸”ì— ìƒˆ ê·œì¹™ ì¶”ê°€í•˜ì—¬ ì†ŒìŠ¤ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  íŒ¨í‚·ì˜ ë°œì‹  ì£¼ì†Œë¥¼ ê°€ë¦¬ê±°ë‚˜ ëŒ€ì²´.


```bash
iptables -t nat -A POSTROUTING -s 192.168.15.0/24 -j MASQUERADE
```


ì´ë ‡ê²Œ í•˜ë©´ ë„¤íŠ¸ì›Œí¬ ì™¸ë¶€ì—ì„œ ì´ëŸ¬í•œ íŒ¨í‚·ì„ ìˆ˜ì‹ í•˜ëŠ” ì‚¬ëžŒì€ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ë‚´ì—ì„œê°€ ì•„ë‹ˆë¼ í˜¸ìŠ¤íŠ¸ì—ì„œ ì˜¨ ê²ƒì´ë¼ê³  ìƒê°. ì´ì œ pingì„ ë³´ë‚´ë©´ ì™¸ë¶€ì— ë„ë‹¬í•  ìˆ˜ ìžˆìŒ. ë§ˆì¹¨ë‚´ LANì´ ì¸í„°ë„·ì— ì—°ê²°ë¨. ìš°ë¦¬ëŠ” ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ê°€ ì¸í„°ë„·ì— ì—°ê²°ë˜ê¸¸ ì›í•¨. blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì—ì„œ 8.8.8.8ë¡œ pingì„ ì‹œë„. ë„ë‹¬í•  ìˆ˜ ì—†ë‹¤ëŠ” ë©”ì‹œì§€ê°€ ì˜´. â†’ ë¼ìš°íŒ… í…Œì´ë¸”ì—ì„œ 192.168.1 ì™¸ì— ë‹¤ë¥¸ ê²½ë¡œê°€ ì—†ìŒ. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëŠ” í˜¸ìŠ¤íŠ¸ê°€ ë„ë‹¬í•  ìˆ˜ ìžˆëŠ” ë„¤íŠ¸ì›Œí¬ì— ë„ë‹¬í•  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì— ë„ë‹¬í•  ìˆ˜ ìžˆìŒ. ê·¸ëŸ¬ë¯€ë¡œ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì¶”ê°€.


```bash
ip netns exec blue ip route add default via 192.168.15.5
```


ì´ì œ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì—ì„œ ì™¸ë¶€ì— ë„ë‹¬í•  ìˆ˜ ìžˆìŒ. ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ëŠ” ë‚´ë¶€ ì‚¬ì„¤ë§ìœ¼ë¡œ ì™¸ë¶€ì—ì„œ ëˆ„êµ¬ë„ ë„ë‹¬í•  ìˆ˜ ì—†ìŒ. í˜¸ìŠ¤íŠ¸ ìžì²´ì—ì„œë§Œ ë„ë‹¬ ê°€ëŠ¥. ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ì—ì„œë„ í†µì‹ í•  ìˆ˜ ìžˆë„ë¡ í•˜ë ¤ë©´ ë‘ ê°€ì§€ ì˜µì…˜ì´ ìžˆìŒ. ì²« ë²ˆì§¸ëŠ” ë‘ ë²ˆì§¸ í˜¸ìŠ¤íŠ¸ì—ê²Œ ê°œì¸ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ì£¼ëŠ” ê²ƒ. ë‹¤ë¥¸ ì˜µì…˜ì€ blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— í• ë‹¹ëœ iptableì„ ì‚¬ìš©í•˜ì—¬ í¬íŠ¸ í¬ì›Œë”© ì—­í• ì„ ì¶”ê°€í•˜ì—¬ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ 80 í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  íŠ¸ëž˜í”½ì´ blue ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì— í• ë‹¹ëœ 80 í¬íŠ¸ë¡œ ì „ë‹¬ë˜ë„ë¡ í•˜ëŠ” ê²ƒ.


```bash
iptables -t nat -A PREROUTING --dport 80 --to-destination 192.168.15.2:80 -j DNAT
```


## Prerequisite - Docker Networking

> NONE

## Prerequisite - CNI


## Cluster Networking


## Practice Test - Explore Kubernetes Environment


## Pod Networking


## CNI in kubernetes


## CNI weave


## Practice Test - Explore CNI


## Practice Test - Deploy Network Solution


## IP Address Management -  Weave


## Practice Test - Networking Weave


## Service Networking


## Practice Test - Service Networking


## DNS in kubernetes


## CoreDNS in kubernetes


## Practice Test - Explore DNS


## Ingress


## Practice Test - Ingress -1


## Practice Test - Ingress -2


## Introduction to Gateway API


## Practice Test - Gateway API

